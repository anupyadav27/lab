[
  {
    "id": "1.1",
    "title": "Ensure Latest SQL Server Service Packs and Hotfixes are Installed",
    "assessment": "Not Scored",
    "description": "SQL\tServer\tpatches\tcontain\tprogram\tupdates\tthat\tfix\tsecurity\tand\tproduct\tfunctionality issues\tfound\tin\tthe\tsoftware.\tThese\tpatches\tcan\tbe\tinstalled\twith\ta\thotfix\twhich\tis\ta\tsingle patch,\ta\tcumulative\tupdate\twhich\tis\ta\tsmall\tgroup\tof\tpatches\tor\ta\tservice\tpack\twhich\tis\ta large\tcollection\tof\tpatches.\tThe\tSQL\tServer\tversion\tand\tpatch\tlevels\tshould\tbe\tthe\tmost recent\tcompatible\twith\tthe\torganizations'\toperational\tneeds.",
    "rationale": "Using\tthe\tmost\trecent\tSQL\tServer\tsoftware,\talong\twith\tall\tapplicable\tpatches\tcan\thelp\tlimit the\tpossibilities\tfor\tvulnerabilities\tin\tthe\tsoftware,\tthe\tinstallation\tversion\tand/or\tpatches applied\tduring\tsetup\tshould\tbe\testablished\taccording\tto\tthe\tneeds\tof\tthe\torganization.",
    "audit": "To\tdetermine\tyour\tSQL\tServer\tservice\tpack\tlevel,\trun\tthe\tfollowing\tcode\tsnippet. SELECT SERVERPROPERTY('ProductLevel') as SP_installed, SERVERPROPERTY('ProductVersion') as Version; First\tcolumn\treturns\tthe\tinstalled\tService\tPack\tlevel,\tthe\tsecond\tis\tthe\texact\tbuild\tnumber.",
    "remediation": "Identify\tthe\tcurrent\tversion\tand\tpatch\tlevel\tof\tyour\tSQL\tServer\tinstances\tand\tensure\tthey contain\tthe\tlatest\tsecurity\tfixes.\tMake\tsure\tto\ttest\tthese\tfixes\tin\tyour\ttest\tenvironments before\tupdating\tproduction\tinstances.  10\t|\tP a g e The\tmost\trecent\tSQL\tServer\tpatches\tcan\tbe\tfound\there: \u2022 Hotfixes\tand\tCumulative\tupdates:\thttp://blogs.msdn.com/b/sqlreleaseservices/ \u2022 Service\tPacks:\thttps://support.microsoft.com/en-us/kb/2958069 Default\tValue: Service\tpacks\tand\tpatches\tare\tnot\tinstalled\tby\tdefault. References: 1. https://support.microsoft.com/en-us/kb/2958069 CIS\tControls: Version\t6 4\tContinuous\tVulnerability\tAssessment\tand\tRemediation Continuous\tVulnerability\tAssessment\tand\tRemediation Version\t7 2.2\tEnsure\tSoftware\tis\tSupported\tby\tVendor Ensure\tthat\tonly\tsoftware\tapplications\tor\toperating\tsystems\tcurrently\tsupported\tby\tthe software's\tvendor\tare\tadded\tto\tthe\torganization's\tauthorized\tsoftware\tinventory. Unsupported\tsoftware\tshould\tbe\ttagged\tas\tunsupported\tin\tthe\tinventory\tsystem.  11\t|\tP a g e",
    "function_names": [
      "sql_server_instance_latest_service_pack_installed",
      "sql_server_instance_latest_hotfix_installed",
      "sql_server_instance_patch_level_current",
      "sql_server_instance_version_compatible",
      "sql_server_instance_security_patches_up_to_date"
    ],
    "references": "1. https://support.microsoft.com/en-us/kb/2958069 CIS\tControls: Version\t6 4\tContinuous\tVulnerability\tAssessment\tand\tRemediation Continuous\tVulnerability\tAssessment\tand\tRemediation Version\t7 2.2\tEnsure\tSoftware\tis\tSupported\tby\tVendor Ensure\tthat\tonly\tsoftware\tapplications\tor\toperating\tsystems\tcurrently\tsupported\tby\tthe software's\tvendor\tare\tadded\tto\tthe\torganization's\tauthorized\tsoftware\tinventory. Unsupported\tsoftware\tshould\tbe\ttagged\tas\tunsupported\tin\tthe\tinventory\tsystem.  11\t|\tP a g e"
  },
  {
    "id": "1.2",
    "title": "Ensure Single-Function Member Servers are Used",
    "assessment": "Not Scored",
    "description": "It\tis\trecommended\tthat\tSQL\tServer\tsoftware\tbe\tinstalled\ton\ta\tdedicated\tserver.\tThis architectural\tconsideration\taffords\tsecurity\tflexibility\tin\tthat\tthe\tdatabase\tserver\tcan\tbe placed\ton\ta\tseparate\tsubnet\tallowing\taccess\tonly\tfrom\tparticular\thosts\tand\tover\tparticular protocols.\tDegrees\tof\tavailability\tare\teasier\tto\tachieve\tas\twell\t-\tover\ttime,\tan\tenterprise\tcan move\tfrom\ta\tsingle\tdatabase\tserver\tto\ta\tfailover\tto\ta\tcluster\tusing\tload\tbalancing\tor\tto some\tcombination\tthereof.",
    "rationale": "It\tis\teasier\tto\tmanage\t(i.e.\treduce)\tthe\tattack\tsurface\tof\tthe\tserver\thosting\tSQL\tServer software\tif\tthe\tonly\tsurfaces\tto\tconsider\tare\tthe\tunderlying\toperating\tsystem,\tSQL\tServer itself,\tand\tany\tsecurity/operational\ttooling\tthat\tmay\tadditionally\tbe\tinstalled.\tAs\tnoted\tin the\tdescription,\tavailability\tcan\tbe\tmore\teasily\taddressed\tif\tthe\tdatabase\tis\ton\ta\tdedicated server.",
    "audit": "Ensure\tthat\tno\tother\troles\tare\tenabled\tfor\tthe\tunderlying\toperating\tsystem\tand\tthat\tno excess\ttooling\tis\tinstalled,\tper\tenterprise\tpolicy.",
    "remediation": "Uninstall\texcess\ttooling\tand/or\tremove\tunnecessary\troles\tfrom\tthe\tunderlying\toperating system. Impact: It\tis\tdifficult\tto\tsee\tany\treasonably\tadverse\timpact\tto\tmaking\tthis\tarchitectural\tchange, once\tthe\tcosts\tof\tmaking\tthe\tchange\thave\tbeen\tpaid.\tCustom\tapplications\tmay\tneed\tto\tbe modified\tto\taccommodate\tdatabase\tconnections\tover\tthe\twire\trather\tthan\ton\tthe\thost\t(i.e. using\tTCP/IP\tinstead\tof\tNamed\tPipes).\tAdditional\thardware\tand\toperating\tsystem\tlicenses may\tbe\trequired\tto\tmake\tthese\tarchitectural\tchanges.  12\t|\tP a g e CIS\tControls: Version\t6 9.5\tOperate\tCritical\tServices\tOn\tDedicated\tHosts\t(i.e.\tDNS,\tMail,\tWeb,\tDatabase) Operate\tcritical\tservices\ton\tseparate\tphysical\tor\tlogical\thost\tmachines,\tsuch\tas\tDNS,\tfile, mail,\tweb,\tand\tdatabase\tservers. Version\t7 2.10\tPhysically\tor\tLogically\tSegregate\tHigh\tRisk\tApplications Physically\tor\tlogically\tsegregated\tsystems\tshould\tbe\tused\tto\tisolate\tand\trun\tsoftware that\tis\trequired\tfor\tbusiness\toperations\tbut\tincur\thigher\trisk\tfor\tthe\torganization.  13\t|\tP a g e 2 Surface Area Reduction SQL\tServer\toffers\tvarious\tconfiguration\toptions,\tsome\tof\tthem\tcan\tbe\tcontrolled\tby\tthe sp_configure\tstored\tprocedure.\tThis\tsection\tcontains\tthe\tlisting\tof\tthe\tcorresponding recommendations.",
    "function_names": [
      "sql_server_instance_single_function",
      "sql_server_instance_dedicated_host",
      "sql_server_instance_no_additional_roles",
      "sql_server_instance_isolated_subnet",
      "sql_server_instance_restricted_access",
      "sql_server_instance_high_availability_ready",
      "sql_server_instance_no_shared_resources",
      "sql_server_instance_secure_protocols_only"
    ],
    "impact": "It\tis\tdifficult\tto\tsee\tany\treasonably\tadverse\timpact\tto\tmaking\tthis\tarchitectural\tchange, once\tthe\tcosts\tof\tmaking\tthe\tchange\thave\tbeen\tpaid.\tCustom\tapplications\tmay\tneed\tto\tbe modified\tto\taccommodate\tdatabase\tconnections\tover\tthe\twire\trather\tthan\ton\tthe\thost\t(i.e. using\tTCP/IP\tinstead\tof\tNamed\tPipes).\tAdditional\thardware\tand\toperating\tsystem\tlicenses may\tbe\trequired\tto\tmake\tthese\tarchitectural\tchanges.  12\t|\tP a g e CIS\tControls: Version\t6 9.5\tOperate\tCritical\tServices\tOn\tDedicated\tHosts\t(i.e.\tDNS,\tMail,\tWeb,\tDatabase) Operate\tcritical\tservices\ton\tseparate\tphysical\tor\tlogical\thost\tmachines,\tsuch\tas\tDNS,\tfile, mail,\tweb,\tand\tdatabase\tservers. Version\t7 2.10\tPhysically\tor\tLogically\tSegregate\tHigh\tRisk\tApplications Physically\tor\tlogically\tsegregated\tsystems\tshould\tbe\tused\tto\tisolate\tand\trun\tsoftware that\tis\trequired\tfor\tbusiness\toperations\tbut\tincur\thigher\trisk\tfor\tthe\torganization.  13\t|\tP a g e 2 Surface Area Reduction SQL\tServer\toffers\tvarious\tconfiguration\toptions,\tsome\tof\tthem\tcan\tbe\tcontrolled\tby\tthe sp_configure\tstored\tprocedure.\tThis\tsection\tcontains\tthe\tlisting\tof\tthe\tcorresponding recommendations."
  },
  {
    "id": "2.1",
    "title": "Ensure 'Ad Hoc Distributed Queries' Server Configuration Option is set to '0'",
    "assessment": "Scored",
    "description": "Enabling\tAd\tHoc\tDistributed\tQueries\tallows\tusers\tto\tquery\tdata\tand\texecute\tstatements\ton external\tdata\tsources.\tThis\tfunctionality\tshould\tbe\tdisabled.",
    "rationale": "This\tfeature\tcan\tbe\tused\tto\tremotely\taccess\tand\texploit\tvulnerabilities\ton\tremote\tSQL Server\tinstances\tand\tto\trun\tunsafe\tVisual\tBasic\tfor\tApplication\tfunctions.",
    "audit": "Run\tthe\tfollowing\tT-SQL\tcommand: SELECT name, CAST(value as int) as value_configured, CAST(value_in_use as int) as value_in_use FROM sys.configurations WHERE name = 'Ad Hoc Distributed Queries'; Both\tvalue\tcolumns\tmust\tshow\t0.",
    "remediation": "Run\tthe\tfollowing\tT-SQL\tcommand: EXECUTE sp_configure 'show advanced options', 1; RECONFIGURE; EXECUTE sp_configure 'Ad Hoc Distributed Queries', 0; RECONFIGURE; GO  14\t|\tP a g e EXECUTE sp_configure 'show advanced options', 0; RECONFIGURE; Default\tValue: 0\t(disabled) References: 1. https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/ad- hoc-distributed-queries-server-configuration-option CIS\tControls: Version\t6 9.1\tLimit\tOpen\tPorts,\tProtocols,\tand\tServices Ensure\tthat\tonly\tports,\tprotocols,\tand\tservices\twith\tvalidated\tbusiness\tneeds\tare\trunning on\teach\tsystem. Version\t7 9.2\tEnsure\tOnly\tApproved\tPorts,\tProtocols\tand\tServices\tAre\tRunning Ensure\tthat\tonly\tnetwork\tports,\tprotocols,\tand\tservices\tlistening\ton\ta\tsystem\twith validated\tbusiness\tneeds,\tare\trunning\ton\teach\tsystem.  15\t|\tP a g e",
    "function_names": [
      "sql_server_ad_hoc_distributed_queries_disabled",
      "sql_server_distributed_queries_restricted",
      "sql_server_ad_hoc_queries_disabled",
      "sql_server_external_data_access_disabled",
      "sql_server_remote_query_disabled"
    ],
    "references": "1. https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/ad- hoc-distributed-queries-server-configuration-option CIS\tControls: Version\t6 9.1\tLimit\tOpen\tPorts,\tProtocols,\tand\tServices Ensure\tthat\tonly\tports,\tprotocols,\tand\tservices\twith\tvalidated\tbusiness\tneeds\tare\trunning on\teach\tsystem. Version\t7 9.2\tEnsure\tOnly\tApproved\tPorts,\tProtocols\tand\tServices\tAre\tRunning Ensure\tthat\tonly\tnetwork\tports,\tprotocols,\tand\tservices\tlistening\ton\ta\tsystem\twith validated\tbusiness\tneeds,\tare\trunning\ton\teach\tsystem.  15\t|\tP a g e"
  },
  {
    "id": "2.2",
    "title": "Ensure 'CLR Enabled' Server Configuration Option is set to '0'",
    "assessment": "Scored",
    "description": "The\tclr enabled\toption\tspecifies\twhether\tuser\tassemblies\tcan\tbe\trun\tby\tSQL\tServer.",
    "rationale": "Enabling\tuse\tof\tCLR\tassemblies\twidens\tthe\tattack\tsurface\tof\tSQL\tServer\tand\tputs\tit\tat\trisk from\tboth\tinadvertent\tand\tmalicious\tassemblies.",
    "audit": "Run\tthe\tfollowing\tT-SQL\tcommand: SELECT name, CAST(value as int) as value_configured, CAST(value_in_use as int) as value_in_use FROM sys.configurations WHERE name = 'clr enabled'; Both\tvalue\tcolumns\tmust\tshow\t0.",
    "remediation": "Run\tthe\tfollowing\tT-SQL\tcommand: EXECUTE sp_configure 'clr enabled', 0; RECONFIGURE; Impact: If\tCLR\tassemblies\tare\tin\tuse,\tapplications\tmay\tneed\tto\tbe\trearchitected\tto\teliminate\ttheir usage\tbefore\tdisabling\tthis\tsetting.\tAlternatively,\tsome\torganizations\tmay\tallow\tthis\tsetting to\tbe\tenabled\t1\tfor\tassemblies\tcreated\twith\tthe\tSAFE\tpermission\tset,\tbut\tdisallow assemblies\tcreated\twith\tthe\triskier\tUNSAFE\tand\tEXTERNAL_ACCESS\tpermission\tsets.\tTo\tfind user-created\tassemblies,\trun\tthe\tfollowing\tquery\tin\tall\tdatabases,\treplacing <database_name> with\teach\tdatabase\tname: USE [ <database_name> ] GO SELECT name AS Assembly_Name, permission_set_desc FROM sys.assemblies  16\t|\tP a g e WHERE is_user_defined = 1; GO Default\tValue: By\tdefault,\tthis\toption\tis\tdisabled. References: 1. https://docs.microsoft.com/en-us/sql/t-sql/statements/create-assembly-transact- sql CIS\tControls: Version\t6 18.9\tSanitize\tDeployed\tSoftware\tOf\tDevelopment\tArtifacts For\tin-house\tdeveloped\tapplications,\tensure\tthat\tdevelopment\tartifacts\t(sample\tdata\tand scripts;\tunused\tlibraries,\tcomponents,\tdebug\tcode;\tor\ttools)\tare\tnot\tincluded\tin\tthe deployed\tsoftware,\tor\taccessible\tin\tthe\tproduction\tenvironment. Version\t7 18.11\tUse\tStandard\tHardening\tConfiguration\tTemplates\tfor\tDatabases For\tapplications\tthat\trely\ton\ta\tdatabase,\tuse\tstandard\thardening\tconfiguration\ttemplates. All\tsystems\tthat\tare\tpart\tof\tcritical\tbusiness\tprocesses\tshould\talso\tbe\ttested.  17\t|\tP a g e",
    "function_names": [
      "sql_server_clr_enabled_disabled",
      "sql_server_assembly_execution_disabled",
      "sql_server_clr_integration_disabled",
      "sql_server_user_assemblies_disabled",
      "sql_server_clr_configuration_disabled"
    ],
    "impact": "If\tCLR\tassemblies\tare\tin\tuse,\tapplications\tmay\tneed\tto\tbe\trearchitected\tto\teliminate\ttheir usage\tbefore\tdisabling\tthis\tsetting.\tAlternatively,\tsome\torganizations\tmay\tallow\tthis\tsetting to\tbe\tenabled\t1\tfor\tassemblies\tcreated\twith\tthe\tSAFE\tpermission\tset,\tbut\tdisallow assemblies\tcreated\twith\tthe\triskier\tUNSAFE\tand\tEXTERNAL_ACCESS\tpermission\tsets.\tTo\tfind user-created\tassemblies,\trun\tthe\tfollowing\tquery\tin\tall\tdatabases,\treplacing <database_name> with\teach\tdatabase\tname: USE [ <database_name> ] GO SELECT name AS Assembly_Name, permission_set_desc FROM sys.assemblies  16\t|\tP a g e WHERE is_user_defined = 1; GO Default\tValue: By\tdefault,\tthis\toption\tis\tdisabled.",
    "references": "1. https://docs.microsoft.com/en-us/sql/t-sql/statements/create-assembly-transact- sql CIS\tControls: Version\t6 18.9\tSanitize\tDeployed\tSoftware\tOf\tDevelopment\tArtifacts For\tin-house\tdeveloped\tapplications,\tensure\tthat\tdevelopment\tartifacts\t(sample\tdata\tand scripts;\tunused\tlibraries,\tcomponents,\tdebug\tcode;\tor\ttools)\tare\tnot\tincluded\tin\tthe deployed\tsoftware,\tor\taccessible\tin\tthe\tproduction\tenvironment. Version\t7 18.11\tUse\tStandard\tHardening\tConfiguration\tTemplates\tfor\tDatabases For\tapplications\tthat\trely\ton\ta\tdatabase,\tuse\tstandard\thardening\tconfiguration\ttemplates. All\tsystems\tthat\tare\tpart\tof\tcritical\tbusiness\tprocesses\tshould\talso\tbe\ttested.  17\t|\tP a g e"
  },
  {
    "id": "2.3",
    "title": "Ensure 'Cross DB Ownership Chaining' Server Configuration Option is set to '0'",
    "assessment": "Scored",
    "description": "The\tcross db ownership chaining\toption\tcontrols\tcross-database\townership\tchaining across\tall\tdatabases\tat\tthe\tinstance\t(or\tserver)\tlevel.",
    "rationale": "When\tenabled,\tthis\toption\tallows\ta\tmember\tof\tthe\tdb_owner\trole\tin\ta\tdatabase\tto\tgain access\tto\tobjects\towned\tby\ta\tlogin\tin\tany\tother\tdatabase,\tcausing\tan\tunnecessary information\tdisclosure.\tWhen\trequired,\tcross-database\townership\tchaining\tshould\tonly\tbe enabled\tfor\tthe\tspecific\tdatabases\trequiring\tit\tinstead\tof\tat\tthe\tinstance\tlevel\tfor\tall databases\tby\tusing\tthe\tALTER DATABASE <database_name> SET DB_CHAINING ON command.\tThis\tdatabase\toption\tmay\tnot\tbe\tchanged\ton\tthe\tmaster,\tmodel,\tor\ttempdb system\tdatabases.",
    "audit": "Run\tthe\tfollowing\tT-SQL\tcommand: SELECT name, CAST(value as int) as value_configured, CAST(value_in_use as int) as value_in_use FROM sys.configurations WHERE name = 'cross db ownership chaining'; Both\tvalue\tcolumns\tmust\tshow\t0\tto\tbe\tcompliant.",
    "remediation": "Run\tthe\tfollowing\tT-SQL\tcommand: EXECUTE sp_configure 'cross db ownership chaining', 0; RECONFIGURE; GO   18\t|\tP a g e Default\tValue: By\tdefault,\tthis\toption\tis\tdisabled\t(0). References: 1. https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/cross- db-ownership-chaining-server-configuration-option CIS\tControls: Version\t6 14.4\tProtect\tInformation\tWith\tAccess\tControl\tLists All\tinformation\tstored\ton\tsystems\tshall\tbe\tprotected\twith\tfile\tsystem,\tnetwork\tshare, claims,\tapplication,\tor\tdatabase\tspecific\taccess\tcontrol\tlists.\tThese\tcontrols\twill\tenforce\tthe principle\tthat\tonly\tauthorized\tindividuals\tshould\thave\taccess\tto\tthe\tinformation\tbased\ton their\tneed\tto\taccess\tthe\tinformation\tas\ta\tpart\tof\ttheir\tresponsibilities. Version\t7 14.6\tProtect\tInformation\tthrough\tAccess\tControl\tLists Protect\tall\tinformation\tstored\ton\tsystems\twith\tfile\tsystem,\tnetwork\tshare,\tclaims, application,\tor\tdatabase\tspecific\taccess\tcontrol\tlists.\tThese\tcontrols\twill\tenforce\tthe principle\tthat\tonly\tauthorized\tindividuals\tshould\thave\taccess\tto\tthe\tinformation\tbased\ton their\tneed\tto\taccess\tthe\tinformation\tas\ta\tpart\tof\ttheir\tresponsibilities.  19\t|\tP a g e",
    "function_names": [
      "sql_server_database_cross_ownership_chaining_disabled",
      "sql_server_instance_cross_db_chaining_disabled",
      "sql_server_configuration_cross_db_chaining_set_to_zero",
      "sql_server_security_cross_ownership_chaining_restricted",
      "sql_server_instance_cross_db_chaining_disabled_all_databases"
    ],
    "references": "1. https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/cross- db-ownership-chaining-server-configuration-option CIS\tControls: Version\t6 14.4\tProtect\tInformation\tWith\tAccess\tControl\tLists All\tinformation\tstored\ton\tsystems\tshall\tbe\tprotected\twith\tfile\tsystem,\tnetwork\tshare, claims,\tapplication,\tor\tdatabase\tspecific\taccess\tcontrol\tlists.\tThese\tcontrols\twill\tenforce\tthe principle\tthat\tonly\tauthorized\tindividuals\tshould\thave\taccess\tto\tthe\tinformation\tbased\ton their\tneed\tto\taccess\tthe\tinformation\tas\ta\tpart\tof\ttheir\tresponsibilities. Version\t7 14.6\tProtect\tInformation\tthrough\tAccess\tControl\tLists Protect\tall\tinformation\tstored\ton\tsystems\twith\tfile\tsystem,\tnetwork\tshare,\tclaims, application,\tor\tdatabase\tspecific\taccess\tcontrol\tlists.\tThese\tcontrols\twill\tenforce\tthe principle\tthat\tonly\tauthorized\tindividuals\tshould\thave\taccess\tto\tthe\tinformation\tbased\ton their\tneed\tto\taccess\tthe\tinformation\tas\ta\tpart\tof\ttheir\tresponsibilities.  19\t|\tP a g e"
  },
  {
    "id": "2.4",
    "title": "Ensure 'Database Mail XPs' Server Configuration Option is set to '0'",
    "assessment": "Scored",
    "description": "The\tDatabase Mail XPs\toption\tcontrols\tthe\tability\tto\tgenerate\tand\ttransmit\temail messages\tfrom\tSQL\tServer.",
    "rationale": "Disabling\tthe\tDatabase Mail XPs\toption\treduces\tthe\tSQL\tServer\tsurface,\teliminates\ta\tDOS attack\tvector\tand\tchannel\tto\texfiltrate\tdata\tfrom\tthe\tdatabase\tserver\tto\ta\tremote\thost.",
    "audit": "Run\tthe\tfollowing\tT-SQL\tcommand: SELECT name, CAST(value as int) as value_configured, CAST(value_in_use as int) as value_in_use FROM sys.configurations WHERE name = 'Database Mail XPs'; Both\tvalue\tcolumns\tmust\tshow\t0\tto\tbe\tcompliant.",
    "remediation": "Run\tthe\tfollowing\tT-SQL\tcommand: EXECUTE sp_configure 'show advanced options', 1; RECONFIGURE; EXECUTE sp_configure 'Database Mail XPs', 0; RECONFIGURE; GO EXECUTE sp_configure 'show advanced options', 0; RECONFIGURE; Default\tValue: By\tdefault,\tthis\toption\tis\tdisabled\t(0).  20\t|\tP a g e References: 1. https://docs.microsoft.com/en-us/sql/relational-databases/database- mail/database-mail CIS\tControls: Version\t6 18\tApplication\tSoftware\tSecurity Application\tSoftware\tSecurity Version\t7 9.2\tEnsure\tOnly\tApproved\tPorts,\tProtocols\tand\tServices\tAre\tRunning Ensure\tthat\tonly\tnetwork\tports,\tprotocols,\tand\tservices\tlistening\ton\ta\tsystem\twith validated\tbusiness\tneeds,\tare\trunning\ton\teach\tsystem.  21\t|\tP a g e",
    "function_names": [
      "sql_server_database_mail_xps_disabled",
      "sql_server_database_mail_xps_set_to_0",
      "sql_server_database_mail_xps_config_disabled",
      "sql_server_database_mail_xps_option_disabled",
      "sql_server_database_mail_xps_feature_disabled"
    ],
    "references": "1. https://docs.microsoft.com/en-us/sql/relational-databases/database- mail/database-mail CIS\tControls: Version\t6 18\tApplication\tSoftware\tSecurity Application\tSoftware\tSecurity Version\t7 9.2\tEnsure\tOnly\tApproved\tPorts,\tProtocols\tand\tServices\tAre\tRunning Ensure\tthat\tonly\tnetwork\tports,\tprotocols,\tand\tservices\tlistening\ton\ta\tsystem\twith validated\tbusiness\tneeds,\tare\trunning\ton\teach\tsystem.  21\t|\tP a g e"
  },
  {
    "id": "2.5",
    "title": "Ensure 'Ole Automation Procedures' Server Configuration Option is set to '0'",
    "assessment": "Scored",
    "description": "The\tOle Automation Procedures\toption\tcontrols\twhether\tOLE\tAutomation\tobjects\tcan\tbe instantiated\twithin\tTransact-SQL\tbatches.\tThese\tare\textended\tstored\tprocedures\tthat\tallow SQL\tServer\tusers\tto\texecute\tfunctions\texternal\tto\tSQL\tServer.",
    "rationale": "Enabling\tthis\toption\twill\tincrease\tthe\tattack\tsurface\tof\tSQL\tServer\tand\tallow\tusers\tto execute\tfunctions\tin\tthe\tsecurity\tcontext\tof\tSQL\tServer.",
    "audit": "Run\tthe\tfollowing\tT-SQL\tcommand: SELECT name, CAST(value as int) as value_configured, CAST(value_in_use as int) as value_in_use FROM sys.configurations WHERE name = 'Ole Automation Procedures'; Both\tvalue\tcolumns\tmust\tshow\t0\tto\tbe\tcompliant.",
    "remediation": "Run\tthe\tfollowing\tT-SQL\tcommand: EXECUTE sp_configure 'show advanced options', 1; RECONFIGURE; EXECUTE sp_configure 'Ole Automation Procedures', 0; RECONFIGURE; GO EXECUTE sp_configure 'show advanced options', 0; RECONFIGURE; Default\tValue: By\tdefault,\tthis\toption\tis\tdisabled\t(0).  22\t|\tP a g e References: 1. https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/ole- automation-procedures-server-configuration-option CIS\tControls: Version\t6 18\tApplication\tSoftware\tSecurity Application\tSoftware\tSecurity Version\t7 5.1\tEstablish\tSecure\tConfigurations Maintain\tdocumented,\tstandard\tsecurity\tconfiguration\tstandards\tfor\tall\tauthorized operating\tsystems\tand\tsoftware.  23\t|\tP a g e",
    "function_names": [
      "sql_server_ole_automation_disabled",
      "sql_server_ole_automation_procedures_disabled",
      "sql_server_ole_automation_config_zero",
      "sql_server_ole_automation_setting_disabled",
      "sql_server_ole_automation_option_disabled"
    ],
    "references": "1. https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/ole- automation-procedures-server-configuration-option CIS\tControls: Version\t6 18\tApplication\tSoftware\tSecurity Application\tSoftware\tSecurity Version\t7 5.1\tEstablish\tSecure\tConfigurations Maintain\tdocumented,\tstandard\tsecurity\tconfiguration\tstandards\tfor\tall\tauthorized operating\tsystems\tand\tsoftware.  23\t|\tP a g e"
  },
  {
    "id": "2.6",
    "title": "Ensure 'Remote Access' Server Configuration Option is set to '0'",
    "assessment": "Scored",
    "description": "The\tremote access\toption\tcontrols\tthe\texecution\tof\tlocal\tstored\tprocedures\ton\tremote servers\tor\tremote\tstored\tprocedures\ton\tlocal\tserver.",
    "rationale": "Functionality\tcan\tbe\tabused\tto\tlaunch\ta\tDenial-of-Service\t(DoS)\tattack\ton\tremote\tservers by\toff-loading\tquery\tprocessing\tto\ta\ttarget.",
    "audit": "Run\tthe\tfollowing\tT-SQL\tcommand: SELECT name, CAST(value as int) as value_configured, CAST(value_in_use as int) as value_in_use FROM sys.configurations WHERE name = 'remote access'; Both\tvalue\tcolumns\tmust\tshow\t0.",
    "remediation": "Run\tthe\tfollowing\tT-SQL\tcommand: EXECUTE sp_configure 'show advanced options', 1; RECONFIGURE; EXECUTE sp_configure 'remote access', 0; RECONFIGURE; GO EXECUTE sp_configure 'show advanced options', 0; RECONFIGURE; Restart\tthe\tDatabase\tEngine.  24\t|\tP a g e Default\tValue: By\tdefault,\tthis\toption\tis\tenabled\t(1). References: 1. https://docs.microsoft.com/en-us/sql/database-engine/configure- windows/configure-the-remote-access-server-configuration-option CIS\tControls: Version\t6 9.1\tLimit\tOpen\tPorts,\tProtocols,\tand\tServices Ensure\tthat\tonly\tports,\tprotocols,\tand\tservices\twith\tvalidated\tbusiness\tneeds\tare\trunning on\teach\tsystem. Version\t7 9.2\tEnsure\tOnly\tApproved\tPorts,\tProtocols\tand\tServices\tAre\tRunning Ensure\tthat\tonly\tnetwork\tports,\tprotocols,\tand\tservices\tlistening\ton\ta\tsystem\twith validated\tbusiness\tneeds,\tare\trunning\ton\teach\tsystem.  25\t|\tP a g e",
    "function_names": [
      "sql_server_remote_access_disabled",
      "sql_server_remote_access_set_to_zero",
      "sql_server_remote_access_restricted",
      "sql_server_remote_access_secure_config",
      "sql_server_remote_access_procedure_disabled"
    ],
    "references": "1. https://docs.microsoft.com/en-us/sql/database-engine/configure- windows/configure-the-remote-access-server-configuration-option CIS\tControls: Version\t6 9.1\tLimit\tOpen\tPorts,\tProtocols,\tand\tServices Ensure\tthat\tonly\tports,\tprotocols,\tand\tservices\twith\tvalidated\tbusiness\tneeds\tare\trunning on\teach\tsystem. Version\t7 9.2\tEnsure\tOnly\tApproved\tPorts,\tProtocols\tand\tServices\tAre\tRunning Ensure\tthat\tonly\tnetwork\tports,\tprotocols,\tand\tservices\tlistening\ton\ta\tsystem\twith validated\tbusiness\tneeds,\tare\trunning\ton\teach\tsystem.  25\t|\tP a g e"
  },
  {
    "id": "2.7",
    "title": "Ensure 'Remote Admin Connections' Server Configuration Option is set to '0'",
    "assessment": "Scored",
    "description": "The\tremote admin connections\toption\tcontrols\twhether\ta\tclient\tapplication\ton\ta\tremote computer\tcan\tuse\tthe\tDedicated\tAdministrator\tConnection\t(DAC).",
    "rationale": "The\tDedicated\tAdministrator\tConnection\t(DAC)\tlets\tan\tadministrator\taccess\ta\trunning server\tto\texecute\tdiagnostic\tfunctions\tor\tTransact-SQL\tstatements,\tor\tto\ttroubleshoot problems\ton\tthe\tserver,\teven\twhen\tthe\tserver\tis\tlocked\tor\trunning\tin\tan\tabnormal\tstate and\tnot\tresponding\tto\ta\tSQL\tServer\tDatabase\tEngine\tconnection.\tIn\ta\tcluster\tscenario,\tthe administrator\tmay\tnot\tactually\tbe\tlogged\ton\tto\tthe\tsame\tnode\tthat\tis\tcurrently\thosting\tthe SQL\tServer\tinstance\tand\tthus\tis\tconsidered\t\"remote\".\tTherefore,\tthis\tsetting\tshould\tusually be\tenabled\t(1)\tfor\tSQL\tServer\tfailover\tclusters;\totherwise\tit\tshould\tbe\tdisabled\t(0)\twhich\tis the\tdefault.",
    "audit": "Run\tthe\tfollowing\tT-SQL\tcommand: USE master; GO SELECT name, CAST(value as int) as value_configured, CAST(value_in_use as int) as value_in_use FROM sys.configurations WHERE name = 'remote admin connections' AND SERVERPROPERTY('IsClustered') = 0; If\tno\tdata\tis\treturned,\tthe\tinstance\tis\ta\tcluster\tand\tthis\trecommendation\tis\tnot\tapplicable.\tIf data\tis\treturned,\tthen\tboth\tthe\tvalue\tcolumns\tmust\tshow\t0\tto\tbe\tcompliant.  26\t|\tP a g e",
    "remediation": "Run\tthe\tfollowing\tT-SQL\tcommand\ton\tnon-clustered\tinstallations: EXECUTE sp_configure 'remote admin connections', 0; RECONFIGURE; GO Default\tValue: By\tdefault,\tthis\toption\tis\tdisabled\t(0),\tonly\tlocal\tconnections\tmay\tuse\tthe\tDAC. References: 1. https://docs.microsoft.com/en-us/sql/database-engine/configure- windows/remote-admin-connections-server-configuration-option Notes: If\tit's\ta\tclustered\tinstallation,\tit\tmust\tbe\tenabled\tas\ta\tclustered\tSQL\tServer\tcannot\tbind\tto localhost\tand\tDAC\twill\tbe\tunavailable\totherwise.\tEnable\tit\tfor\tclustered\tinstallations. Disable\tit\tfor\tstandalone\tinstallations\twhere\tnot\trequired. CIS\tControls: Version\t6 9.1\tLimit\tOpen\tPorts,\tProtocols,\tand\tServices Ensure\tthat\tonly\tports,\tprotocols,\tand\tservices\twith\tvalidated\tbusiness\tneeds\tare\trunning on\teach\tsystem. Version\t7 9.2\tEnsure\tOnly\tApproved\tPorts,\tProtocols\tand\tServices\tAre\tRunning Ensure\tthat\tonly\tnetwork\tports,\tprotocols,\tand\tservices\tlistening\ton\ta\tsystem\twith validated\tbusiness\tneeds,\tare\trunning\ton\teach\tsystem.  27\t|\tP a g e",
    "function_names": [
      "sql_server_remote_admin_connections_disabled",
      "sql_server_dac_remote_access_disabled",
      "sql_server_admin_connections_restricted",
      "sql_server_remote_dac_disabled",
      "sql_server_admin_connections_local_only"
    ],
    "references": "1. https://docs.microsoft.com/en-us/sql/database-engine/configure- windows/remote-admin-connections-server-configuration-option Notes: If\tit's\ta\tclustered\tinstallation,\tit\tmust\tbe\tenabled\tas\ta\tclustered\tSQL\tServer\tcannot\tbind\tto localhost\tand\tDAC\twill\tbe\tunavailable\totherwise.\tEnable\tit\tfor\tclustered\tinstallations. Disable\tit\tfor\tstandalone\tinstallations\twhere\tnot\trequired. CIS\tControls: Version\t6 9.1\tLimit\tOpen\tPorts,\tProtocols,\tand\tServices Ensure\tthat\tonly\tports,\tprotocols,\tand\tservices\twith\tvalidated\tbusiness\tneeds\tare\trunning on\teach\tsystem. Version\t7 9.2\tEnsure\tOnly\tApproved\tPorts,\tProtocols\tand\tServices\tAre\tRunning Ensure\tthat\tonly\tnetwork\tports,\tprotocols,\tand\tservices\tlistening\ton\ta\tsystem\twith validated\tbusiness\tneeds,\tare\trunning\ton\teach\tsystem.  27\t|\tP a g e"
  },
  {
    "id": "2.8",
    "title": "Ensure 'Scan For Startup Procs' Server Configuration Option is set to '0'",
    "assessment": "Scored",
    "description": "The\tscan for startup procs\toption,\tif\tenabled,\tcauses\tSQL\tServer\tto\tscan\tfor\tand automatically\trun\tall\tstored\tprocedures\tthat\tare\tset\tto\texecute\tupon\tservice\tstartup.",
    "rationale": "Enforcing\tthis\tcontrol\treduces\tthe\tthreat\tof\tan\tentity\tleveraging\tthese\tfacilities\tfor malicious\tpurposes.",
    "audit": "Run\tthe\tfollowing\tT-SQL\tcommand: SELECT name, CAST(value as int) as value_configured, CAST(value_in_use as int) as value_in_use FROM sys.configurations WHERE name = 'scan for startup procs'; Both\tvalue\tcolumns\tmust\tshow\t0.",
    "remediation": "Run\tthe\tfollowing\tT-SQL\tcommand: EXECUTE sp_configure 'show advanced options', 1; RECONFIGURE; EXECUTE sp_configure 'scan for startup procs', 0; RECONFIGURE; GO EXECUTE sp_configure 'show advanced options', 0; RECONFIGURE; Restart\tthe\tDatabase\tEngine.  28\t|\tP a g e Impact: Setting\tScan\tfor\tStartup\tProcedures\tto\t0\twill\tprevent\tcertain\taudit\ttraces\tand\tother commonly\tused\tmonitoring\tSPs\tfrom\tre-starting\ton\tstart\tup.\tAdditionally,\treplication requires\tthis\tsetting\tto\tbe\tenabled\t(1)\tand\twill\tautomatically\tchange\tthis\tsetting\tif\tneeded. Default\tValue: By\tdefault,\tthis\toption\tis\tdisabled\t(0). References: 1. https://docs.microsoft.com/en-us/sql/database-engine/configure- windows/configure-the-scan-for-startup-procs-server-configuration-option CIS\tControls: Version\t6 18\tApplication\tSoftware\tSecurity Application\tSoftware\tSecurity Version\t7 5.1\tEstablish\tSecure\tConfigurations Maintain\tdocumented,\tstandard\tsecurity\tconfiguration\tstandards\tfor\tall\tauthorized operating\tsystems\tand\tsoftware.  29\t|\tP a g e",
    "function_names": [
      "sql_server_startup_procs_scan_disabled",
      "sql_server_startup_procs_scan_set_to_zero",
      "sql_server_startup_procs_auto_execute_disabled",
      "sql_server_startup_procs_scan_config_disabled",
      "sql_server_startup_procs_scan_setting_zero"
    ],
    "impact": "Setting\tScan\tfor\tStartup\tProcedures\tto\t0\twill\tprevent\tcertain\taudit\ttraces\tand\tother commonly\tused\tmonitoring\tSPs\tfrom\tre-starting\ton\tstart\tup.\tAdditionally,\treplication requires\tthis\tsetting\tto\tbe\tenabled\t(1)\tand\twill\tautomatically\tchange\tthis\tsetting\tif\tneeded. Default\tValue: By\tdefault,\tthis\toption\tis\tdisabled\t(0).",
    "references": "1. https://docs.microsoft.com/en-us/sql/database-engine/configure- windows/configure-the-scan-for-startup-procs-server-configuration-option CIS\tControls: Version\t6 18\tApplication\tSoftware\tSecurity Application\tSoftware\tSecurity Version\t7 5.1\tEstablish\tSecure\tConfigurations Maintain\tdocumented,\tstandard\tsecurity\tconfiguration\tstandards\tfor\tall\tauthorized operating\tsystems\tand\tsoftware.  29\t|\tP a g e"
  },
  {
    "id": "2.9",
    "title": "Ensure 'Trustworthy' Database Property is set to 'Off'",
    "assessment": "Scored",
    "description": "The\tTRUSTWORTHY\tdatabase\toption\tallows\tdatabase\tobjects\tto\taccess\tobjects\tin\tother databases\tunder\tcertain\tcircumstances.",
    "rationale": "Provides\tprotection\tfrom\tmalicious\tCLR\tassemblies\tor\textended\tprocedures.",
    "audit": "Run\tthe\tfollowing\tT-SQL\tquery\tto\tlist\tany\tdatabases\twith\ta\tTrustworthy\tdatabase\tproperty value\tof\tON: SELECT name FROM sys.databases WHERE is_trustworthy_on = 1 AND name != 'msdb'; No\trows\tshould\tbe\treturned.",
    "remediation": "Execute\tthe\tfollowing\tT-SQL\tstatement\tagainst\tthe\tdatabases\t(replace <database_name> below)\treturned\tby\tthe\tAudit\tProcedure: ALTER DATABASE [ <database_name> ] SET TRUSTWORTHY OFF; Default\tValue: By\tdefault,\tthis\tdatabase\tproperty\tis\tOFF\t(is_trustworthy_on = 0),\texcept\tfor\tthe\tmsdb database\tin\twhich\tit\tis\trequired\tto\tbe\tON. References: 1. https://docs.microsoft.com/en-us/sql/relational-databases/security/trustworthy- database-property 2. https://support.microsoft.com/it-it/help/2183687/guidelines-for-using-the- trustworthy-database-setting-in-sql-server  30\t|\tP a g e CIS\tControls: Version\t6 14.4\tProtect\tInformation\tWith\tAccess\tControl\tLists All\tinformation\tstored\ton\tsystems\tshall\tbe\tprotected\twith\tfile\tsystem,\tnetwork\tshare, claims,\tapplication,\tor\tdatabase\tspecific\taccess\tcontrol\tlists.\tThese\tcontrols\twill\tenforce\tthe principle\tthat\tonly\tauthorized\tindividuals\tshould\thave\taccess\tto\tthe\tinformation\tbased\ton their\tneed\tto\taccess\tthe\tinformation\tas\ta\tpart\tof\ttheir\tresponsibilities. Version\t7 14.6\tProtect\tInformation\tthrough\tAccess\tControl\tLists Protect\tall\tinformation\tstored\ton\tsystems\twith\tfile\tsystem,\tnetwork\tshare,\tclaims, application,\tor\tdatabase\tspecific\taccess\tcontrol\tlists.\tThese\tcontrols\twill\tenforce\tthe principle\tthat\tonly\tauthorized\tindividuals\tshould\thave\taccess\tto\tthe\tinformation\tbased\ton their\tneed\tto\taccess\tthe\tinformation\tas\ta\tpart\tof\ttheir\tresponsibilities.  31\t|\tP a g e",
    "function_names": [
      "sql_server_database_trustworthy_disabled",
      "sql_server_database_trustworthy_property_off",
      "sql_database_trustworthy_setting_disabled",
      "sql_database_trustworthy_access_restricted",
      "sql_server_trustworthy_property_off"
    ],
    "references": "1. https://docs.microsoft.com/en-us/sql/relational-databases/security/trustworthy- database-property 2. https://support.microsoft.com/it-it/help/2183687/guidelines-for-using-the- trustworthy-database-setting-in-sql-server  30\t|\tP a g e CIS\tControls: Version\t6 14.4\tProtect\tInformation\tWith\tAccess\tControl\tLists All\tinformation\tstored\ton\tsystems\tshall\tbe\tprotected\twith\tfile\tsystem,\tnetwork\tshare, claims,\tapplication,\tor\tdatabase\tspecific\taccess\tcontrol\tlists.\tThese\tcontrols\twill\tenforce\tthe principle\tthat\tonly\tauthorized\tindividuals\tshould\thave\taccess\tto\tthe\tinformation\tbased\ton their\tneed\tto\taccess\tthe\tinformation\tas\ta\tpart\tof\ttheir\tresponsibilities. Version\t7 14.6\tProtect\tInformation\tthrough\tAccess\tControl\tLists Protect\tall\tinformation\tstored\ton\tsystems\twith\tfile\tsystem,\tnetwork\tshare,\tclaims, application,\tor\tdatabase\tspecific\taccess\tcontrol\tlists.\tThese\tcontrols\twill\tenforce\tthe principle\tthat\tonly\tauthorized\tindividuals\tshould\thave\taccess\tto\tthe\tinformation\tbased\ton their\tneed\tto\taccess\tthe\tinformation\tas\ta\tpart\tof\ttheir\tresponsibilities.  31\t|\tP a g e"
  },
  {
    "id": "2.10",
    "title": "Ensure Unnecessary SQL Server Protocols are set to 'Disabled'",
    "assessment": "Not Scored",
    "description": "SQL\tServer\tsupports\tShared\tMemory,\tNamed\tPipes,\tTCP/IP\tand\tVIA\tprotocols.\tHowever, SQL\tServer\tshould\tbe\tconfigured\tto\tuse\tthe\tbare\tminimum\trequired\tbased\ton\tthe organization's\tneeds.",
    "rationale": "Using\tfewer\tprotocols\tminimizes\tthe\tattack\tsurface\tof\tSQL\tServer\tand,\tin\tsome\tcases,\tcan protect\tit\tfrom\tremote\tattacks.",
    "audit": "Open SQL\tServer\tConfiguration\tManager ;\tgo\tto\tthe SQL\tServer\tNetwork\tConfiguration . Ensure\tthat\tonly\trequired\tprotocols\tare\tenabled.",
    "remediation": "Open SQL\tServer\tConfiguration\tManager ;\tgo\tto\tthe SQL\tServer\tNetwork\tConfiguration . Ensure\tthat\tonly\trequired\tprotocols\tare\tenabled.\tDisable\tprotocols\tnot\tnecessary. Impact: The\tDatabase\tEngine\tmust\tbe\tstopped\tand\trestarted\tfor\tthe\tchange\tto\ttake\teffect. Default\tValue: By\tdefault,\tTCP/IP\tand\tShared\tMemory\tprotocols\tare\tenabled\ton\tall\tcommercial\teditions. References: 1. https://docs.microsoft.com/en-us/sql/database-engine/configure- windows/enable-or-disable-a-server-network-protocol   32\t|\tP a g e CIS\tControls: Version\t6 9.1\tLimit\tOpen\tPorts,\tProtocols,\tand\tServices Ensure\tthat\tonly\tports,\tprotocols,\tand\tservices\twith\tvalidated\tbusiness\tneeds\tare\trunning on\teach\tsystem. Version\t7 9.2\tEnsure\tOnly\tApproved\tPorts,\tProtocols\tand\tServices\tAre\tRunning Ensure\tthat\tonly\tnetwork\tports,\tprotocols,\tand\tservices\tlistening\ton\ta\tsystem\twith validated\tbusiness\tneeds,\tare\trunning\ton\teach\tsystem.  33\t|\tP a g e",
    "function_names": [
      "sql_server_protocol_shared_memory_disabled",
      "sql_server_protocol_named_pipes_disabled",
      "sql_server_protocol_tcp_ip_enabled",
      "sql_server_protocol_via_disabled",
      "sql_server_protocol_unnecessary_disabled_all",
      "sql_server_protocol_minimal_enabled_only"
    ],
    "impact": "The\tDatabase\tEngine\tmust\tbe\tstopped\tand\trestarted\tfor\tthe\tchange\tto\ttake\teffect. Default\tValue: By\tdefault,\tTCP/IP\tand\tShared\tMemory\tprotocols\tare\tenabled\ton\tall\tcommercial\teditions.",
    "references": "1. https://docs.microsoft.com/en-us/sql/database-engine/configure- windows/enable-or-disable-a-server-network-protocol   32\t|\tP a g e CIS\tControls: Version\t6 9.1\tLimit\tOpen\tPorts,\tProtocols,\tand\tServices Ensure\tthat\tonly\tports,\tprotocols,\tand\tservices\twith\tvalidated\tbusiness\tneeds\tare\trunning on\teach\tsystem. Version\t7 9.2\tEnsure\tOnly\tApproved\tPorts,\tProtocols\tand\tServices\tAre\tRunning Ensure\tthat\tonly\tnetwork\tports,\tprotocols,\tand\tservices\tlistening\ton\ta\tsystem\twith validated\tbusiness\tneeds,\tare\trunning\ton\teach\tsystem.  33\t|\tP a g e"
  },
  {
    "id": "2.11",
    "title": "Ensure SQL Server is configured to use non-standard ports",
    "assessment": "Not Scored",
    "description": "If\tenabled,\tthe\tdefault\tSQL\tServer\tinstance\twill\tbe\tassigned\ta\tdefault\tport\tof\tTCP:1433\tfor TCP/IP\tcommunication.\tAdministrators\tcan\talso\tconfigure\tnamed\tinstances\tto\tuse TCP:1433\tfor\tcommunication.\tTCP:1433\tis\ta\twidely\tknown\tSQL\tServer\tport\tand\tthis\tport assignment\tshould\tbe\tchanged.",
    "rationale": "Using\ta\tnon-default\tport\thelps\tprotect\tthe\tdatabase\tfrom\tattacks\tdirected\tto\tthe\tdefault port.",
    "audit": "Run\tthe\tfollowing\tT-SQL\tscript: DECLARE @value nvarchar(256); EXECUTE master.dbo.xp_instance_regread N'HKEY_LOCAL_MACHINE', N'SOFTWARE\\Microsoft\\Microsoft SQL Server\\MSSQLServer\\SuperSocketNetLib\\Tcp\\IPAll', N'TcpPort', @value OUTPUT, N'no_output'; SELECT @value AS TCP_Port WHERE @value = '1433'; This\tshould\treturn\tno\trows.",
    "remediation": "1. In SQL\tServer\tConfiguration\tManager ,\tin\tthe\tconsole\tpane,\texpand SQL\tServer Network\tConfiguration ,\texpand\tProtocols\tfor <InstanceName> ,\tand\tthen\tdouble- click\tthe\tTCP/IP\tor\tVIA\tprotocol 2. In\tthe TCP/IP\tProperties dialog\tbox,\ton\tthe IP\tAddresses tab,\tseveral\tIP\taddresses appear\tin\tthe\tformat\tIP1,\tIP2,\tup\tto\tIPAll.\tOne\tof\tthese\tis\tfor\tthe\tIP\taddress\tof\tthe  34\t|\tP a g e loopback\tadapter,\t127.0.0.1.\tAdditional\tIP\taddresses\tappear\tfor\teach\tIP\tAddress\ton the\tcomputer 3. Change\tthe TCP\tPort field\tfrom\t1433\tto\tanother\tnon-standard\tport\tor\tleave\tthe TCP Port field\tempty\tand\tset\tthe TCP\tDynamic\tPorts value\tto\t0\tto\tenable\tdynamic\tport assignment\tand\tthen\tclick OK . 4. In\tthe\tconsole\tpane,\tclick\tSQL\tServer\tServices. 5. In\tthe\tdetails\tpane,\tright-click SQL\tServer\t( <InstanceName> ) and\tthen\tclick Restart ,\tto\tstop\tand\trestart\tSQL\tServer. Impact: Changing\tthe\tdefault\tport\twill\tforce\tthe\tDAC\t(Dedicated\tAdministrator\tConnection)\tto listen\ton\ta\trandom\tport.\tAlso,\tit\tmight\tmake\tbenign\tapplications,\tsuch\tas\tapplication firewalls,\trequire\tspecial\tconfiguration.\tIn\tgeneral,\tyou\tshould\tset\ta\tstatic\tport\tfor consistent\tusage\tby\tapplications,\tincluding\tfirewalls,\tinstead\tof\tusing\tdynamic\tports\twhich will\tbe\tchosen\trandomly\tat\teach\tSQL\tServer\tstart\tup. Default\tValue: By\tdefault,\tdefault\tSQL\tServer\tinstances\tlisten\ton\tto\tTCP/IP\ttraffic\ton\tTCP\tport\t1433\tand named\tinstances\tuse\tdynamic\tports. References: 1. https://docs.microsoft.com/en-us/sql/database-engine/configure- windows/configure-a-server-to-listen-on-a-specific-tcp-port Notes: In\tthe\tcase\tof\tAWS\tRDS,\tthis\tis\tonly\tconfigurable\tduring\tthe\tbuild\tprocess. CIS\tControls: Version\t6 9\tLimitation\tand\tControl\tof\tNetwork\tPorts,\tProtocols,\tand\tServices Limitation\tand\tControl\tof\tNetwork\tPorts,\tProtocols,\tand\tServices Version\t7 9.2\tEnsure\tOnly\tApproved\tPorts,\tProtocols\tand\tServices\tAre\tRunning Ensure\tthat\tonly\tnetwork\tports,\tprotocols,\tand\tservices\tlistening\ton\ta\tsystem\twith validated\tbusiness\tneeds,\tare\trunning\ton\teach\tsystem.  35\t|\tP a g e",
    "function_names": [
      "sql_server_instance_non_standard_port",
      "sql_server_instance_default_port_disabled",
      "sql_server_instance_tcp_port_1433_disabled",
      "sql_server_instance_custom_port_assigned",
      "sql_server_instance_named_instance_non_standard_port",
      "sql_server_instance_tcp_ip_port_changed",
      "sql_server_instance_well_known_port_avoided"
    ],
    "references": "1. https://docs.microsoft.com/en-us/sql/database-engine/configure- windows/configure-a-server-to-listen-on-a-specific-tcp-port Notes: In\tthe\tcase\tof\tAWS\tRDS,\tthis\tis\tonly\tconfigurable\tduring\tthe\tbuild\tprocess. CIS\tControls: Version\t6 9\tLimitation\tand\tControl\tof\tNetwork\tPorts,\tProtocols,\tand\tServices Limitation\tand\tControl\tof\tNetwork\tPorts,\tProtocols,\tand\tServices Version\t7 9.2\tEnsure\tOnly\tApproved\tPorts,\tProtocols\tand\tServices\tAre\tRunning Ensure\tthat\tonly\tnetwork\tports,\tprotocols,\tand\tservices\tlistening\ton\ta\tsystem\twith validated\tbusiness\tneeds,\tare\trunning\ton\teach\tsystem.  35\t|\tP a g e"
  },
  {
    "id": "2.12",
    "title": "Ensure 'Hide Instance' option is set to 'Yes' for Production SQL Server instances",
    "assessment": "Scored",
    "description": "Non-clustered\tSQL\tServer\tinstances\twithin\tproduction\tenvironments\tshould\tbe\tdesignated as\thidden\tto\tprevent\tadvertisement\tby\tthe\tSQL\tServer\tBrowser\tservice.",
    "rationale": "Designating\tproduction\tSQL\tServer\tinstances\tas\thidden\tleads\tto\ta\tmore\tsecure\tinstallation because\tthey\tcannot\tbe\tenumerated.\tHowever,\tclustered\tinstances\tmay\tbreak\tif\tthis\toption is\tselected.",
    "audit": "Perform\teither\tthe\tGUI\tor\tT-SQL\tmethod\tshown: GUI\tMethod 1. In SQL\tServer\tConfiguration\tManager ,\texpand SQL\tServer\tNetwork Configuration ,\tright-click Protocols\tfor <server\tinstance> ,\tand\tthen\tselect Properties . 2. On\tthe Flags tab,\tin\tthe Hide\tInstance box,\tverify\tYes\tis\tselected. T-SQL\tMethod Execute\tthe\tfollowing\tT-SQL.\tA\tvalue\tof\t1\tshould\tbe\treturned. DECLARE @getValue INT; EXEC master.sys.xp_instance_regread @rootkey = N'HKEY_LOCAL_MACHINE', @key = N'SOFTWARE\\Microsoft\\Microsoft SQL Server\\MSSQLServer\\SuperSocketNetLib', @value_name = N'HideInstance', @value = @getValue OUTPUT; SELECT @getValue;   36\t|\tP a g e",
    "remediation": "Perform\teither\tthe\tGUI\tor\tT-SQL\tmethod\tshown: GUI\tMethod 1. In SQL\tServer\tConfiguration\tManager ,\texpand SQL\tServer\tNetwork Configuration ,\tright-click Protocols\tfor <server\tinstance> ,\tand\tthen\tselect Properties . 2. On\tthe Flags tab,\tin\tthe Hide\tInstance box,\tselect\tYes,\tand\tthen\tclick OK to\tclose\tthe dialog\tbox.\tThe\tchange\ttakes\teffect\timmediately\tfor\tnew\tconnections. T-SQL\tMethod Execute\tthe\tfollowing\tT-SQL\tto\tremediate: EXEC master.sys.xp_instance_regwrite @rootkey = N'HKEY_LOCAL_MACHINE', @key = N'SOFTWARE\\Microsoft\\Microsoft SQL Server\\MSSQLServer\\SuperSocketNetLib', @value_name = N'HideInstance', @type = N'REG_DWORD', @value = 1; Impact: This\tmethod\tonly\tprevents\tthe\tinstance\tfrom\tbeing\tlisted\ton\tthe\tnetwork.\tIf\tthe\tinstance\tis hidden\t(not\texposed\tby\tSQL\tBrowser),\tthen\tconnections\twill\tneed\tto\tspecify\tthe\tserver\tand port\tin\torder\tto\tconnect.\tIt\tdoes\tnot\tprevent\tusers\tfrom\tconnecting\tto\tserver\tif\tthey\tknow the\tinstance\tname\tand\tport. If\tyou\thide\ta\tclustered\tnamed\tinstance,\tthe\tcluster\tservice\tmay\tnot\tbe\table\tto\tconnect\tto\tthe SQL\tServer.\tPlease\trefer\tto\tthe\tMicrosoft\tdocumentation\treference. Default\tValue: By\tdefault,\tSQL\tServer\tinstances\tare\tnot\thidden. References: 1. http://msdn.microsoft.com/en-us/library/ms179327(v=sql.120).aspx  37\t|\tP a g e CIS\tControls: Version\t6 9\tLimitation\tand\tControl\tof\tNetwork\tPorts,\tProtocols,\tand\tServices Limitation\tand\tControl\tof\tNetwork\tPorts,\tProtocols,\tand\tServices Version\t7 9.2\tEnsure\tOnly\tApproved\tPorts,\tProtocols\tand\tServices\tAre\tRunning Ensure\tthat\tonly\tnetwork\tports,\tprotocols,\tand\tservices\tlistening\ton\ta\tsystem\twith validated\tbusiness\tneeds,\tare\trunning\ton\teach\tsystem.  38\t|\tP a g e",
    "function_names": [
      "sql_server_instance_hide_option_enabled",
      "sql_server_instance_production_hidden",
      "sql_server_instance_hide_instance_set_yes",
      "sql_server_instance_non_clustered_hidden",
      "sql_server_instance_browser_service_hidden"
    ],
    "impact": "This\tmethod\tonly\tprevents\tthe\tinstance\tfrom\tbeing\tlisted\ton\tthe\tnetwork.\tIf\tthe\tinstance\tis hidden\t(not\texposed\tby\tSQL\tBrowser),\tthen\tconnections\twill\tneed\tto\tspecify\tthe\tserver\tand port\tin\torder\tto\tconnect.\tIt\tdoes\tnot\tprevent\tusers\tfrom\tconnecting\tto\tserver\tif\tthey\tknow the\tinstance\tname\tand\tport. If\tyou\thide\ta\tclustered\tnamed\tinstance,\tthe\tcluster\tservice\tmay\tnot\tbe\table\tto\tconnect\tto\tthe SQL\tServer.\tPlease\trefer\tto\tthe\tMicrosoft\tdocumentation\treference. Default\tValue: By\tdefault,\tSQL\tServer\tinstances\tare\tnot\thidden.",
    "references": "1. http://msdn.microsoft.com/en-us/library/ms179327(v=sql.120).aspx  37\t|\tP a g e CIS\tControls: Version\t6 9\tLimitation\tand\tControl\tof\tNetwork\tPorts,\tProtocols,\tand\tServices Limitation\tand\tControl\tof\tNetwork\tPorts,\tProtocols,\tand\tServices Version\t7 9.2\tEnsure\tOnly\tApproved\tPorts,\tProtocols\tand\tServices\tAre\tRunning Ensure\tthat\tonly\tnetwork\tports,\tprotocols,\tand\tservices\tlistening\ton\ta\tsystem\twith validated\tbusiness\tneeds,\tare\trunning\ton\teach\tsystem.  38\t|\tP a g e"
  },
  {
    "id": "2.13",
    "title": "Ensure 'sa' Login Account is set to 'Disabled'",
    "assessment": "Scored",
    "description": "The\tsa\taccount\tis\ta\twidely\tknown\tand\toften\twidely\tused\tSQL\tServer\taccount\twith\tsysadmin privileges.\tThis\tis\tthe\toriginal\tlogin\tcreated\tduring\tinstallation\tand\talways\thas\tthe principal_id=1\tand\tsid=0x01.",
    "rationale": "Enforcing\tthis\tcontrol\treduces\tthe\tprobability\tof\tan\tattacker\texecuting\tbrute\tforce\tattacks against\ta\twell-known\tprincipal.",
    "audit": "Use\tthe\tfollowing\tsyntax\tto\tdetermine\tif\tthe\tsa\taccount\tis\tdisabled.\tChecking\tfor\tsid=0x01 ensures\tthat\tthe\toriginal\tsa\taccount\tis\tbeing\tchecked\tin\tcase\tit\thas\tbeen\trenamed\tper\tbest practices. SELECT name, is_disabled FROM sys.server_principals WHERE sid = 0x01 AND is_disabled = 0; No\trows\tshould\tbe\treturned\tto\tbe\tcompliant. An\tis_disabled\tvalue\tof\t0\tindicates\tthe\tlogin\tis\tcurrently\tenabled\tand\ttherefore\tneeds remediation.",
    "remediation": "Execute\tthe\tfollowing\tT-SQL\tquery: USE [master] GO DECLARE @tsql nvarchar(max) SET @tsql = 'ALTER LOGIN ' + SUSER_NAME(0x01) + ' DISABLE' EXEC (@tsql) GO   39\t|\tP a g e Impact: It\tis\tnot\ta\tgood\tsecurity\tpractice\tto\tcode\tapplications\tor\tscripts\tto\tuse\tthe\tsa\taccount. However,\tif\tthis\thas\tbeen\tdone,\tdisabling\tthe\tsa\taccount\twill\tprevent\tscripts\tand applications\tfrom\tauthenticating\tto\tthe\tdatabase\tserver\tand\texecuting\trequired\ttasks\tor functions. Default\tValue: By\tdefault,\tthe\tsa\tlogin\taccount\tis\tdisabled\tat\tinstall\ttime\twhen\tWindows\tAuthentication Mode\tis\tselected.\tIf\tmixed\tmode\t(SQL\tServer\tand\tWindows\tAuthentication)\tis\tselected\tat install,\tthe\tdefault\tfor\tthe\tsa\tlogin\tis\tenabled. References: 1. https://docs.microsoft.com/en-us/sql/relational-databases/system-catalog- views/sys-server-principals-transact-sql 2. https://docs.microsoft.com/en-us/sql/t-sql/statements/alter-login-transact-sql 3. https://docs.microsoft.com/en-us/sql/relational-databases/security/choose-an- authentication-mode Notes: In\tthe\tcase\tof\tAWS\tRDS\tthe\tdefault\tname\tfor\tthis\taccount\tis\trdsa\tinstead\tof\tsa. CIS\tControls: Version\t6 5.1\tMinimize\tAnd\tSparingly\tUse\tAdministrative\tPrivileges Minimize\tadministrative\tprivileges\tand\tonly\tuse\tadministrative\taccounts\twhen\tthey\tare required.\tImplement\tfocused\tauditing\ton\tthe\tuse\tof\tadministrative\tprivileged\tfunctions\tand monitor\tfor\tanomalous\tbehavior. Version\t7 16.8\tDisable\tAny\tUnassociated\tAccounts Disable\tany\taccount\tthat\tcannot\tbe\tassociated\twith\ta\tbusiness\tprocess\tor\tbusiness owner.  40\t|\tP a g e",
    "function_names": [
      "sql_server_login_account_disabled",
      "sql_server_sa_account_disabled",
      "sql_server_default_admin_disabled",
      "sql_server_builtin_admin_disabled",
      "sql_server_privileged_account_disabled",
      "sql_server_sysadmin_account_disabled",
      "sql_server_principal_id_1_disabled",
      "sql_server_sid_0x01_disabled"
    ],
    "impact": "It\tis\tnot\ta\tgood\tsecurity\tpractice\tto\tcode\tapplications\tor\tscripts\tto\tuse\tthe\tsa\taccount. However,\tif\tthis\thas\tbeen\tdone,\tdisabling\tthe\tsa\taccount\twill\tprevent\tscripts\tand applications\tfrom\tauthenticating\tto\tthe\tdatabase\tserver\tand\texecuting\trequired\ttasks\tor functions. Default\tValue: By\tdefault,\tthe\tsa\tlogin\taccount\tis\tdisabled\tat\tinstall\ttime\twhen\tWindows\tAuthentication Mode\tis\tselected.\tIf\tmixed\tmode\t(SQL\tServer\tand\tWindows\tAuthentication)\tis\tselected\tat install,\tthe\tdefault\tfor\tthe\tsa\tlogin\tis\tenabled.",
    "references": "1. https://docs.microsoft.com/en-us/sql/relational-databases/system-catalog- views/sys-server-principals-transact-sql 2. https://docs.microsoft.com/en-us/sql/t-sql/statements/alter-login-transact-sql 3. https://docs.microsoft.com/en-us/sql/relational-databases/security/choose-an- authentication-mode Notes: In\tthe\tcase\tof\tAWS\tRDS\tthe\tdefault\tname\tfor\tthis\taccount\tis\trdsa\tinstead\tof\tsa. CIS\tControls: Version\t6 5.1\tMinimize\tAnd\tSparingly\tUse\tAdministrative\tPrivileges Minimize\tadministrative\tprivileges\tand\tonly\tuse\tadministrative\taccounts\twhen\tthey\tare required.\tImplement\tfocused\tauditing\ton\tthe\tuse\tof\tadministrative\tprivileged\tfunctions\tand monitor\tfor\tanomalous\tbehavior. Version\t7 16.8\tDisable\tAny\tUnassociated\tAccounts Disable\tany\taccount\tthat\tcannot\tbe\tassociated\twith\ta\tbusiness\tprocess\tor\tbusiness owner.  40\t|\tP a g e"
  },
  {
    "id": "2.14",
    "title": "Ensure 'sa' Login Account has been renamed",
    "assessment": "Scored",
    "description": "The\tsa\taccount\tis\ta\twidely\tknown\tand\toften\twidely\tused\tSQL\tServer\tlogin\twith\tsysadmin privileges.\tThe\tsa\tlogin\tis\tthe\toriginal\tlogin\tcreated\tduring\tinstallation\tand\talways\thas principal_id=1\tand\tsid=0x01.",
    "rationale": "It\tis\tmore\tdifficult\tto\tlaunch\tpassword-guessing\tand\tbrute-force\tattacks\tagainst\tthe\tsa\tlogin if\tthe\tname\tis\tnot\tknown.",
    "audit": "Use\tthe\tfollowing\tsyntax\tto\tdetermine\tif\tthe\tsa\taccount\tis\trenamed. SELECT name FROM sys.server_principals WHERE sid = 0x01; A\tname\tof\tsa\tindicates\tthe\taccount\thas\tnot\tbeen\trenamed.",
    "remediation": "Replace\tthe <different_user> value\twithin\tthe\tbelow\tsyntax\tand\texecute\trename\tthe\tsa login. ALTER LOGIN sa WITH NAME = <different_user> ; Impact: It\tis\tnot\ta\tgood\tsecurity\tpractice\tto\tcode\tapplications\tor\tscripts\tto\tuse\tthe\tsa\taccount. However,\tif\tthis\thas\tbeen\tdone\trenaming\tthe\tsa\taccount\twill\tprevent\tscripts\tand applications\tfor\tauthenticating\tto\tthe\tdatabase\tserver\tand\texecuting\trequired\ttasks\tor functions. Default\tValue: By\tdefault,\tthe\tsa\tlogin\tname\tis\t'sa'.  41\t|\tP a g e References: 1. https://docs.microsoft.com/en-us/sql/relational-databases/security/choose-an- authentication-mode Notes: In\tthe\tcase\tof\tAWS\tRDS\tthe\tdefault\tname\tfor\tthis\taccount\tis\trdsa\tinstead\tof\tsa. CIS\tControls: Version\t6 5\tControlled\tUse\tof\tAdministration\tPrivileges Controlled\tUse\tof\tAdministration\tPrivileges Version\t7 5.1\tEstablish\tSecure\tConfigurations Maintain\tdocumented,\tstandard\tsecurity\tconfiguration\tstandards\tfor\tall\tauthorized operating\tsystems\tand\tsoftware.  42\t|\tP a g e",
    "function_names": [
      "sql_server_login_sa_renamed",
      "sql_server_login_default_admin_renamed",
      "sql_server_login_well_known_account_renamed",
      "sql_server_login_high_privilege_renamed",
      "sql_server_login_sysadmin_renamed"
    ],
    "impact": "It\tis\tnot\ta\tgood\tsecurity\tpractice\tto\tcode\tapplications\tor\tscripts\tto\tuse\tthe\tsa\taccount. However,\tif\tthis\thas\tbeen\tdone\trenaming\tthe\tsa\taccount\twill\tprevent\tscripts\tand applications\tfor\tauthenticating\tto\tthe\tdatabase\tserver\tand\texecuting\trequired\ttasks\tor functions. Default\tValue: By\tdefault,\tthe\tsa\tlogin\tname\tis\t'sa'.  41\t|\tP a g e",
    "references": "1. https://docs.microsoft.com/en-us/sql/relational-databases/security/choose-an- authentication-mode Notes: In\tthe\tcase\tof\tAWS\tRDS\tthe\tdefault\tname\tfor\tthis\taccount\tis\trdsa\tinstead\tof\tsa. CIS\tControls: Version\t6 5\tControlled\tUse\tof\tAdministration\tPrivileges Controlled\tUse\tof\tAdministration\tPrivileges Version\t7 5.1\tEstablish\tSecure\tConfigurations Maintain\tdocumented,\tstandard\tsecurity\tconfiguration\tstandards\tfor\tall\tauthorized operating\tsystems\tand\tsoftware.  42\t|\tP a g e"
  },
  {
    "id": "2.15",
    "title": "Ensure 'xp_cmdshell' Server Configuration Option is set to '0'",
    "assessment": "Scored",
    "description": "The\txp_cmdshell\toption\tcontrols\twhether\tthe\txp_cmdshell\textended\tstored\tprocedure\tcan be\tused\tby\tan\tauthenticated\tSQL\tServer\tuser\tto\texecute\toperating-system\tcommand\tshell commands\tand\treturn\tresults\tas\trows\twithin\tthe\tSQL\tclient.",
    "rationale": "The\txp_cmdshell\tprocedure\tis\tcommonly\tused\tby\tattackers\tto\tread\tor\twrite\tdata\tto/from the\tunderlying\tOperating\tSystem\tof\ta\tdatabase\tserver.",
    "audit": "Run\tthe\tfollowing\tT-SQL\tcommand: SELECT name, CAST(value as int) as value_configured, CAST(value_in_use as int) as value_in_use FROM sys.configurations WHERE name = 'xp_cmdshell'; Both\tvalue\tcolumns\tmust\tshow\t0\tto\tbe\tcompliant.",
    "remediation": "Run\tthe\tfollowing\tT-SQL\tcommand: EXECUTE sp_configure 'show advanced options', 1; RECONFIGURE; EXECUTE sp_configure 'xp_cmdshell', 0; RECONFIGURE; GO EXECUTE sp_configure 'show advanced options', 0; RECONFIGURE; Default\tValue: By\tdefault,\tthis\toption\tis\tdisabled\t(0).  43\t|\tP a g e References: 1. https://docs.microsoft.com/en-us/sql/relational-databases/system-stored- procedures/xp-cmdshell-transact-sql 2. https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/xp- cmdshell-server-configuration-option CIS\tControls: Version\t6 18\tApplication\tSoftware\tSecurity Application\tSoftware\tSecurity Version\t7 9.2\tEnsure\tOnly\tApproved\tPorts,\tProtocols\tand\tServices\tAre\tRunning Ensure\tthat\tonly\tnetwork\tports,\tprotocols,\tand\tservices\tlistening\ton\ta\tsystem\twith validated\tbusiness\tneeds,\tare\trunning\ton\teach\tsystem.  44\t|\tP a g e",
    "function_names": [
      "sql_server_xp_cmdshell_disabled",
      "sql_server_configuration_xp_cmdshell_disabled",
      "sql_server_option_xp_cmdshell_disabled",
      "sql_server_xp_cmdshell_set_to_zero",
      "sql_server_configuration_xp_cmdshell_set_to_zero"
    ],
    "references": "1. https://docs.microsoft.com/en-us/sql/relational-databases/system-stored- procedures/xp-cmdshell-transact-sql 2. https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/xp- cmdshell-server-configuration-option CIS\tControls: Version\t6 18\tApplication\tSoftware\tSecurity Application\tSoftware\tSecurity Version\t7 9.2\tEnsure\tOnly\tApproved\tPorts,\tProtocols\tand\tServices\tAre\tRunning Ensure\tthat\tonly\tnetwork\tports,\tprotocols,\tand\tservices\tlistening\ton\ta\tsystem\twith validated\tbusiness\tneeds,\tare\trunning\ton\teach\tsystem.  44\t|\tP a g e"
  },
  {
    "id": "2.16",
    "title": "Ensure 'AUTO_CLOSE' is set to 'OFF' on contained databases",
    "assessment": "Scored",
    "description": "AUTO_CLOSE\tdetermines\tif\ta\tgiven\tdatabase\tis\tclosed\tor\tnot\tafter\ta\tconnection\tterminates.\tIf enabled,\tsubsequent\tconnections\tto\tthe\tgiven\tdatabase\twill\trequire\tthe\tdatabase\tto\tbe reopened\tand\trelevant\tprocedure\tcaches\tto\tbe\trebuilt.",
    "rationale": "Because\tauthentication\tof\tusers\tfor\tcontained\tdatabases\toccurs\twithin\tthe\tdatabase\tnot\tat the\tserver\\instance\tlevel,\tthe\tdatabase\tmust\tbe\topened\tevery\ttime\tto\tauthenticate\ta\tuser. The\tfrequent\topening/closing\tof\tthe\tdatabase\tconsumes\tadditional\tserver\tresources\tand may\tcontribute\tto\ta\tdenial\tof\tservice.",
    "audit": "Perform\tthe\tfollowing\tto\tfind\tcontained\tdatabases\tthat\tare\tnot\tconfigured\tas\tprescribed: SELECT name, containment, containment_desc, is_auto_close_on FROM sys.databases WHERE containment <> 0 and is_auto_close_on = 1; No\trows\tshould\tbe\treturned.",
    "remediation": "Execute\tthe\tfollowing\tT-SQL,\treplacing <database_name> with\teach\tdatabase\tname\tfound by\tthe\tAudit\tProcedure: ALTER DATABASE <database_name> SET AUTO_CLOSE OFF; Default\tValue: By\tdefault,\tthe\tdatabase\tproperty\tAUTO_CLOSE\tis\tOFF\twhich\tis\tequivalent\tto is_auto_close_on = 0.  45\t|\tP a g e References: 1. https://docs.microsoft.com/en-us/sql/relational-databases/databases/security- best-practices-with-contained-databases CIS\tControls: Version\t6 18\tApplication\tSoftware\tSecurity Application\tSoftware\tSecurity Version\t7 5.1\tEstablish\tSecure\tConfigurations Maintain\tdocumented,\tstandard\tsecurity\tconfiguration\tstandards\tfor\tall\tauthorized operating\tsystems\tand\tsoftware.  46\t|\tP a g e",
    "function_names": [
      "sql_database_auto_close_disabled",
      "sql_contained_database_auto_close_off",
      "database_auto_close_setting_disabled",
      "contained_database_auto_close_off"
    ],
    "references": "1. https://docs.microsoft.com/en-us/sql/relational-databases/databases/security- best-practices-with-contained-databases CIS\tControls: Version\t6 18\tApplication\tSoftware\tSecurity Application\tSoftware\tSecurity Version\t7 5.1\tEstablish\tSecure\tConfigurations Maintain\tdocumented,\tstandard\tsecurity\tconfiguration\tstandards\tfor\tall\tauthorized operating\tsystems\tand\tsoftware.  46\t|\tP a g e"
  },
  {
    "id": "2.17",
    "title": "Ensure no login exists with the name 'sa'",
    "assessment": "Scored",
    "description": "The\tsa\tlogin\t(e.g.\tprincipal)\tis\ta\twidely\tknown\tand\toften\twidely\tused\tSQL\tServer\taccount. Therefore,\tthere\tshould\tnot\tbe\ta\tlogin\tcalled\tsa\teven\twhen\tthe\toriginal\tsa\tlogin (principal_id 0x01)\thas\tbeen\trenamed.",
    "rationale": "Enforcing\tthis\tcontrol\treduces\tthe\tprobability\tof\tan\tattacker\texecuting\tbrute\tforce\tattacks against\ta\twell-known\tprincipal.",
    "audit": "Use\tthe\tfollowing\tsyntax\tto\tdetermine\tif\tthere\tis\tan\taccount\tnamed\tsa. SELECT principal_id, name FROM sys.server_principals WHERE name = 'sa'; No\trows\tshould\tbe\treturned.",
    "remediation": "Execute\tthe\tappropriate\tALTER\tor\tDROP\tstatement\tbelow\tbased\ton\tthe\tprincipal_id returned\tfor\tthe\tlogin\tnamed\tsa.\tReplace\tthe <different_name> value\twithin\tthe\tbelow syntax\tand\texecute\tto\trename\tthe\tsa\tlogin. USE [master] GO -- If principal_id = 1 or the login owns database objects, rename the sa login ALTER LOGIN [sa] WITH NAME = <different_name>; GO -- If the login owns no database objects, then drop it -- Do NOT drop the login if it is principal_id = 1 DROP LOGIN sa   47\t|\tP a g e Impact: It\tis\tnot\ta\tgood\tsecurity\tpractice\tto\tcode\tapplications\tor\tscripts\tto\tuse\tthe\tsa\taccount.\tGiven that\tit\tis\ta\tbest\tpractice\tto\trename\tand\tdisable\tthe\tsa\taccount,\tsome\t3rd\tparty\tapplications check\tfor\tthe\texistence\tof\ta\tlogin\tnamed\tsa\tand\tif\tit\tdoesn't\texist,\tcreates\tone.\tRemoving\tthe sa\tlogin\twill\tprevent\tthese\tscripts\tand\tapplications\tfrom\tauthenticating\tto\tthe\tdatabase server\tand\texecuting\trequired\ttasks\tor\tfunctions. Default\tValue: The\tlogin\twith\ta\tprincipal_id = 1\tis\tnamed\tsa\tby\tdefault. CIS\tControls: Version\t6 5.1\tMinimize\tAnd\tSparingly\tUse\tAdministrative\tPrivileges Minimize\tadministrative\tprivileges\tand\tonly\tuse\tadministrative\taccounts\twhen\tthey\tare required.\tImplement\tfocused\tauditing\ton\tthe\tuse\tof\tadministrative\tprivileged\tfunctions\tand monitor\tfor\tanomalous\tbehavior. Version\t7 5.1\tEstablish\tSecure\tConfigurations Maintain\tdocumented,\tstandard\tsecurity\tconfiguration\tstandards\tfor\tall\tauthorized operating\tsystems\tand\tsoftware.  48\t|\tP a g e 3 Authentication and Authorization This\tsection\tcontains\trecommendations\trelated\tto\tSQL\tServer's\tauthentication\tand authorization\tmechanisms.",
    "function_names": [
      "sql_server_login_no_sa_account",
      "sql_server_principal_no_default_sa",
      "sql_server_auth_no_sa_login",
      "sql_server_user_no_sa_principal",
      "sql_server_security_no_sa_account"
    ],
    "impact": "It\tis\tnot\ta\tgood\tsecurity\tpractice\tto\tcode\tapplications\tor\tscripts\tto\tuse\tthe\tsa\taccount.\tGiven that\tit\tis\ta\tbest\tpractice\tto\trename\tand\tdisable\tthe\tsa\taccount,\tsome\t3rd\tparty\tapplications check\tfor\tthe\texistence\tof\ta\tlogin\tnamed\tsa\tand\tif\tit\tdoesn't\texist,\tcreates\tone.\tRemoving\tthe sa\tlogin\twill\tprevent\tthese\tscripts\tand\tapplications\tfrom\tauthenticating\tto\tthe\tdatabase server\tand\texecuting\trequired\ttasks\tor\tfunctions. Default\tValue: The\tlogin\twith\ta\tprincipal_id = 1\tis\tnamed\tsa\tby\tdefault. CIS\tControls: Version\t6 5.1\tMinimize\tAnd\tSparingly\tUse\tAdministrative\tPrivileges Minimize\tadministrative\tprivileges\tand\tonly\tuse\tadministrative\taccounts\twhen\tthey\tare required.\tImplement\tfocused\tauditing\ton\tthe\tuse\tof\tadministrative\tprivileged\tfunctions\tand monitor\tfor\tanomalous\tbehavior. Version\t7 5.1\tEstablish\tSecure\tConfigurations Maintain\tdocumented,\tstandard\tsecurity\tconfiguration\tstandards\tfor\tall\tauthorized operating\tsystems\tand\tsoftware.  48\t|\tP a g e 3 Authentication and Authorization This\tsection\tcontains\trecommendations\trelated\tto\tSQL\tServer's\tauthentication\tand authorization\tmechanisms."
  },
  {
    "id": "3.1",
    "title": "Ensure 'Server Authentication' Property is set to 'Windows Authentication Mode'",
    "assessment": "Scored",
    "description": "Uses Windows\tAuthentication to\tvalidate\tattempted\tconnections.",
    "rationale": "Windows\tprovides\ta\tmore\trobust\tauthentication\tmechanism\tthan\tSQL\tServer authentication.",
    "audit": "Execute\tthe\tfollowing\tsyntax: SELECT SERVERPROPERTY('IsIntegratedSecurityOnly') as [login_mode]; A\tlogin_mode\tof\t1\tindicates\tthe Server\tAuthentication property\tis\tset\tto Windows Authentication\tMode .\tA\tlogin_mode\tof\t0\tindicates\tmixed\tmode\tauthentication.",
    "remediation": "Perform\teither\tthe\tGUI\tor\tT-SQL\tmethod\tshown: GUI\tMethod 1. Open SQL\tServer\tManagement\tStudio . 2. Open\tthe Object\tExplorer tab\tand\tconnect\tto\tthe\ttarget\tdatabase\tinstance. 3. Right\tclick\tthe\tinstance\tname\tand\tselect Properties . 4. Select\tthe Security page\tfrom\tthe\tleft\tmenu. 5. Set\tthe Server\tauthentication setting\tto Windows\tAuthentication\tMode .   49\t|\tP a g e T-SQL\tMethod Run\tthe\tfollowing\tT-SQL\tin\ta\tQuery\tWindow: USE [master] GO EXEC xp_instance_regwrite N'HKEY_LOCAL_MACHINE', N'Software\\Microsoft\\MSSQLServer\\MSSQLServer', N'LoginMode', REG_DWORD, 1 GO Restart\tthe\tSQL\tServer\tservice\tfor\tthe\tchange\tto\ttake\teffect. Default\tValue: Windows\tAuthentication\tMode References: 1. https://docs.microsoft.com/en-us/sql/database-engine/configure- windows/server-properties-security-page CIS\tControls: Version\t6 16.9\tConfigure\tAccount\tAccess\tCentrally Configure\taccess\tfor\tall\taccounts\tthrough\ta\tcentralized\tpoint\tof\tauthentication,\tfor example\tActive\tDirectory\tor\tLDAP.\tConfigure\tnetwork\tand\tsecurity\tdevices\tfor\tcentralized authentication\tas\twell. Version\t7 16.2\tConfigure\tCentralized\tPoint\tof\tAuthentication Configure\taccess\tfor\tall\taccounts\tthrough\tas\tfew\tcentralized\tpoints\tof\tauthentication\tas possible,\tincluding\tnetwork,\tsecurity,\tand\tcloud\tsystems.  50\t|\tP a g e",
    "function_names": [
      "sql_server_authentication_windows_mode_enabled",
      "sql_server_authentication_windows_only",
      "sql_server_connection_windows_auth_required",
      "sql_server_authentication_non_windows_disabled",
      "sql_server_security_windows_auth_enabled"
    ],
    "references": "1. https://docs.microsoft.com/en-us/sql/database-engine/configure- windows/server-properties-security-page CIS\tControls: Version\t6 16.9\tConfigure\tAccount\tAccess\tCentrally Configure\taccess\tfor\tall\taccounts\tthrough\ta\tcentralized\tpoint\tof\tauthentication,\tfor example\tActive\tDirectory\tor\tLDAP.\tConfigure\tnetwork\tand\tsecurity\tdevices\tfor\tcentralized authentication\tas\twell. Version\t7 16.2\tConfigure\tCentralized\tPoint\tof\tAuthentication Configure\taccess\tfor\tall\taccounts\tthrough\tas\tfew\tcentralized\tpoints\tof\tauthentication\tas possible,\tincluding\tnetwork,\tsecurity,\tand\tcloud\tsystems.  50\t|\tP a g e"
  },
  {
    "id": "3.2",
    "title": "Ensure CONNECT permissions on the 'guest user' is Revoked within all SQL Server databases excluding the master, msdb and tempdb",
    "assessment": "Scored",
    "description": "Remove\tthe\tright\tof\tthe\tguest\tuser\tto\tconnect\tto\tSQL\tServer\tdatabases,\texcept\tfor\tmaster, msdb,\tand\ttempdb.",
    "rationale": "A\tlogin\tassumes\tthe\tidentity\tof\tthe\tguest\tuser\twhen\ta\tlogin\thas\taccess\tto\tSQL\tServer\tbut does\tnot\thave\taccess\tto\ta\tdatabase\tthrough\tits\town\taccount\tand\tthe\tdatabase\thas\ta\tguest user\taccount.\tRevoking\tthe\tCONNECT\tpermission\tfor\tthe\tguest\tuser\twill\tensure\tthat\ta\tlogin\tis not\table\tto\taccess\tdatabase\tinformation\twithout\texplicit\taccess\tto\tdo\tso.",
    "audit": "Run\tthe\tfollowing\tcode\tsnippet\tfor\teach\tdatabase\t(replacing <database_name> as appropriate)\tin\tthe\tinstance\tto\tdetermine\tif\tthe\tguest\tuser\thas\tCONNECT\tpermission.\tNo rows\tshould\tbe\treturned. USE <database_name> ; GO SELECT DB_NAME() AS DatabaseName, 'guest' AS Database_User, [permission_name], [state_desc] FROM sys.database_permissions WHERE [grantee_principal_id] = DATABASE_PRINCIPAL_ID('guest') AND [state_desc] LIKE 'GRANT%' AND [permission_name] = 'CONNECT' AND DB_NAME() NOT IN ('master','tempdb','msdb');",
    "remediation": "The\tfollowing\tcode\tsnippet\trevokes\tCONNECT\tpermissions\tfrom\tthe\tguest\tuser\tin\ta database.\tReplace <database_name> as\tappropriate: USE <database_name> ; GO  51\t|\tP a g e REVOKE CONNECT FROM guest; Impact: When\tCONNECT\tpermission\tto\tthe\tguest\tuser\tis\trevoked,\ta\tSQL\tServer\tinstance\tlogin\tmust be\tmapped\tto\ta\tdatabase\tuser\texplicitly\tin\torder\tto\thave\taccess\tto\tthe\tdatabase. Default\tValue: The\tguest\tuser\taccount\tis\tadded\tto\teach\tnew\tdatabase\tbut\twithout\tCONNECT\tpermission\tby default. References: 1. https://docs.microsoft.com/en-us/sql/relational-databases/policy-based- management/guest-permissions-on-user-databases Notes: The\tguest\taccount\tcannot\thave\tthe\tCONNECT\tpermission\trevoked\tin\tmaster,\tmsdb\tand tempdb,\tbut\tthis\tpermission\tshould\tbe\trevoked\tin\tall\tother\tdatabases\ton\tthe\tSQL\tServer instance. CIS\tControls: Version\t6 16\tAccount\tMonitoring\tand\tControl Account\tMonitoring\tand\tControl Version\t7 14.6\tProtect\tInformation\tthrough\tAccess\tControl\tLists Protect\tall\tinformation\tstored\ton\tsystems\twith\tfile\tsystem,\tnetwork\tshare,\tclaims, application,\tor\tdatabase\tspecific\taccess\tcontrol\tlists.\tThese\tcontrols\twill\tenforce\tthe principle\tthat\tonly\tauthorized\tindividuals\tshould\thave\taccess\tto\tthe\tinformation\tbased\ton their\tneed\tto\taccess\tthe\tinformation\tas\ta\tpart\tof\ttheir\tresponsibilities.  52\t|\tP a g e",
    "function_names": [
      "sql_server_database_guest_connect_revoked",
      "sql_server_database_guest_connect_revoked_excluding_system",
      "sql_server_database_guest_permission_restricted",
      "sql_server_database_guest_access_disabled",
      "sql_server_database_guest_connect_disabled_non_system"
    ],
    "impact": "When\tCONNECT\tpermission\tto\tthe\tguest\tuser\tis\trevoked,\ta\tSQL\tServer\tinstance\tlogin\tmust be\tmapped\tto\ta\tdatabase\tuser\texplicitly\tin\torder\tto\thave\taccess\tto\tthe\tdatabase. Default\tValue: The\tguest\tuser\taccount\tis\tadded\tto\teach\tnew\tdatabase\tbut\twithout\tCONNECT\tpermission\tby default.",
    "references": "1. https://docs.microsoft.com/en-us/sql/relational-databases/policy-based- management/guest-permissions-on-user-databases Notes: The\tguest\taccount\tcannot\thave\tthe\tCONNECT\tpermission\trevoked\tin\tmaster,\tmsdb\tand tempdb,\tbut\tthis\tpermission\tshould\tbe\trevoked\tin\tall\tother\tdatabases\ton\tthe\tSQL\tServer instance. CIS\tControls: Version\t6 16\tAccount\tMonitoring\tand\tControl Account\tMonitoring\tand\tControl Version\t7 14.6\tProtect\tInformation\tthrough\tAccess\tControl\tLists Protect\tall\tinformation\tstored\ton\tsystems\twith\tfile\tsystem,\tnetwork\tshare,\tclaims, application,\tor\tdatabase\tspecific\taccess\tcontrol\tlists.\tThese\tcontrols\twill\tenforce\tthe principle\tthat\tonly\tauthorized\tindividuals\tshould\thave\taccess\tto\tthe\tinformation\tbased\ton their\tneed\tto\taccess\tthe\tinformation\tas\ta\tpart\tof\ttheir\tresponsibilities.  52\t|\tP a g e"
  },
  {
    "id": "3.3",
    "title": "Ensure 'Orphaned Users' are Dropped From SQL Server Databases",
    "assessment": "Scored",
    "description": "A\tdatabase\tuser\tfor\twhich\tthe\tcorresponding\tSQL\tServer\tlogin\tis\tundefined\tor\tis\tincorrectly defined\ton\ta\tserver\tinstance\tcannot\tlog\tin\tto\tthe\tinstance\tand\tis\treferred\tto\tas\torphaned and\tshould\tbe\tremoved.",
    "rationale": "Orphan\tusers\tshould\tbe\tremoved\tto\tavoid\tpotential\tmisuse\tof\tthose\tbroken\tusers\tin\tany way.",
    "audit": "Run\tthe\tfollowing\tT-SQL\tquery\tin\teach\tdatabase\tto\tidentify\torphan\tusers.\tNo\trows\tshould be\treturned. USE [<database_name>]; GO EXEC sp_change_users_login @Action='Report';",
    "remediation": "If\tthe\torphaned\tuser\tcannot\tor\tshould\tnot\tbe\tmatched\tto\tan\texisting\tor\tnew\tlogin\tusing\tthe Microsoft\tdocumented\tprocess\treferenced\tbelow,\trun\tthe\tfollowing\tT-SQL\tquery\tin\tthe appropriate\tdatabase\tto\tremove\tan\torphan\tuser: USE [<database_name>]; GO DROP USER <username>; References: 1. http://msdn.microsoft.com/en-us/library/ms175475(v=sql.120).aspx CIS\tControls: Version\t6  53\t|\tP a g e 16\tAccount\tMonitoring\tand\tControl Account\tMonitoring\tand\tControl Version\t7 16.8\tDisable\tAny\tUnassociated\tAccounts Disable\tany\taccount\tthat\tcannot\tbe\tassociated\twith\ta\tbusiness\tprocess\tor\tbusiness owner.  54\t|\tP a g e",
    "function_names": [
      "sql_server_database_orphaned_users_removed",
      "sql_server_database_user_login_valid",
      "sql_server_database_user_orphaned_dropped",
      "sql_server_database_user_login_defined",
      "sql_server_database_user_orphaned_cleaned"
    ],
    "references": "1. http://msdn.microsoft.com/en-us/library/ms175475(v=sql.120).aspx CIS\tControls: Version\t6  53\t|\tP a g e 16\tAccount\tMonitoring\tand\tControl Account\tMonitoring\tand\tControl Version\t7 16.8\tDisable\tAny\tUnassociated\tAccounts Disable\tany\taccount\tthat\tcannot\tbe\tassociated\twith\ta\tbusiness\tprocess\tor\tbusiness owner.  54\t|\tP a g e"
  },
  {
    "id": "3.4",
    "title": "Ensure SQL Authentication is not used in contained databases",
    "assessment": "Scored",
    "description": "Contained\tdatabases\tdo\tnot\tenforce\tpassword\tcomplexity\trules\tfor\tSQL\tAuthenticated users.",
    "rationale": "The\tabsence\tof\tan\tenforced\tpassword\tpolicy\tmay\tincrease\tthe\tlikelihood\tof\ta\tweak credential\tbeing\testablished\tin\ta\tcontained\tdatabase.",
    "audit": "Execute\tthe\tfollowing\tin\teach\tcontained\tdatabase\tto\tfind\tdatabase\tusers\tthat\tare\tusing\tSQL authentication: SELECT name AS DBUser FROM sys.database_principals WHERE name NOT IN ('dbo','Information_Schema','sys','guest') AND type IN ('U','S','G') AND authentication_type = 2; GO",
    "remediation": "Leverage\tWindows\tAuthenticated\tusers\tin\tcontained\tdatabases. Impact: While\tcontained\tdatabases\tprovide\tflexibility\tin\trelocating\tdatabases\tto\tdifferent\tinstances and\tdifferent\tenvironments,\tthis\tmust\tbe\tbalanced\twith\tthe\tconsideration\tthat\tno\tpassword policy\tmechanism\texists\tfor\tSQL\tAuthenticated\tusers\tin\tcontained\tdatabases. Default\tValue: SQL\tAuthenticated\tusers\t(USER WITH PASSWORD\tauthentication)\tare\tallowed\tin\tcontained databases.  55\t|\tP a g e References: 1. https://docs.microsoft.com/en-us/sql/relational-databases/databases/security- best-practices-with-contained-databases CIS\tControls: Version\t6 16.12\tUse\tLong\tPasswords\tFor\tAll\tUser\tAccounts Where\tmulti-factor\tauthentication\tis\tnot\tsupported,\tuser\taccounts\tshall\tbe\trequired\tto use\tlong\tpasswords\ton\tthe\tsystem\t(longer\tthan\t14\tcharacters). Version\t7 16.2\tConfigure\tCentralized\tPoint\tof\tAuthentication Configure\taccess\tfor\tall\taccounts\tthrough\tas\tfew\tcentralized\tpoints\tof\tauthentication\tas possible,\tincluding\tnetwork,\tsecurity,\tand\tcloud\tsystems.  56\t|\tP a g e",
    "function_names": [
      "sql_database_contained_auth_disabled",
      "sql_database_sql_auth_restricted",
      "sql_database_password_complexity_enforced",
      "sql_database_contained_auth_no_sql_users",
      "sql_database_auth_mode_windows_only"
    ],
    "impact": "While\tcontained\tdatabases\tprovide\tflexibility\tin\trelocating\tdatabases\tto\tdifferent\tinstances and\tdifferent\tenvironments,\tthis\tmust\tbe\tbalanced\twith\tthe\tconsideration\tthat\tno\tpassword policy\tmechanism\texists\tfor\tSQL\tAuthenticated\tusers\tin\tcontained\tdatabases. Default\tValue: SQL\tAuthenticated\tusers\t(USER WITH PASSWORD\tauthentication)\tare\tallowed\tin\tcontained databases.  55\t|\tP a g e",
    "references": "1. https://docs.microsoft.com/en-us/sql/relational-databases/databases/security- best-practices-with-contained-databases CIS\tControls: Version\t6 16.12\tUse\tLong\tPasswords\tFor\tAll\tUser\tAccounts Where\tmulti-factor\tauthentication\tis\tnot\tsupported,\tuser\taccounts\tshall\tbe\trequired\tto use\tlong\tpasswords\ton\tthe\tsystem\t(longer\tthan\t14\tcharacters). Version\t7 16.2\tConfigure\tCentralized\tPoint\tof\tAuthentication Configure\taccess\tfor\tall\taccounts\tthrough\tas\tfew\tcentralized\tpoints\tof\tauthentication\tas possible,\tincluding\tnetwork,\tsecurity,\tand\tcloud\tsystems.  56\t|\tP a g e"
  },
  {
    "id": "3.5",
    "title": "Ensure the SQL Server\u2019s MSSQL Service Account is Not an Administrator",
    "assessment": "Not Scored",
    "description": "The\tservice\taccount\tand/or\tservice\tSID\tused\tby\tthe\tMSSQLSERVER\tservice\tfor\ta\tdefault instance\tor\tMSSQL$<InstanceName>\tservice\tfor\ta\tnamed\tinstance\tshould\tnot\tbe\ta\tmember of\tthe\tWindows\tAdministrator\tgroup\teither\tdirectly\tor\tindirectly\t(via\ta\tgroup).\tThis\talso means\tthat\tthe\taccount\tknown\tas\tLocalSystem\t(AKA\tNT AUTHORITY\\SYSTEM)\tshould\tnot\tbe used\tfor\tthe\tMSSQL\tservice\tas\tthis\taccount\thas\thigher\tprivileges\tthan\tthe\tSQL\tServer service\trequires.",
    "rationale": "Following\tthe\tprinciple\tof\tleast\tprivilege,\tthe\tservice\taccount\tshould\thave\tno\tmore privileges\tthan\trequired\tto\tdo\tits\tjob.\tFor\tSQL\tServer\tservices,\tthe\tSQL\tServer\tSetup\twill assign\tthe\trequired\tpermissions\tdirectly\tto\tthe\tservice\tSID.\tNo\tadditional\tpermissions\tor privileges\tshould\tbe\tnecessary.",
    "audit": "Verify\tthat\tthe\tservice\taccount\t(in\tcase\tof\ta\tlocal\tor\tAD\taccount)\tand\tservice\tSID\tare\tnot members\tof\tthe\tWindows\tAdministrators\tgroup.",
    "remediation": "In\tthe\tcase\twhere\tLocalSystem\tis\tused,\tuse SQL\tServer\tConfiguration\tManager to\tchange to\ta\tless\tprivileged\taccount.\tOtherwise,\tremove\tthe\taccount\tor\tservice\tSID\tfrom\tthe Administrators\tgroup.\tYou\tmay\tneed\tto\trun\tthe SQL\tServer\tConfiguration\tManager if underlying\tpermissions\thad\tbeen\tchanged\tor\tif SQL\tServer\tConfiguration\tManager was not\toriginally\tused\tto\tset\tthe\tservice\taccount. Impact: The SQL\tServer\tConfiguration\tManager tool\tshould\talways\tbe\tused\tto\tchange\tthe\tSQL Server\u2019s\tservice\taccount.\tThis\twill\tensure\tthat\tthe\taccount\thas\tthe\tnecessary\tprivileges.\tIf the\tservice\tneeds\taccess\tto\tresources\tother\tthan\tthe\tstandard\tMicrosoft\tdefined\tdirectories  57\t|\tP a g e and\tregistry,\tthen\tadditional\tpermissions\tmay\tneed\tto\tbe\tgranted\tseparately\tto\tthose resources. Default\tValue: By\tdefault,\tthe\tService\tAccount\t(or\tService\tSID)\tis\tnot\ta\tmember\tof\tthe\tAdministrators group. References: 1. https://technet.microsoft.com/en-us/library/ms143504(v=sql.120).aspx CIS\tControls: Version\t6 5.1\tMinimize\tAnd\tSparingly\tUse\tAdministrative\tPrivileges Minimize\tadministrative\tprivileges\tand\tonly\tuse\tadministrative\taccounts\twhen\tthey\tare required.\tImplement\tfocused\tauditing\ton\tthe\tuse\tof\tadministrative\tprivileged\tfunctions\tand monitor\tfor\tanomalous\tbehavior. Version\t7 4.3\tEnsure\tthe\tUse\tof\tDedicated\tAdministrative\tAccounts Ensure\tthat\tall\tusers\twith\tadministrative\taccount\taccess\tuse\ta\tdedicated\tor\tsecondary account\tfor\televated\tactivities.\tThis\taccount\tshould\tonly\tbe\tused\tfor\tadministrative activities\tand\tnot\tinternet\tbrowsing,\temail,\tor\tsimilar\tactivities.  58\t|\tP a g e",
    "function_names": [
      "sql_server_service_account_no_admin_privileges",
      "sql_server_mssql_service_no_local_system",
      "sql_server_instance_service_account_no_admin_group",
      "sql_server_service_sid_no_admin_membership",
      "sql_server_default_instance_no_admin_privileges",
      "sql_server_named_instance_no_admin_privileges",
      "sql_server_service_account_no_indirect_admin",
      "sql_server_mssql_service_no_high_privilege_account"
    ],
    "impact": "The SQL\tServer\tConfiguration\tManager tool\tshould\talways\tbe\tused\tto\tchange\tthe\tSQL Server\u2019s\tservice\taccount.\tThis\twill\tensure\tthat\tthe\taccount\thas\tthe\tnecessary\tprivileges.\tIf the\tservice\tneeds\taccess\tto\tresources\tother\tthan\tthe\tstandard\tMicrosoft\tdefined\tdirectories  57\t|\tP a g e and\tregistry,\tthen\tadditional\tpermissions\tmay\tneed\tto\tbe\tgranted\tseparately\tto\tthose resources. Default\tValue: By\tdefault,\tthe\tService\tAccount\t(or\tService\tSID)\tis\tnot\ta\tmember\tof\tthe\tAdministrators group.",
    "references": "1. https://technet.microsoft.com/en-us/library/ms143504(v=sql.120).aspx CIS\tControls: Version\t6 5.1\tMinimize\tAnd\tSparingly\tUse\tAdministrative\tPrivileges Minimize\tadministrative\tprivileges\tand\tonly\tuse\tadministrative\taccounts\twhen\tthey\tare required.\tImplement\tfocused\tauditing\ton\tthe\tuse\tof\tadministrative\tprivileged\tfunctions\tand monitor\tfor\tanomalous\tbehavior. Version\t7 4.3\tEnsure\tthe\tUse\tof\tDedicated\tAdministrative\tAccounts Ensure\tthat\tall\tusers\twith\tadministrative\taccount\taccess\tuse\ta\tdedicated\tor\tsecondary account\tfor\televated\tactivities.\tThis\taccount\tshould\tonly\tbe\tused\tfor\tadministrative activities\tand\tnot\tinternet\tbrowsing,\temail,\tor\tsimilar\tactivities.  58\t|\tP a g e"
  },
  {
    "id": "3.6",
    "title": "Ensure the SQL Server\u2019s SQLAgent Service Account is Not an Administrator",
    "assessment": "Not Scored",
    "description": "The\tservice\taccount\tand/or\tservice\tSID\tused\tby\tthe\tSQLSERVERAGENT\tservice\tfor\ta\tdefault instance\tor\tSQLAGENT$<InstanceName>\tservice\tfor\ta\tnamed\tinstance\tshould\tnot\tbe\ta member\tof\tthe\tWindows\tAdministrator\tgroup\teither\tdirectly\tor\tindirectly\t(via\ta\tgroup). This\talso\tmeans\tthat\tthe\taccount\tknown\tas\tLocalSystem\t(AKA\tNT AUTHORITY\\SYSTEM) should\tnot\tbe\tused\tfor\tthe\tSQLAGENT\tservice\tas\tthis\taccount\thas\thigher\tprivileges\tthan\tthe SQL\tServer\tservice\trequires.",
    "rationale": "Following\tthe\tprinciple\tof\tleast\tprivilege,\tthe\tservice\taccount\tshould\thave\tno\tmore privileges\tthan\trequired\tto\tdo\tits\tjob.\tFor\tSQL\tServer\tservices,\tthe\tSQL\tServer\tSetup\twill assign\tthe\trequired\tpermissions\tdirectly\tto\tthe\tservice\tSID.\tNo\tadditional\tpermissions\tor privileges\tshould\tbe\tnecessary.",
    "audit": "Verify\tthat\tthe\tservice\taccount\t(in\tcase\tof\ta\tlocal\tor\tAD\taccount)\tand\tservice\tSID\tare\tnot members\tof\tthe\tWindows\tAdministrators\tgroup.",
    "remediation": "In\tthe\tcase\twhere\tLocalSystem\tis\tused,\tuse SQL\tServer\tConfiguration\tManager to\tchange to\ta\tless\tprivileged\taccount.\tOtherwise,\tremove\tthe\taccount\tor\tservice\tSID\tfrom\tthe Administrators\tgroup.\tYou\tmay\tneed\tto\trun\tthe SQL\tServer\tConfiguration\tManager if underlying\tpermissions\thad\tbeen\tchanged\tor\tif SQL\tServer\tConfiguration\tManager was not\toriginally\tused\tto\tset\tthe\tservice\taccount. Impact: The SQL\tServer\tConfiguration\tManager tool\tshould\talways\tbe\tused\tto\tchange\tthe\tSQL Server\u2019s\tservice\taccount.\tThis\twill\tensure\tthat\tthe\taccount\thas\tthe\tnecessary\tprivileges.\tIf the\tservice\tneeds\taccess\tto\tresources\tother\tthan\tthe\tstandard\tMicrosoft-defined\tdirectories  59\t|\tP a g e and\tregistry,\tthen\tadditional\tpermissions\tmay\tneed\tto\tbe\tgranted\tseparately\tto\tthose resources. If\tusing\tthe\tauto\trestart\tfeature,\tthen\tthe\tSQLAGENT\tservice\tmust\tbe\tan\tAdministrator. Default\tValue: By\tdefault,\tthe\tService\tAccount\t(or\tService\tSID)\tis\tnot\ta\tmember\tof\tthe\tAdministrators group. References: 1. https://technet.microsoft.com/en-us/library/ms143504(v=sql.120).aspx CIS\tControls: Version\t6 5.1\tMinimize\tAnd\tSparingly\tUse\tAdministrative\tPrivileges Minimize\tadministrative\tprivileges\tand\tonly\tuse\tadministrative\taccounts\twhen\tthey\tare required.\tImplement\tfocused\tauditing\ton\tthe\tuse\tof\tadministrative\tprivileged\tfunctions\tand monitor\tfor\tanomalous\tbehavior. Version\t7 4.3\tEnsure\tthe\tUse\tof\tDedicated\tAdministrative\tAccounts Ensure\tthat\tall\tusers\twith\tadministrative\taccount\taccess\tuse\ta\tdedicated\tor\tsecondary account\tfor\televated\tactivities.\tThis\taccount\tshould\tonly\tbe\tused\tfor\tadministrative activities\tand\tnot\tinternet\tbrowsing,\temail,\tor\tsimilar\tactivities.  60\t|\tP a g e",
    "function_names": [
      "sql_server_agent_service_no_admin_privileges",
      "sql_server_agent_service_non_system_account",
      "sql_server_agent_service_local_system_disabled",
      "sql_server_agent_service_restricted_permissions",
      "sql_server_agent_service_non_admin_account"
    ],
    "impact": "The SQL\tServer\tConfiguration\tManager tool\tshould\talways\tbe\tused\tto\tchange\tthe\tSQL Server\u2019s\tservice\taccount.\tThis\twill\tensure\tthat\tthe\taccount\thas\tthe\tnecessary\tprivileges.\tIf the\tservice\tneeds\taccess\tto\tresources\tother\tthan\tthe\tstandard\tMicrosoft-defined\tdirectories  59\t|\tP a g e and\tregistry,\tthen\tadditional\tpermissions\tmay\tneed\tto\tbe\tgranted\tseparately\tto\tthose resources. If\tusing\tthe\tauto\trestart\tfeature,\tthen\tthe\tSQLAGENT\tservice\tmust\tbe\tan\tAdministrator. Default\tValue: By\tdefault,\tthe\tService\tAccount\t(or\tService\tSID)\tis\tnot\ta\tmember\tof\tthe\tAdministrators group.",
    "references": "1. https://technet.microsoft.com/en-us/library/ms143504(v=sql.120).aspx CIS\tControls: Version\t6 5.1\tMinimize\tAnd\tSparingly\tUse\tAdministrative\tPrivileges Minimize\tadministrative\tprivileges\tand\tonly\tuse\tadministrative\taccounts\twhen\tthey\tare required.\tImplement\tfocused\tauditing\ton\tthe\tuse\tof\tadministrative\tprivileged\tfunctions\tand monitor\tfor\tanomalous\tbehavior. Version\t7 4.3\tEnsure\tthe\tUse\tof\tDedicated\tAdministrative\tAccounts Ensure\tthat\tall\tusers\twith\tadministrative\taccount\taccess\tuse\ta\tdedicated\tor\tsecondary account\tfor\televated\tactivities.\tThis\taccount\tshould\tonly\tbe\tused\tfor\tadministrative activities\tand\tnot\tinternet\tbrowsing,\temail,\tor\tsimilar\tactivities.  60\t|\tP a g e"
  },
  {
    "id": "3.7",
    "title": "Ensure the SQL Server\u2019s Full-Text Service Account is Not an Administrator",
    "assessment": "Not Scored",
    "description": "The\tservice\taccount\tand/or\tservice\tSID\tused\tby\tthe\tMSSQLFDLauncher\tservice\tfor\ta\tdefault instance\tor\tMSSQLFDLauncher$<InstanceName>\tservice\tfor\ta\tnamed\tinstance\tshould\tnot be\ta\tmember\tof\tthe\tWindows\tAdministrator\tgroup\teither\tdirectly\tor\tindirectly\t(via\ta group).\tThis\talso\tmeans\tthat\tthe\taccount\tknown\tas\tLocalSystem\t(AKA\tNT AUTHORITY\\SYSTEM)\tshould\tnot\tbe\tused\tfor\tthe\tFull-Text\tservice\tas\tthis\taccount\thas\thigher privileges\tthan\tthe\tSQL\tServer\tservice\trequires.",
    "rationale": "Following\tthe\tprinciple\tof\tleast\tprivilege,\tthe\tservice\taccount\tshould\thave\tno\tmore privileges\tthan\trequired\tto\tdo\tits\tjob.\tFor\tSQL\tServer\tservices,\tthe\tSQL\tServer\tSetup\twill assign\tthe\trequired\tpermissions\tdirectly\tto\tthe\tservice\tSID.\tNo\tadditional\tpermissions\tor privileges\tshould\tbe\tnecessary.",
    "audit": "Verify\tthat\tthe\tservice\taccount\t(in\tcase\tof\ta\tlocal\tor\tAD\taccount)\tand\tservice\tSID\tare\tnot members\tof\tthe\tWindows\tAdministrators\tgroup.",
    "remediation": "In\tthe\tcase\twhere\tLocalSystem\tis\tused,\tuse SQL\tServer\tConfiguration\tManager to\tchange to\ta\tless\tprivileged\taccount.\tOtherwise,\tremove\tthe\taccount\tor\tservice\tSID\tfrom\tthe Administrators\tgroup.\tYou\tmay\tneed\tto\trun\tthe SQL\tServer\tConfiguration\tManager if underlying\tpermissions\thad\tbeen\tchanged\tor\tif SQL\tServer\tConfiguration\tManager was not\toriginally\tused\tto\tset\tthe\tservice\taccount. Impact: The SQL\tServer\tConfiguration\tManager tool\tshould\talways\tbe\tused\tto\tchange\tthe\tSQL Server\u2019s\tservice\taccount.\tThis\twill\tensure\tthat\tthe\taccount\thas\tthe\tnecessary\tprivileges.\tIf the\tservice\tneeds\taccess\tto\tresources\tother\tthan\tthe\tstandard\tMicrosoft-defined\tdirectories  61\t|\tP a g e and\tregistry,\tthen\tadditional\tpermissions\tmay\tneed\tto\tbe\tgranted\tseparately\tto\tthose resources. Default\tValue: By\tdefault,\tthe\tService\tAccount\t(or\tService\tSID)\tis\tnot\ta\tmember\tof\tthe\tAdministrators group. References: 1. https://technet.microsoft.com/en-us/library/ms143504(v=sql.120).aspx CIS\tControls: Version\t6 5.1\tMinimize\tAnd\tSparingly\tUse\tAdministrative\tPrivileges Minimize\tadministrative\tprivileges\tand\tonly\tuse\tadministrative\taccounts\twhen\tthey\tare required.\tImplement\tfocused\tauditing\ton\tthe\tuse\tof\tadministrative\tprivileged\tfunctions\tand monitor\tfor\tanomalous\tbehavior. Version\t7 4.3\tEnsure\tthe\tUse\tof\tDedicated\tAdministrative\tAccounts Ensure\tthat\tall\tusers\twith\tadministrative\taccount\taccess\tuse\ta\tdedicated\tor\tsecondary account\tfor\televated\tactivities.\tThis\taccount\tshould\tonly\tbe\tused\tfor\tadministrative activities\tand\tnot\tinternet\tbrowsing,\temail,\tor\tsimilar\tactivities.  62\t|\tP a g e",
    "function_names": [
      "sqlserver_full_text_service_no_admin_privileges",
      "sqlserver_service_account_no_admin_group_membership",
      "sqlserver_mssqlfdlauncher_no_local_system_account",
      "sqlserver_instance_service_no_high_privilege_account",
      "sqlserver_full_text_service_non_privileged_account"
    ],
    "impact": "The SQL\tServer\tConfiguration\tManager tool\tshould\talways\tbe\tused\tto\tchange\tthe\tSQL Server\u2019s\tservice\taccount.\tThis\twill\tensure\tthat\tthe\taccount\thas\tthe\tnecessary\tprivileges.\tIf the\tservice\tneeds\taccess\tto\tresources\tother\tthan\tthe\tstandard\tMicrosoft-defined\tdirectories  61\t|\tP a g e and\tregistry,\tthen\tadditional\tpermissions\tmay\tneed\tto\tbe\tgranted\tseparately\tto\tthose resources. Default\tValue: By\tdefault,\tthe\tService\tAccount\t(or\tService\tSID)\tis\tnot\ta\tmember\tof\tthe\tAdministrators group.",
    "references": "1. https://technet.microsoft.com/en-us/library/ms143504(v=sql.120).aspx CIS\tControls: Version\t6 5.1\tMinimize\tAnd\tSparingly\tUse\tAdministrative\tPrivileges Minimize\tadministrative\tprivileges\tand\tonly\tuse\tadministrative\taccounts\twhen\tthey\tare required.\tImplement\tfocused\tauditing\ton\tthe\tuse\tof\tadministrative\tprivileged\tfunctions\tand monitor\tfor\tanomalous\tbehavior. Version\t7 4.3\tEnsure\tthe\tUse\tof\tDedicated\tAdministrative\tAccounts Ensure\tthat\tall\tusers\twith\tadministrative\taccount\taccess\tuse\ta\tdedicated\tor\tsecondary account\tfor\televated\tactivities.\tThis\taccount\tshould\tonly\tbe\tused\tfor\tadministrative activities\tand\tnot\tinternet\tbrowsing,\temail,\tor\tsimilar\tactivities.  62\t|\tP a g e"
  },
  {
    "id": "3.8",
    "title": "Ensure only the default permissions specified by Microsoft are granted to the public server role",
    "assessment": "Scored",
    "description": "public\tis\ta\tspecial\tfixed\tserver\trole\tcontaining\tall\tlogins.\tUnlike\tother\tfixed\tserver\troles, permissions\tcan\tbe\tchanged\tfor\tthe\tpublic\trole.\tIn\tkeeping\twith\tthe\tprinciple\tof\tleast privileges,\tthe\tpublic\tserver\trole\tshould\tnot\tbe\tused\tto\tgrant\tpermissions\tat\tthe\tserver scope\tas\tthese\twould\tbe\tinherited\tby\tall\tusers.",
    "rationale": "Every\tSQL\tServer\tlogin\tbelongs\tto\tthe\tpublic\trole\tand\tcannot\tbe\tremoved\tfrom\tthis\trole. Therefore,\tany\tpermissions\tgranted\tto\tthis\trole\twill\tbe\tavailable\tto\tall\tlogins\tunless\tthey have\tbeen\texplicitly\tdenied\tto\tspecific\tlogins\tor\tuser-defined\tserver\troles.",
    "audit": "Use\tthe\tfollowing\tsyntax\tto\tdetermine\tif\textra\tpermissions\thave\tbeen\tgranted\tto\tthe\tpublic server\trole. SELECT * FROM master.sys.server_permissions WHERE (grantee_principal_id = SUSER_SID(N'public') and state_desc LIKE 'GRANT%') AND NOT (state_desc = 'GRANT' and [permission_name] = 'VIEW ANY DATABASE' and class_desc = 'SERVER') AND NOT (state_desc = 'GRANT' and [permission_name] = 'CONNECT' and class_desc = 'ENDPOINT' and major_id = 2) AND NOT (state_desc = 'GRANT' and [permission_name] = 'CONNECT' and class_desc = 'ENDPOINT' and major_id = 3) AND NOT (state_desc = 'GRANT' and [permission_name] = 'CONNECT' and class_desc = 'ENDPOINT' and major_id = 4) AND NOT (state_desc = 'GRANT' and [permission_name] = 'CONNECT' and class_desc = 'ENDPOINT' and major_id = 5); This\tquery\tshould\tnot\treturn\tany\trows.  63\t|\tP a g e",
    "remediation": "1. Add\tthe\textraneous\tpermissions\tfound\tin\tthe\tAudit\tquery\tresults\tto\tthe\tspecific logins\tto\tuser-defined\tserver\troles\twhich\trequire\tthe\taccess. 2. Revoke\tthe <permission_name> from\tthe\tpublic\trole\tas\tshown\tbelow USE [master] GO REVOKE <permission_name> FROM public; GO Impact: When\tthe\textraneous\tpermissions\tare\trevoked\tfrom\tthe\tpublic\tserver\trole,\taccess\tmay\tbe lost\tunless\tthe\tpermissions\tare\tgranted\tto\tthe\texplicit\tlogins\tor\tto\tuser-defined\tserver\troles containing\tthe\tlogins\twhich\trequire\tthe\taccess. Default\tValue: By\tdefault,\tthe\tpublic\tserver\trole\tis\tgranted\tVIEW ANY DATABASE\tpermission\tand\tthe CONNECT\tpermission\ton\tthe\tdefault\tendpoints\t(TSQL Local Machine,\tTSQL Named Pipes, TSQL Default TCP,\tTSQL Default VIA).\tThe\tVIEW ANY DATABASE\tpermission\tallows\tall logins\tto\tsee\tdatabase\tmetadata,\tunless\texplicitly\tdenied. References: 1. https://docs.microsoft.com/en-us/sql/relational- databases/security/authentication-access/server-level-roles 2. https://docs.microsoft.com/en-us/sql/relational- databases/security/authentication-access/server-level-roles#permissions-of-fixed- server-roles CIS\tControls: Version\t6 5.1\tMinimize\tAnd\tSparingly\tUse\tAdministrative\tPrivileges Minimize\tadministrative\tprivileges\tand\tonly\tuse\tadministrative\taccounts\twhen\tthey\tare required.\tImplement\tfocused\tauditing\ton\tthe\tuse\tof\tadministrative\tprivileged\tfunctions\tand monitor\tfor\tanomalous\tbehavior. Version\t7 14.6\tProtect\tInformation\tthrough\tAccess\tControl\tLists Protect\tall\tinformation\tstored\ton\tsystems\twith\tfile\tsystem,\tnetwork\tshare,\tclaims, application,\tor\tdatabase\tspecific\taccess\tcontrol\tlists.\tThese\tcontrols\twill\tenforce\tthe  64\t|\tP a g e principle\tthat\tonly\tauthorized\tindividuals\tshould\thave\taccess\tto\tthe\tinformation\tbased\ton their\tneed\tto\taccess\tthe\tinformation\tas\ta\tpart\tof\ttheir\tresponsibilities.  65\t|\tP a g e",
    "function_names": [
      "sql_server_public_role_default_permissions",
      "sql_server_public_role_no_custom_permissions",
      "sql_server_public_role_least_privilege",
      "sql_server_public_role_no_server_scope_permissions",
      "sql_server_public_role_permissions_unchanged"
    ],
    "impact": "When\tthe\textraneous\tpermissions\tare\trevoked\tfrom\tthe\tpublic\tserver\trole,\taccess\tmay\tbe lost\tunless\tthe\tpermissions\tare\tgranted\tto\tthe\texplicit\tlogins\tor\tto\tuser-defined\tserver\troles containing\tthe\tlogins\twhich\trequire\tthe\taccess. Default\tValue: By\tdefault,\tthe\tpublic\tserver\trole\tis\tgranted\tVIEW ANY DATABASE\tpermission\tand\tthe CONNECT\tpermission\ton\tthe\tdefault\tendpoints\t(TSQL Local Machine,\tTSQL Named Pipes, TSQL Default TCP,\tTSQL Default VIA).\tThe\tVIEW ANY DATABASE\tpermission\tallows\tall logins\tto\tsee\tdatabase\tmetadata,\tunless\texplicitly\tdenied.",
    "references": "1. https://docs.microsoft.com/en-us/sql/relational- databases/security/authentication-access/server-level-roles 2. https://docs.microsoft.com/en-us/sql/relational- databases/security/authentication-access/server-level-roles#permissions-of-fixed- server-roles CIS\tControls: Version\t6 5.1\tMinimize\tAnd\tSparingly\tUse\tAdministrative\tPrivileges Minimize\tadministrative\tprivileges\tand\tonly\tuse\tadministrative\taccounts\twhen\tthey\tare required.\tImplement\tfocused\tauditing\ton\tthe\tuse\tof\tadministrative\tprivileged\tfunctions\tand monitor\tfor\tanomalous\tbehavior. Version\t7 14.6\tProtect\tInformation\tthrough\tAccess\tControl\tLists Protect\tall\tinformation\tstored\ton\tsystems\twith\tfile\tsystem,\tnetwork\tshare,\tclaims, application,\tor\tdatabase\tspecific\taccess\tcontrol\tlists.\tThese\tcontrols\twill\tenforce\tthe  64\t|\tP a g e principle\tthat\tonly\tauthorized\tindividuals\tshould\thave\taccess\tto\tthe\tinformation\tbased\ton their\tneed\tto\taccess\tthe\tinformation\tas\ta\tpart\tof\ttheir\tresponsibilities.  65\t|\tP a g e"
  },
  {
    "id": "3.9",
    "title": "Ensure Windows BUILTIN groups are not SQL Logins",
    "assessment": "Scored",
    "description": "Prior\tto\tSQL\tServer\t2008,\tthe\tBUILTIN\\Administrators\tgroup\twas\tadded\ta\tSQL\tServer login\twith\tsysadmin\tprivileges\tduring\tinstallation\tby\tdefault.\tBest\tpractices\tpromote creating\tan\tActive\tDirectory\tlevel\tgroup\tcontaining\tapproved\tDBA\tstaff\taccounts\tand\tusing this\tcontrolled\tAD\tgroup\tas\tthe\tlogin\twith\tsysadmin\tprivileges.\tThe\tAD\tgroup\tshould\tbe specified\tduring\tSQL\tServer\tinstallation\tand\tthe\tBUILTIN\\Administrators\tgroup\twould therefore\thave\tno\tneed\tto\tbe\ta\tlogin.",
    "rationale": "The\tBUILTIN\tgroups\t(Administrators,\tEveryone,\tAuthenticated\tUsers,\tGuests,\tetc)\tgenerally contain\tvery\tbroad\tmemberships\twhich\twould\tnot\tmeet\tthe\tbest\tpractice\tof\tensuring\tonly the\tnecessary\tusers\thave\tbeen\tgranted\taccess\tto\ta\tSQL\tServer\tinstance.\tThese\tgroups should\tnot\tbe\tused\tfor\tany\tlevel\tof\taccess\tinto\ta\tSQL\tServer\tDatabase\tEngine\tinstance.",
    "audit": "Use\tthe\tfollowing\tsyntax\tto\tdetermine\tif\tany\tBUILTIN\tgroups\tor\taccounts\thave\tbeen\tadded as\tSQL\tServer\tLogins. SELECT pr.[name], pe.[permission_name], pe.[state_desc] FROM sys.server_principals pr JOIN sys.server_permissions pe ON pr.principal_id = pe.grantee_principal_id WHERE pr.name like 'BUILTIN%'; This\tquery\tshould\tnot\treturn\tany\trows.",
    "remediation": "1. For\teach\tBUILTIN\tlogin,\tif\tneeded\tcreate\ta\tmore\trestrictive\tAD\tgroup\tcontaining\tonly the\trequired\tuser\taccounts. 2. Add\tthe\tAD\tgroup\tor\tindividual\tWindows\taccounts\tas\ta\tSQL\tServer\tlogin\tand\tgrant\tit the\tpermissions\trequired. 3. Drop\tthe\tBUILTIN\tlogin\tusing\tthe\tsyntax\tbelow\tafter\treplacing <name> in [BUILTIN\\ <name> ].  66\t|\tP a g e USE [master] GO DROP LOGIN [BUILTIN\\ <name> ] GO Impact: Before\tdropping\tthe\tBUILTIN\tgroup\tlogins,\tensure\tthat\talternative\tAD\tGroups\tor\tWindows logins\thave\tbeen\tadded\twith\tequivalent\tpermissions.\tOtherwise,\tthe\tSQL\tServer\tinstance may\tbecome\ttotally\tinaccessible. Default\tValue: By\tdefault,\tno\tBUILTIN\tgroups\tare\tadded\tas\tSQL\tlogins. CIS\tControls: Version\t6 14.4\tProtect\tInformation\tWith\tAccess\tControl\tLists All\tinformation\tstored\ton\tsystems\tshall\tbe\tprotected\twith\tfile\tsystem,\tnetwork\tshare, claims,\tapplication,\tor\tdatabase\tspecific\taccess\tcontrol\tlists.\tThese\tcontrols\twill\tenforce\tthe principle\tthat\tonly\tauthorized\tindividuals\tshould\thave\taccess\tto\tthe\tinformation\tbased\ton their\tneed\tto\taccess\tthe\tinformation\tas\ta\tpart\tof\ttheir\tresponsibilities. Version\t7 14.6\tProtect\tInformation\tthrough\tAccess\tControl\tLists Protect\tall\tinformation\tstored\ton\tsystems\twith\tfile\tsystem,\tnetwork\tshare,\tclaims, application,\tor\tdatabase\tspecific\taccess\tcontrol\tlists.\tThese\tcontrols\twill\tenforce\tthe principle\tthat\tonly\tauthorized\tindividuals\tshould\thave\taccess\tto\tthe\tinformation\tbased\ton their\tneed\tto\taccess\tthe\tinformation\tas\ta\tpart\tof\ttheir\tresponsibilities.  67\t|\tP a g e",
    "function_names": [
      "sql_server_login_builtin_groups_removed",
      "sql_server_login_no_builtin_administrators",
      "sql_server_login_builtin_admin_privileges_revoked",
      "sql_server_login_active_directory_group_required",
      "sql_server_login_sysadmin_privileges_restricted",
      "sql_server_login_builtin_groups_disabled",
      "sql_server_login_builtin_admin_login_denied",
      "sql_server_login_builtin_groups_no_access"
    ],
    "impact": "Before\tdropping\tthe\tBUILTIN\tgroup\tlogins,\tensure\tthat\talternative\tAD\tGroups\tor\tWindows logins\thave\tbeen\tadded\twith\tequivalent\tpermissions.\tOtherwise,\tthe\tSQL\tServer\tinstance may\tbecome\ttotally\tinaccessible. Default\tValue: By\tdefault,\tno\tBUILTIN\tgroups\tare\tadded\tas\tSQL\tlogins. CIS\tControls: Version\t6 14.4\tProtect\tInformation\tWith\tAccess\tControl\tLists All\tinformation\tstored\ton\tsystems\tshall\tbe\tprotected\twith\tfile\tsystem,\tnetwork\tshare, claims,\tapplication,\tor\tdatabase\tspecific\taccess\tcontrol\tlists.\tThese\tcontrols\twill\tenforce\tthe principle\tthat\tonly\tauthorized\tindividuals\tshould\thave\taccess\tto\tthe\tinformation\tbased\ton their\tneed\tto\taccess\tthe\tinformation\tas\ta\tpart\tof\ttheir\tresponsibilities. Version\t7 14.6\tProtect\tInformation\tthrough\tAccess\tControl\tLists Protect\tall\tinformation\tstored\ton\tsystems\twith\tfile\tsystem,\tnetwork\tshare,\tclaims, application,\tor\tdatabase\tspecific\taccess\tcontrol\tlists.\tThese\tcontrols\twill\tenforce\tthe principle\tthat\tonly\tauthorized\tindividuals\tshould\thave\taccess\tto\tthe\tinformation\tbased\ton their\tneed\tto\taccess\tthe\tinformation\tas\ta\tpart\tof\ttheir\tresponsibilities.  67\t|\tP a g e"
  },
  {
    "id": "3.10",
    "title": "Ensure Windows local groups are not SQL Logins",
    "assessment": "Scored",
    "description": "Local\tWindows\tgroups\tshould\tnot\tbe\tused\tas\tlogins\tfor\tSQL\tServer\tinstances.",
    "rationale": "Allowing\tlocal\tWindows\tgroups\tas\tSQL\tLogins\tprovides\ta\tloophole\twhereby\tanyone\twith OS\tlevel\tadministrator\trights\t(and\tno\tSQL\tServer\trights)\tcould\tadd\tusers\tto\tthe\tlocal Windows\tgroups\tand\tthereby\tgive\tthemselves\tor\tothers\taccess\tto\tthe\tSQL\tServer\tinstance.",
    "audit": "Use\tthe\tfollowing\tsyntax\tto\tdetermine\tif\tany\tlocal\tgroups\thave\tbeen\tadded\tas\tSQL\tServer Logins. USE [master] GO SELECT pr.[name] AS LocalGroupName, pe.[permission_name], pe.[state_desc] FROM sys.server_principals pr JOIN sys.server_permissions pe ON pr.[principal_id] = pe.[grantee_principal_id] WHERE pr.[type_desc] = 'WINDOWS_GROUP' AND pr.[name] like CAST(SERVERPROPERTY('MachineName') AS nvarchar) + '%'; This\tquery\tshould\tnot\treturn\tany\trows.",
    "remediation": "1. For\teach\tLocalGroupName\tlogin,\tif\tneeded\tcreate\tan\tequivalent\tAD\tgroup\tcontaining only\tthe\trequired\tuser\taccounts. 2. Add\tthe\tAD\tgroup\tor\tindividual\tWindows\taccounts\tas\ta\tSQL\tServer\tlogin\tand\tgrant\tit the\tpermissions\trequired. 3. Drop\tthe\tLocalGroupName\tlogin\tusing\tthe\tsyntax\tbelow\tafter\treplacing <name> . USE [master] GO DROP LOGIN [ <name> ] GO   68\t|\tP a g e Impact: Before\tdropping\tthe\tlocal\tgroup\tlogins,\tensure\tthat\talternative\tAD\tGroups\tor\tWindows logins\thave\tbeen\tadded\twith\tequivalent\tpermissions.\tOtherwise,\tthe\tSQL\tServer\tinstance may\tbecome\ttotally\tinaccessible. Default\tValue: By\tdefault,\tno\tlocal\tgroups\tare\tadded\tas\tSQL\tlogins. CIS\tControls: Version\t6 14.4\tProtect\tInformation\tWith\tAccess\tControl\tLists All\tinformation\tstored\ton\tsystems\tshall\tbe\tprotected\twith\tfile\tsystem,\tnetwork\tshare, claims,\tapplication,\tor\tdatabase\tspecific\taccess\tcontrol\tlists.\tThese\tcontrols\twill\tenforce\tthe principle\tthat\tonly\tauthorized\tindividuals\tshould\thave\taccess\tto\tthe\tinformation\tbased\ton their\tneed\tto\taccess\tthe\tinformation\tas\ta\tpart\tof\ttheir\tresponsibilities. Version\t7 14.6\tProtect\tInformation\tthrough\tAccess\tControl\tLists Protect\tall\tinformation\tstored\ton\tsystems\twith\tfile\tsystem,\tnetwork\tshare,\tclaims, application,\tor\tdatabase\tspecific\taccess\tcontrol\tlists.\tThese\tcontrols\twill\tenforce\tthe principle\tthat\tonly\tauthorized\tindividuals\tshould\thave\taccess\tto\tthe\tinformation\tbased\ton their\tneed\tto\taccess\tthe\tinformation\tas\ta\tpart\tof\ttheir\tresponsibilities.  69\t|\tP a g e",
    "function_names": [
      "sql_server_local_group_login_restricted",
      "sql_server_windows_group_login_disabled",
      "sql_server_local_group_sql_auth_blocked",
      "sql_server_windows_group_sql_login_denied",
      "sql_server_local_group_login_prohibited"
    ],
    "impact": "Before\tdropping\tthe\tlocal\tgroup\tlogins,\tensure\tthat\talternative\tAD\tGroups\tor\tWindows logins\thave\tbeen\tadded\twith\tequivalent\tpermissions.\tOtherwise,\tthe\tSQL\tServer\tinstance may\tbecome\ttotally\tinaccessible. Default\tValue: By\tdefault,\tno\tlocal\tgroups\tare\tadded\tas\tSQL\tlogins. CIS\tControls: Version\t6 14.4\tProtect\tInformation\tWith\tAccess\tControl\tLists All\tinformation\tstored\ton\tsystems\tshall\tbe\tprotected\twith\tfile\tsystem,\tnetwork\tshare, claims,\tapplication,\tor\tdatabase\tspecific\taccess\tcontrol\tlists.\tThese\tcontrols\twill\tenforce\tthe principle\tthat\tonly\tauthorized\tindividuals\tshould\thave\taccess\tto\tthe\tinformation\tbased\ton their\tneed\tto\taccess\tthe\tinformation\tas\ta\tpart\tof\ttheir\tresponsibilities. Version\t7 14.6\tProtect\tInformation\tthrough\tAccess\tControl\tLists Protect\tall\tinformation\tstored\ton\tsystems\twith\tfile\tsystem,\tnetwork\tshare,\tclaims, application,\tor\tdatabase\tspecific\taccess\tcontrol\tlists.\tThese\tcontrols\twill\tenforce\tthe principle\tthat\tonly\tauthorized\tindividuals\tshould\thave\taccess\tto\tthe\tinformation\tbased\ton their\tneed\tto\taccess\tthe\tinformation\tas\ta\tpart\tof\ttheir\tresponsibilities.  69\t|\tP a g e"
  },
  {
    "id": "3.11",
    "title": "Ensure the public role in the msdb database is not granted access to SQL Agent proxies",
    "assessment": "Scored",
    "description": "The\tpublic\tdatabase\trole\tcontains\tevery\tuser\tin\tthe\tmsdb\tdatabase.\tSQL\tAgent\tproxies define\ta\tsecurity\tcontext\tin\twhich\ta\tjob\tstep\tcan\trun.",
    "rationale": "Granting\taccess\tto\tSQL\tAgent\tproxies\tfor\tthe\tpublic\trole\twould\tallow\tall\tusers\tto\tutilize\tthe proxy\twhich\tmay\thave\thigh\tprivileges.\tThis\twould\tlikely\tbreak\tthe\tprinciple\tof\tleast privileges.",
    "audit": "Use\tthe\tfollowing\tsyntax\tto\tdetermine\tif\taccess\tto\tany\tproxies\thave\tbeen\tgranted\tto\tthe msdb\tdatabase's\tpublic\trole. USE [msdb] GO SELECT sp.name AS proxyname FROM dbo.sysproxylogin spl JOIN sys.database_principals dp ON dp.sid = spl.sid JOIN sysproxies sp ON sp.proxy_id = spl.proxy_id WHERE principal_id = USER_ID('public'); GO This\tquery\tshould\tnot\treturn\tany\trows.",
    "remediation": "1. Ensure\tthe\trequired\tsecurity\tprincipals\tare\texplicitly\tgranted\taccess\tto\tthe\tproxy (use\tsp_grant_login_to_proxy). 2. Revoke\taccess\tto\tthe <proxyname> from\tthe\tpublic\trole. USE [msdb] GO EXEC dbo.sp_revoke_login_from_proxy @name = N'public', @proxy_name = N' <proxyname> '; GO  70\t|\tP a g e Impact: Before\trevoking\tthe\tpublic\trole\tfrom\tthe\tproxy,\tensure\tthat\talternative\tlogins\tor appropriate\tuser-defined\tdatabase\troles\thave\tbeen\tadded\twith\tequivalent\tpermissions. Otherwise,\tSQL\tAgent\tjob\tsteps\tdependent\tupon\tthis\taccess\twill\tfail. Default\tValue: By\tdefault,\tthe\tmsdb\tpublic\tdatabase\trole\tdoes\tnot\thave\taccess\tto\tany\tproxy. References: 1. https://support.microsoft.com/en-us/help/2160741/best-practices-in-configuring- sql-server-agent-proxy-account CIS\tControls: Version\t6 14.4\tProtect\tInformation\tWith\tAccess\tControl\tLists All\tinformation\tstored\ton\tsystems\tshall\tbe\tprotected\twith\tfile\tsystem,\tnetwork\tshare, claims,\tapplication,\tor\tdatabase\tspecific\taccess\tcontrol\tlists.\tThese\tcontrols\twill\tenforce\tthe principle\tthat\tonly\tauthorized\tindividuals\tshould\thave\taccess\tto\tthe\tinformation\tbased\ton their\tneed\tto\taccess\tthe\tinformation\tas\ta\tpart\tof\ttheir\tresponsibilities. Version\t7 14.6\tProtect\tInformation\tthrough\tAccess\tControl\tLists Protect\tall\tinformation\tstored\ton\tsystems\twith\tfile\tsystem,\tnetwork\tshare,\tclaims, application,\tor\tdatabase\tspecific\taccess\tcontrol\tlists.\tThese\tcontrols\twill\tenforce\tthe principle\tthat\tonly\tauthorized\tindividuals\tshould\thave\taccess\tto\tthe\tinformation\tbased\ton their\tneed\tto\taccess\tthe\tinformation\tas\ta\tpart\tof\ttheir\tresponsibilities.  71\t|\tP a g e 4 Password Policies This\tsection\tcontains\trecommendations\trelated\tto\tSQL\tServer's\tpassword\tpolicies.",
    "function_names": [
      "sql_database_public_role_no_agent_proxy_access",
      "sql_msdb_public_role_proxy_access_restricted",
      "sql_agent_proxy_public_role_access_denied",
      "sql_msdb_public_role_no_proxy_permissions",
      "sql_database_proxy_access_public_role_blocked"
    ],
    "impact": "Before\trevoking\tthe\tpublic\trole\tfrom\tthe\tproxy,\tensure\tthat\talternative\tlogins\tor appropriate\tuser-defined\tdatabase\troles\thave\tbeen\tadded\twith\tequivalent\tpermissions. Otherwise,\tSQL\tAgent\tjob\tsteps\tdependent\tupon\tthis\taccess\twill\tfail. Default\tValue: By\tdefault,\tthe\tmsdb\tpublic\tdatabase\trole\tdoes\tnot\thave\taccess\tto\tany\tproxy.",
    "references": "1. https://support.microsoft.com/en-us/help/2160741/best-practices-in-configuring- sql-server-agent-proxy-account CIS\tControls: Version\t6 14.4\tProtect\tInformation\tWith\tAccess\tControl\tLists All\tinformation\tstored\ton\tsystems\tshall\tbe\tprotected\twith\tfile\tsystem,\tnetwork\tshare, claims,\tapplication,\tor\tdatabase\tspecific\taccess\tcontrol\tlists.\tThese\tcontrols\twill\tenforce\tthe principle\tthat\tonly\tauthorized\tindividuals\tshould\thave\taccess\tto\tthe\tinformation\tbased\ton their\tneed\tto\taccess\tthe\tinformation\tas\ta\tpart\tof\ttheir\tresponsibilities. Version\t7 14.6\tProtect\tInformation\tthrough\tAccess\tControl\tLists Protect\tall\tinformation\tstored\ton\tsystems\twith\tfile\tsystem,\tnetwork\tshare,\tclaims, application,\tor\tdatabase\tspecific\taccess\tcontrol\tlists.\tThese\tcontrols\twill\tenforce\tthe principle\tthat\tonly\tauthorized\tindividuals\tshould\thave\taccess\tto\tthe\tinformation\tbased\ton their\tneed\tto\taccess\tthe\tinformation\tas\ta\tpart\tof\ttheir\tresponsibilities.  71\t|\tP a g e 4 Password Policies This\tsection\tcontains\trecommendations\trelated\tto\tSQL\tServer's\tpassword\tpolicies."
  },
  {
    "id": "4.1",
    "title": "Ensure 'MUST_CHANGE' Option is set to 'ON' for All SQL Authenticated Logins",
    "assessment": "Not Scored",
    "description": "Whenever\tthis\toption\tis\tset\tto\tON,\tSQL\tServer\twill\tprompt\tfor\tan\tupdated\tpassword\tthe\tfirst time\tthe\tnew\tor\taltered\tlogin\tis\tused.",
    "rationale": "Enforcing\ta\tpassword\tchange\tafter\ta\treset\tor\tnew\tlogin\tcreation\twill\tprevent\tthe\taccount administrators\tor\tanyone\taccessing\tthe\tinitial\tpassword\tfrom\tmisuse\tof\tthe\tSQL\tlogin created\twithout\tbeing\tnoticed.",
    "audit": "1. Open SQL\tServer\tManagement\tStudio . 2. Open Object\tExplorer and\tconnect\tto\tthe\ttarget\tinstance. 3. Navigate\tto\tthe Logins tab\tin Object\tExplorer and\texpand.\tRight\tclick\ton\tthe desired\tlogin\tand\tselect Properties . 4. Verify\tthe\tUser\tmust\tchange\tpassword\tat\tnext\tlogin\tcheckbox\tis\tchecked. Note: This\taudit\tprocedure\tis\tonly\tapplicable\timmediately\tafter\tthe\tlogin\thas\tbeen\tcreated or\taltered\tto\tforce\tthe\tpassword\tchange.\tOnce\tthe\tpassword\tis\tchanged,\tthere\tis\tno\tway\tto know\tspecifically\tthat\tthis\toption\twas\tthe\tforcing\tmechanism\tbehind\ta\tpassword\tchange.",
    "remediation": "Set\tthe\tMUST_CHANGE\toption\tfor\tSQL\tAuthenticated\tlogins\twhen\tcreating\ta\tlogin\tinitially: CREATE LOGIN <login_name> WITH PASSWORD = ' <password_value> ' MUST_CHANGE, CHECK_EXPIRATION = ON, CHECK_POLICY = ON; Set\tthe\tMUST_CHANGE\toption\tfor\tSQL\tAuthenticated\tlogins\twhen\tresetting\ta\tpassword: ALTER LOGIN <login_name> WITH PASSWORD = ' <password_value> ' MUST_CHANGE;  72\t|\tP a g e Impact: CHECK_EXPIRATION\tand\tCHECK_POLICY\toptions\tmust\tboth\tbe\tON.\tEnd\tusers\tmust\thave\tthe means\t(application)\tto\tchange\tthe\tpassword\twhen\tforced. Default\tValue: ON\twhen\tcreating\ta\tnew\tlogin\tvia\tthe\tSSMS\tGUI.\tOFF\twhen\tcreating\ta\tnew\tlogin\tusing\tT-SQL CREATE LOGIN\tunless\tthe\tMUST_CHANGE\toption\tis\texplicitly\tincluded\talong\twith CHECK_EXPIRATION = ON. References: 1. https://docs.microsoft.com/en-us/sql/t-sql/statements/alter-login-transact-sql 2. https://docs.microsoft.com/en-us/sql/t-sql/statements/create-login-transact-sql CIS\tControls: Version\t6 16\tAccount\tMonitoring\tand\tControl Account\tMonitoring\tand\tControl Version\t7 4.2\tChange\tDefault\tPasswords Before\tdeploying\tany\tnew\tasset,\tchange\tall\tdefault\tpasswords\tto\thave\tvalues\tconsistent with\tadministrative\tlevel\taccounts.  73\t|\tP a g e",
    "function_names": [
      "sql_login_must_change_enabled",
      "sql_auth_login_password_reset_required",
      "sql_server_login_initial_password_change_enabled",
      "sql_auth_login_first_use_password_change_required"
    ],
    "impact": "CHECK_EXPIRATION\tand\tCHECK_POLICY\toptions\tmust\tboth\tbe\tON.\tEnd\tusers\tmust\thave\tthe means\t(application)\tto\tchange\tthe\tpassword\twhen\tforced. Default\tValue: ON\twhen\tcreating\ta\tnew\tlogin\tvia\tthe\tSSMS\tGUI.\tOFF\twhen\tcreating\ta\tnew\tlogin\tusing\tT-SQL CREATE LOGIN\tunless\tthe\tMUST_CHANGE\toption\tis\texplicitly\tincluded\talong\twith CHECK_EXPIRATION = ON.",
    "references": "1. https://docs.microsoft.com/en-us/sql/t-sql/statements/alter-login-transact-sql 2. https://docs.microsoft.com/en-us/sql/t-sql/statements/create-login-transact-sql CIS\tControls: Version\t6 16\tAccount\tMonitoring\tand\tControl Account\tMonitoring\tand\tControl Version\t7 4.2\tChange\tDefault\tPasswords Before\tdeploying\tany\tnew\tasset,\tchange\tall\tdefault\tpasswords\tto\thave\tvalues\tconsistent with\tadministrative\tlevel\taccounts.  73\t|\tP a g e"
  },
  {
    "id": "4.2",
    "title": "Ensure 'CHECK_EXPIRATION' Option is set to 'ON' for All SQL Authenticated Logins Within the Sysadmin Role",
    "assessment": "Scored",
    "description": "Applies\tthe\tsame\tpassword\texpiration\tpolicy\tused\tin\tWindows\tto\tpasswords\tused\tinside SQL\tServer.",
    "rationale": "Ensuring\tSQL\tlogins\tcomply\twith\tthe\tsecure\tpassword\tpolicy\tapplied\tby\tthe\tWindows Server\tBenchmark\twill\tensure\tthe\tpasswords\tfor\tSQL\tlogins\twith\tsysadmin\tprivileges\tare changed\ton\ta\tfrequent\tbasis\tto\thelp\tprevent\tcompromise\tvia\ta\tbrute\tforce\tattack.\tCONTROL SERVER\tis\tan\tequivalent\tpermission\tto\tsysadmin\tand\tlogins\twith\tthat\tpermission\tshould also\tbe\trequired\tto\thave\texpiring\tpasswords.",
    "audit": "Run\tthe\tfollowing\tT-SQL\tstatement\tto\tfind\tsysadmin\tlogins\twith\tCHECK_EXPIRATION OFF.\tNo rows\tshould\tbe\treturned. SELECT l.[name], 'sysadmin membership' AS 'Access_Method' FROM sys.sql_logins AS l WHERE IS_SRVROLEMEMBER('sysadmin',name) = 1 AND l.is_expiration_checked <> 1 UNION ALL SELECT l.[name], 'CONTROL SERVER' AS 'Access_Method' FROM sys.sql_logins AS l JOIN sys.server_permissions AS p ON l.principal_id = p.grantee_principal_id WHERE p.type = 'CL' AND p.state IN ('G', 'W') AND l.is_expiration_checked <> 1;",
    "remediation": "For\teach <login_name> found\tby\tthe\tAudit\tProcedure,\texecute\tthe\tfollowing\tT-SQL statement: ALTER LOGIN <login_name> WITH CHECK_EXPIRATION = ON;  74\t|\tP a g e Impact: This\tis\ta\tmitigating\trecommendation\tfor\tsystems\twhich\tcannot\tfollow\tthe\trecommendation to\tuse\tonly\tWindows\tAuthenticated\tlogins. Regarding\tlimiting\tthis\trule\tto\tonly\tlogins\twith\tsysadmin\tand\tCONTROL SERVER\tprivileges, there\tare\ttoo\tmany\tcases\tof\tapplications\tthat\trun\twith\tless\tthan\tsysadmin\tlevel\tprivileges that\thave\thard-coded\tpasswords\tor\teffectively\thard-coded\tpasswords\t(whatever\tis\tset\tthe first\ttime\tis\tnearly\timpossible\tto\tchange).\tThere\tare\tseveral\tlines\tof\tbusiness\tapplications that\tare\tconsidered\tbest\tof\tbreed\twhich\thas\tthis\tfailing. Also,\tkeep\tin\tmind\tthat\tthe\tpassword\tpolicy\tis\ttaken\tfrom\tthe\tcomputer's\tlocal\tpolicy, which\twill\ttake\tfrom\tthe\tDefault\tDomain\tPolicy\tsetting.\tMany\torganizations\thave\ta\tdifferent password\tpolicy\twith\tregards\tto\tservice\taccounts.\tThese\tare\thandled\tin\tAD\tby\tsetting\tthe account's\tpassword\tnot\tto\texpire\tand\thaving\tsome\tother\tprocess\ttrack\twhen\tthey\tneed\tto be\tchanged.\tWith\tthis\tsecond\tcontrol\tin\tplace,\tthis\tis\tperfectly\tacceptable\tfrom\tan\taudit perspective.\tIf\tyou\ttreat\ta\tSQL\tServer\tlogin\tas\ta\tservice\taccount,\tthen\tyou\thave\tto\tdo\tthe same.\tThis\tensures\tthat\tthe\tpassword\tchange\thappens\tduring\ta\tcommunicated\tdowntime window\tand\tnot\tarbitrarily. Default\tValue: CHECK_EXPIRATION\tis\tON\tby\tdefault\twhen\tusing\tSSMS\tto\tcreate\ta\tSQL\tauthenticated\tlogin. CHECK_EXPIRATION\tis\tOFF\tby\tdefault\twhen\tusing\tT-SQL\tCREATE LOGIN\tsyntax\twithout specifying\tthe\tCHECK_EXPIRATION\toption. References: 1. http://msdn.microsoft.com/en-us/library/ms161959(v=sql.120).aspx CIS\tControls: Version\t6 16.2\tAll\tAccounts\tHave\tA\tMonitored\tExpiration\tDate Ensure\tthat\tall\taccounts\thave\tan\texpiration\tdate\tthat\tis\tmonitored\tand\tenforced. Version\t7 16.10\tEnsure\tAll\tAccounts\tHave\tAn\tExpiration\tDate Ensure\tthat\tall\taccounts\thave\tan\texpiration\tdate\tthat\tis\tmonitored\tand\tenforced.  75\t|\tP a g e",
    "function_names": [
      "sql_server_login_check_expiration_enabled",
      "sql_server_sysadmin_login_password_expiration_enabled",
      "sql_server_auth_login_password_policy_enabled",
      "sql_server_sysadmin_login_check_expiration_on",
      "sql_server_login_password_expiration_required"
    ],
    "impact": "This\tis\ta\tmitigating\trecommendation\tfor\tsystems\twhich\tcannot\tfollow\tthe\trecommendation to\tuse\tonly\tWindows\tAuthenticated\tlogins. Regarding\tlimiting\tthis\trule\tto\tonly\tlogins\twith\tsysadmin\tand\tCONTROL SERVER\tprivileges, there\tare\ttoo\tmany\tcases\tof\tapplications\tthat\trun\twith\tless\tthan\tsysadmin\tlevel\tprivileges that\thave\thard-coded\tpasswords\tor\teffectively\thard-coded\tpasswords\t(whatever\tis\tset\tthe first\ttime\tis\tnearly\timpossible\tto\tchange).\tThere\tare\tseveral\tlines\tof\tbusiness\tapplications that\tare\tconsidered\tbest\tof\tbreed\twhich\thas\tthis\tfailing. Also,\tkeep\tin\tmind\tthat\tthe\tpassword\tpolicy\tis\ttaken\tfrom\tthe\tcomputer's\tlocal\tpolicy, which\twill\ttake\tfrom\tthe\tDefault\tDomain\tPolicy\tsetting.\tMany\torganizations\thave\ta\tdifferent password\tpolicy\twith\tregards\tto\tservice\taccounts.\tThese\tare\thandled\tin\tAD\tby\tsetting\tthe account's\tpassword\tnot\tto\texpire\tand\thaving\tsome\tother\tprocess\ttrack\twhen\tthey\tneed\tto be\tchanged.\tWith\tthis\tsecond\tcontrol\tin\tplace,\tthis\tis\tperfectly\tacceptable\tfrom\tan\taudit perspective.\tIf\tyou\ttreat\ta\tSQL\tServer\tlogin\tas\ta\tservice\taccount,\tthen\tyou\thave\tto\tdo\tthe same.\tThis\tensures\tthat\tthe\tpassword\tchange\thappens\tduring\ta\tcommunicated\tdowntime window\tand\tnot\tarbitrarily. Default\tValue: CHECK_EXPIRATION\tis\tON\tby\tdefault\twhen\tusing\tSSMS\tto\tcreate\ta\tSQL\tauthenticated\tlogin. CHECK_EXPIRATION\tis\tOFF\tby\tdefault\twhen\tusing\tT-SQL\tCREATE LOGIN\tsyntax\twithout specifying\tthe\tCHECK_EXPIRATION\toption.",
    "references": "1. http://msdn.microsoft.com/en-us/library/ms161959(v=sql.120).aspx CIS\tControls: Version\t6 16.2\tAll\tAccounts\tHave\tA\tMonitored\tExpiration\tDate Ensure\tthat\tall\taccounts\thave\tan\texpiration\tdate\tthat\tis\tmonitored\tand\tenforced. Version\t7 16.10\tEnsure\tAll\tAccounts\tHave\tAn\tExpiration\tDate Ensure\tthat\tall\taccounts\thave\tan\texpiration\tdate\tthat\tis\tmonitored\tand\tenforced.  75\t|\tP a g e"
  },
  {
    "id": "4.3",
    "title": "Ensure 'CHECK_POLICY' Option is set to 'ON' for All SQL Authenticated Logins",
    "assessment": "Scored",
    "description": "Applies\tthe\tsame\tpassword\tcomplexity\tpolicy\tused\tin\tWindows\tto\tpasswords\tused\tinside SQL\tServer.",
    "rationale": "Ensure\tSQL\tauthenticated\tlogin\tpasswords\tcomply\twith\tthe\tsecure\tpassword\tpolicy\tapplied by\tthe\tWindows\tServer\tBenchmark\tso\tthat\tthey\tcannot\tbe\teasily\tcompromised\tvia\tbrute force\tattack.",
    "audit": "Use\tthe\tfollowing\tcode\tsnippet\tto\tdetermine\tthe\tstatus\tof\tSQL\tLogins\tand\tif\ttheir\tpassword complexity\tis\tenforced. SELECT name, is_disabled FROM sys.sql_logins WHERE is_policy_checked = 0; The\tis_policy_checked\tvalue\tof\t0\tindicates\tthat\tthe\tCHECK_POLICY\toption\tis\tOFF;\tvalue\tof\t1 is\tON.\tIf\tis_disabled\tvalue\tis\t1,\tthen\tthe\tlogin\tis\tdisabled\tand\tunusable.\tIf\tno\trows\tare returned\tthen\teither\tno\tSQL\tAuthenticated\tlogins\texist\tor\tthey\tall\thave\tCHECK_POLICY\tON.",
    "remediation": "For\teach <login_name> found\tby\tthe\tAudit\tProcedure,\texecute\tthe\tfollowing\tT-SQL statement: ALTER LOGIN <login_name> WITH CHECK_POLICY = ON; Note: In\tthe\tcase\tof\tAWS\tRDS\tdo\tnot\tperform\tthis\tremediation\tfor\tthe\tMaster\taccount.  76\t|\tP a g e Impact: This\tis\ta\tmitigating\trecommendation\tfor\tsystems\twhich\tcannot\tfollow\tthe\trecommendation to\tuse\tonly\tWindows\tAuthenticated\tlogins. Weak\tpasswords\tcan\tlead\tto\tcompromised\tsystems.\tSQL\tServer\tauthenticated\tlogins\twill utilize\tthe\tpassword\tpolicy\tset\tin\tthe\tcomputer's\tlocal\tpolicy,\twhich\tis\ttypically\tset\tby\tthe Default\tDomain\tPolicy\tsetting. The\tsetting\tis\tonly\tenforced\twhen\tthe\tpassword\tis\tchanged.\tThis\tsetting\tdoes\tnot\tforce existing\tweak\tpasswords\tto\tbe\tchanged. Default\tValue: CHECK_POLICY\tis\tON References: 1. http://msdn.microsoft.com/en-us/library/ms161959(v=sql.120).aspx CIS\tControls: Version\t6 16\tAccount\tMonitoring\tand\tControl Account\tMonitoring\tand\tControl Version\t7 4.4\tUse\tUnique\tPasswords Where\tmulti-factor\tauthentication\tis\tnot\tsupported\t(such\tas\tlocal\tadministrator,\troot,\tor service\taccounts),\taccounts\twill\tuse\tpasswords\tthat\tare\tunique\tto\tthat\tsystem.  77\t|\tP a g e 5 Auditing and Logging This\tsection\tcontains\trecommendations\trelated\tto\tSQL\tServer's\taudit\tand\tlogging mechanisms.",
    "function_names": [
      "sql_login_password_policy_enabled",
      "sql_auth_login_check_policy_enabled",
      "sql_server_password_complexity_enabled",
      "sql_login_windows_policy_enabled",
      "sql_auth_password_policy_compliance",
      "sql_server_check_policy_enabled",
      "sql_login_password_complexity_enabled",
      "sql_auth_login_policy_compliance"
    ],
    "impact": "This\tis\ta\tmitigating\trecommendation\tfor\tsystems\twhich\tcannot\tfollow\tthe\trecommendation to\tuse\tonly\tWindows\tAuthenticated\tlogins. Weak\tpasswords\tcan\tlead\tto\tcompromised\tsystems.\tSQL\tServer\tauthenticated\tlogins\twill utilize\tthe\tpassword\tpolicy\tset\tin\tthe\tcomputer's\tlocal\tpolicy,\twhich\tis\ttypically\tset\tby\tthe Default\tDomain\tPolicy\tsetting. The\tsetting\tis\tonly\tenforced\twhen\tthe\tpassword\tis\tchanged.\tThis\tsetting\tdoes\tnot\tforce existing\tweak\tpasswords\tto\tbe\tchanged. Default\tValue: CHECK_POLICY\tis\tON",
    "references": "1. http://msdn.microsoft.com/en-us/library/ms161959(v=sql.120).aspx CIS\tControls: Version\t6 16\tAccount\tMonitoring\tand\tControl Account\tMonitoring\tand\tControl Version\t7 4.4\tUse\tUnique\tPasswords Where\tmulti-factor\tauthentication\tis\tnot\tsupported\t(such\tas\tlocal\tadministrator,\troot,\tor service\taccounts),\taccounts\twill\tuse\tpasswords\tthat\tare\tunique\tto\tthat\tsystem.  77\t|\tP a g e 5 Auditing and Logging This\tsection\tcontains\trecommendations\trelated\tto\tSQL\tServer's\taudit\tand\tlogging mechanisms."
  },
  {
    "id": "5.1",
    "title": "Ensure 'Maximum number of error log files' is set to greater than or equal to '12'",
    "assessment": "Scored",
    "description": "SQL\tServer\terror\tlog\tfiles\tmust\tbe\tprotected\tfrom\tloss.\tThe\tlog\tfiles\tmust\tbe\tbacked\tup before\tthey\tare\toverwritten.\tRetaining\tmore\terror\tlogs\thelps\tprevent\tloss\tfrom\tfrequent recycling\tbefore\tbackups\tcan\toccur.",
    "rationale": "The\tSQL\tServer\terror\tlog\tcontains\timportant\tinformation\tabout\tmajor\tserver\tevents\tand login\tattempt\tinformation\tas\twell.",
    "audit": "Perform\teither\tthe\tGUI\tor\tT-SQL\tmethod\tshown: GUI\tMethod 1. Open SQL\tServer\tManagement\tStudio . 2. Open Object\tExplorer and\tconnect\tto\tthe\ttarget\tinstance. 3. Navigate\tto\tthe Management tab\tin Object\tExplorer and\texpand.\tRight\tclick\ton\tthe SQL\tServer\tLogs file\tand\tselect Configure . 4. Verify\tthe Limit\tthe\tnumber\tof\terror\tlog\tfiles\tbefore\tthey\tare\trecycled checkbox is\tchecked 5. Verify\tthe Maximum\tnumber\tof\terror\tlog\tfiles is\tgreater\tthan\tor\tequal\tto\t12 T-SQL\tMethod Run\tthe\tfollowing\tT-SQL.\tThe\tNumberOfLogFiles\treturned\tshould\tbe\tgreater\tthan\tor\tequal to\t12.  78\t|\tP a g e DECLARE @NumErrorLogs int; EXEC master.sys.xp_instance_regread N'HKEY_LOCAL_MACHINE', N'Software\\Microsoft\\MSSQLServer\\MSSQLServer', N'NumErrorLogs', @NumErrorLogs OUTPUT; SELECT ISNULL(@NumErrorLogs, -1) AS [NumberOfLogFiles];",
    "remediation": "Adjust\tthe\tnumber\tof\tlogs\tto\tprevent\tdata\tloss.\tThe\tdefault\tvalue\tof\t6\tmay\tbe\tinsufficient\tfor a\tproduction\tenvironment.\tPerform\teither\tthe\tGUI\tor\tT-SQL\tmethod\tshown: GUI\tMethod 1. Open SQL\tServer\tManagement\tStudio . 2. Open Object\tExplorer and\tconnect\tto\tthe\ttarget\tinstance. 3. Navigate\tto\tthe Management tab\tin Object\tExplorer and\texpand.\tRight\tclick\ton\tthe SQL\tServer\tLogs\tfile and\tselect Configure 4. Check\tthe Limit\tthe\tnumber\tof\terror\tlog\tfiles\tbefore\tthey\tare\trecycled 5. Set\tthe Maximum\tnumber\tof\terror\tlog\tfiles to\tgreater\tthan\tor\tequal\tto\t12 T-SQL\tMethod Run\tthe\tfollowing\tT-SQL\tto\tchange\tthe\tnumber\tof\terror\tlog\tfiles,\treplace <NumberAbove12> with\tyour\tdesired\tnumber\tof\terror\tlog\tfiles: EXEC master.sys.xp_instance_regwrite N'HKEY_LOCAL_MACHINE', N'Software\\Microsoft\\MSSQLServer\\MSSQLServer', N'NumErrorLogs', REG_DWORD, <NumberAbove12> ; Impact: Once\tthe\tmax\tnumber\tof\terror\tlogs\tis\treached,\tthe\toldest\terror\tlog\tfile\tis\tdeleted\teach\ttime SQL\tServer\trestarts\tor\tsp_cycle_errorlog\tis\texecuted. Default\tValue: 6\tSQL\tServer\terror\tlog\tfiles\tin\taddition\tto\tthe\tcurrent\terror\tlog\tfile\tare\tretained\tby\tdefault. References: 1. http://msdn.microsoft.com/en-us/library/ms177285(v=sql.120).aspx  79\t|\tP a g e CIS\tControls: Version\t6 6.3\tEnsure\tAudit\tLogging\tSystems\tAre\tNot\tSubject\tTo\tLoss\t(i.e.\trotation/archive) Ensure\tthat\tall\tsystems\tthat\tstore\tlogs\thave\tadequate\tstorage\tspace\tfor\tthe\tlogs generated\ton\ta\tregular\tbasis,\tso\tthat\tlog\tfiles\twill\tnot\tfill\tup\tbetween\tlog\trotation\tintervals. The\tlogs\tmust\tbe\tarchived\tand\tdigitally\tsigned\ton\ta\tperiodic\tbasis. Version\t7 6.4\tEnsure\tadequate\tstorage\tfor\tlogs Ensure\tthat\tall\tsystems\tthat\tstore\tlogs\thave\tadequate\tstorage\tspace\tfor\tthe\tlogs generated.  80\t|\tP a g e",
    "function_names": [
      "sql_server_error_log_max_files_ge_12",
      "sql_server_error_log_retention_sufficient",
      "sql_server_error_log_backup_protected",
      "sql_server_error_log_recycling_prevented"
    ],
    "impact": "Once\tthe\tmax\tnumber\tof\terror\tlogs\tis\treached,\tthe\toldest\terror\tlog\tfile\tis\tdeleted\teach\ttime SQL\tServer\trestarts\tor\tsp_cycle_errorlog\tis\texecuted. Default\tValue: 6\tSQL\tServer\terror\tlog\tfiles\tin\taddition\tto\tthe\tcurrent\terror\tlog\tfile\tare\tretained\tby\tdefault.",
    "references": "1. http://msdn.microsoft.com/en-us/library/ms177285(v=sql.120).aspx  79\t|\tP a g e CIS\tControls: Version\t6 6.3\tEnsure\tAudit\tLogging\tSystems\tAre\tNot\tSubject\tTo\tLoss\t(i.e.\trotation/archive) Ensure\tthat\tall\tsystems\tthat\tstore\tlogs\thave\tadequate\tstorage\tspace\tfor\tthe\tlogs generated\ton\ta\tregular\tbasis,\tso\tthat\tlog\tfiles\twill\tnot\tfill\tup\tbetween\tlog\trotation\tintervals. The\tlogs\tmust\tbe\tarchived\tand\tdigitally\tsigned\ton\ta\tperiodic\tbasis. Version\t7 6.4\tEnsure\tadequate\tstorage\tfor\tlogs Ensure\tthat\tall\tsystems\tthat\tstore\tlogs\thave\tadequate\tstorage\tspace\tfor\tthe\tlogs generated.  80\t|\tP a g e"
  },
  {
    "id": "5.2",
    "title": "Ensure 'Default Trace Enabled' Server Configuration Option is set to '1'",
    "assessment": "Scored",
    "description": "The\tdefault\ttrace\tprovides\taudit\tlogging\tof\tdatabase\tactivity\tincluding\taccount\tcreations, privilege\televation\tand\texecution\tof\tDBCC\tcommands.",
    "rationale": "Default\ttrace\tprovides\tvaluable\taudit\tinformation\tregarding\tsecurity-related\tactivities\ton the\tserver.",
    "audit": "Run\tthe\tfollowing\tT-SQL\tcommand: SELECT name, CAST(value as int) as value_configured, CAST(value_in_use as int) as value_in_use FROM sys.configurations WHERE name = 'default trace enabled'; Both\tvalue\tcolumns\tmust\tshow\t1.",
    "remediation": "Run\tthe\tfollowing\tT-SQL\tcommand: EXECUTE sp_configure 'show advanced options', 1; RECONFIGURE; EXECUTE sp_configure 'default trace enabled', 1; RECONFIGURE; GO EXECUTE sp_configure 'show advanced options', 0; RECONFIGURE; Default\tValue: 1\t(on)  81\t|\tP a g e References: 1. https://docs.microsoft.com/en-us/sql/database-engine/configure- windows/default-trace-enabled-server-configuration-option CIS\tControls: Version\t6 6.2\tEnsure\tAudit\tLog\tSettings\tSupport\tAppropriate\tLog\tEntry\tFormatting Validate\taudit\tlog\tsettings\tfor\teach\thardware\tdevice\tand\tthe\tsoftware\tinstalled\ton\tit, ensuring\tthat\tlogs\tinclude\ta\tdate,\ttimestamp,\tsource\taddresses,\tdestination\taddresses,\tand various\tother\tuseful\telements\tof\teach\tpacket\tand/or\ttransaction.\tSystems\tshould\trecord logs\tin\ta\tstandardized\tformat\tsuch\tas\tsyslog\tentries\tor\tthose\toutlined\tby\tthe\tCommon\tEvent Expression\tinitiative.\tIf\tsystems\tcannot\tgenerate\tlogs\tin\ta\tstandardized\tformat,\tlog normalization\ttools\tcan\tbe\tdeployed\tto\tconvert\tlogs\tinto\tsuch\ta\tformat. Version\t7 6.2\tActivate\taudit\tlogging Ensure\tthat\tlocal\tlogging\thas\tbeen\tenabled\ton\tall\tsystems\tand\tnetworking\tdevices. 6.3\tEnable\tDetailed\tLogging Enable\tsystem\tlogging\tto\tinclude\tdetailed\tinformation\tsuch\tas\tan\tevent\tsource,\tdate, user,\ttimestamp,\tsource\taddresses,\tdestination\taddresses,\tand\tother\tuseful\telements.  82\t|\tP a g e",
    "function_names": [
      "sql_server_database_default_trace_enabled",
      "sql_server_audit_logging_enabled",
      "sql_server_trace_configuration_secure",
      "sql_server_dbcc_command_logging_enabled",
      "sql_server_privilege_elevation_logging_enabled",
      "sql_server_account_creation_logging_enabled",
      "sql_server_default_trace_setting_secure"
    ],
    "references": "1. https://docs.microsoft.com/en-us/sql/database-engine/configure- windows/default-trace-enabled-server-configuration-option CIS\tControls: Version\t6 6.2\tEnsure\tAudit\tLog\tSettings\tSupport\tAppropriate\tLog\tEntry\tFormatting Validate\taudit\tlog\tsettings\tfor\teach\thardware\tdevice\tand\tthe\tsoftware\tinstalled\ton\tit, ensuring\tthat\tlogs\tinclude\ta\tdate,\ttimestamp,\tsource\taddresses,\tdestination\taddresses,\tand various\tother\tuseful\telements\tof\teach\tpacket\tand/or\ttransaction.\tSystems\tshould\trecord logs\tin\ta\tstandardized\tformat\tsuch\tas\tsyslog\tentries\tor\tthose\toutlined\tby\tthe\tCommon\tEvent Expression\tinitiative.\tIf\tsystems\tcannot\tgenerate\tlogs\tin\ta\tstandardized\tformat,\tlog normalization\ttools\tcan\tbe\tdeployed\tto\tconvert\tlogs\tinto\tsuch\ta\tformat. Version\t7 6.2\tActivate\taudit\tlogging Ensure\tthat\tlocal\tlogging\thas\tbeen\tenabled\ton\tall\tsystems\tand\tnetworking\tdevices. 6.3\tEnable\tDetailed\tLogging Enable\tsystem\tlogging\tto\tinclude\tdetailed\tinformation\tsuch\tas\tan\tevent\tsource,\tdate, user,\ttimestamp,\tsource\taddresses,\tdestination\taddresses,\tand\tother\tuseful\telements.  82\t|\tP a g e"
  },
  {
    "id": "5.3",
    "title": "Ensure 'Login Auditing' is set to 'failed logins'",
    "assessment": "Scored",
    "description": "This\tsetting\twill\trecord\tfailed\tauthentication\tattempts\tfor\tSQL\tServer\tlogins\tto\tthe SQL Server\tErrorlog .\tThis\tis\tthe\tdefault\tsetting\tfor\tSQL\tServer. Historically,\tthis\tsetting\thas\tbeen\tavailable\tin\tall\tversions\tand\teditions\tof\tSQL\tServer.\tPrior to\tthe\tavailability\tof SQL\tServer\tAudit ,\tthis\twas\tthe\tonly\tprovided\tmechanism\tfor capturing\tlogins\t(successful\tor\tfailed).",
    "rationale": "Capturing\tfailed\tlogins\tprovides\tkey\tinformation\tthat\tcan\tbe\tused\tto\tdetect\\confirm password\tguessing\tattacks.\tCapturing\tsuccessful\tlogin\tattempts\tcan\tbe\tused\tto\tconfirm server\taccess\tduring\tforensic\tinvestigations,\tbut\tusing\tthis\taudit\tlevel\tsetting\tto\talso capture\tsuccessful\tlogins\tcreates\texcessive\tnoise\tin\tthe SQL\tServer\tErrorlog which\tcan hamper\ta\tDBA\ttrying\tto\ttroubleshoot\tproblems.\tElsewhere\tin\tthis\tbenchmark,\twe recommend\tusing\tthe\tnewer\tlightweight\tSQL\tServer\tAudit\tfeature\tto\tcapture\tboth successful\tand\tfailed\tlogins.",
    "audit": "EXEC xp_loginconfig 'audit level'; A\tconfig_value\tof\tfailure\tindicates\ta\tserver\tlogin\tauditing\tsetting\tof Failed\tlogins\tonly . If\ta\tconfig_value\tof\tall\tappears,\tthen\tboth\tfailed\tand\tsuccessful\tlogins\tare\tbeing\tlogged. Both\tsettings\tshould\talso\tbe\tconsidered\tvalid,\tbut\tas\tmentioned\tcapturing\tsuccessful\tlogins using\tthis\tmethod\tcreates\tlots\tof\tnoise\tin\tthe SQL\tServer\tErrorlog .",
    "remediation": "Perform\teither\tthe\tGUI\tor\tT-SQL\tmethod\tshown: GUI\tMethod 1. Open SQL\tServer\tManagement\tStudio .  83\t|\tP a g e 2. Right\tclick\tthe\ttarget\tinstance\tand\tselect Properties and\tnavigate\tto\tthe Security tab. 3. Select\tthe\toption Failed\tlogins\tonly under\tthe Login\tAuditing section\tand\tclick OK . 4. Restart\tthe\tSQL\tServer\tinstance. T-SQL\tMethod 1. Run: EXEC xp_instance_regwrite N'HKEY_LOCAL_MACHINE', N'Software\\Microsoft\\MSSQLServer\\MSSQLServer', N'AuditLevel', REG_DWORD, 2 2. Restart\tthe\tSQL\tServer\tinstance. Impact: At\ta\tminimum,\twe\twant\tto\tensure\tfailed\tlogins\tare\tcaptured\tin\torder\tto\tdetect\tif\tan adversary\tis\tattempting\tto\tbrute\tforce\tpasswords\tor\totherwise\tattempting\tto\taccess\ta\tSQL Server\timproperly. Changing\tthe\tsetting\trequires\ta\trestart\tof\tthe\tSQL\tServer\tservice. Default\tValue: By\tdefault,\tonly\tfailed\tlogin\tattempts\tare\tcaptured. References: 1. https://docs.microsoft.com/en-us/sql/database-engine/configure- windows/server-properties-security-page CIS\tControls: Version\t6 16.10\tProfile\tUser\tAccount\tUsage\tAnd\tMonitor\tFor\tAnomalies Profile\teach\tuser\u2019s\ttypical\taccount\tusage\tby\tdetermining\tnormal\ttime-of-day\taccess\tand access\tduration.\tReports\tshould\tbe\tgenerated\tthat\tindicate\tusers\twho\thave\tlogged\tin\tduring unusual\thours\tor\thave\texceeded\ttheir\tnormal\tlogin\tduration.\tThis\tincludes\tflagging\tthe\tuse of\tthe\tuser\u2019s\tcredentials\tfrom\ta\tcomputer\tother\tthan\tcomputers\ton\twhich\tthe\tuser generally\tworks.  84\t|\tP a g e Version\t7 16.13\tAlert\ton\tAccount\tLogin\tBehavior\tDeviation Alert\twhen\tusers\tdeviate\tfrom\tnormal\tlogin\tbehavior,\tsuch\tas\ttime-of-day,\tworkstation location\tand\tduration.  85\t|\tP a g e",
    "function_names": [
      "sql_server_login_auditing_failed_logins_enabled",
      "sql_server_login_auditing_failed_logins_default",
      "sql_server_login_auditing_failed_logins_recorded",
      "sql_server_login_auditing_failed_logins_configured",
      "sql_server_login_auditing_failed_logins_captured"
    ],
    "references": "1. https://docs.microsoft.com/en-us/sql/database-engine/configure- windows/server-properties-security-page CIS\tControls: Version\t6 16.10\tProfile\tUser\tAccount\tUsage\tAnd\tMonitor\tFor\tAnomalies Profile\teach\tuser\u2019s\ttypical\taccount\tusage\tby\tdetermining\tnormal\ttime-of-day\taccess\tand access\tduration.\tReports\tshould\tbe\tgenerated\tthat\tindicate\tusers\twho\thave\tlogged\tin\tduring unusual\thours\tor\thave\texceeded\ttheir\tnormal\tlogin\tduration.\tThis\tincludes\tflagging\tthe\tuse of\tthe\tuser\u2019s\tcredentials\tfrom\ta\tcomputer\tother\tthan\tcomputers\ton\twhich\tthe\tuser generally\tworks.  84\t|\tP a g e Version\t7 16.13\tAlert\ton\tAccount\tLogin\tBehavior\tDeviation Alert\twhen\tusers\tdeviate\tfrom\tnormal\tlogin\tbehavior,\tsuch\tas\ttime-of-day,\tworkstation location\tand\tduration.  85\t|\tP a g e"
  },
  {
    "id": "5.4",
    "title": "Ensure 'SQL Server Audit' is set to capture both 'failed' and 'successful logins'",
    "assessment": "Scored",
    "description": "SQL\tServer\tAudit\tis\tcapable\tof\tcapturing\tboth\tfailed\tand\tsuccessful\tlogins\tand\twriting\tthem to\tone\tof\tthree\tplaces:\tthe\tapplication\tevent\tlog,\tthe\tsecurity\tevent\tlog,\tor\tthe\tfile\tsystem. We\twill\tuse\tit\tto\tcapture\tany\tlogin\tattempt\tto\tSQL\tServer,\tas\twell\tas\tany\tattempts\tto\tchange audit\tpolicy.\tThis\twill\talso\tserve\tto\tbe\ta\tsecond\tsource\tto\trecord\tfailed\tlogin\tattempts.",
    "rationale": "By\tutilizing\tAudit\tinstead\tof\tthe\ttraditional\tsetting\tunder\tthe\tSecurity\ttab\tto\tcapture successful\tlogins,\twe\treduce\tthe\tnoise\tin\tthe\tERRORLOG.\tThis\tkeeps\tit\tsmaller\tand\teasier\tto read\tfor\tDBAs\twho\tare\tattempting\tto\ttroubleshoot\tissues\twith\tthe\tSQL\tServer.\tAlso,\tthe Audit\tobject\tcan\twrite\tto\tthe\tsecurity\tevent\tlog,\tthough\tthis\trequires\toperating\tsystem configuration.\tThis\tgives\tan\tadditional\toption\tfor\twhere\tto\tstore\tlogin\tevents,\tespecially\tin conjunction\twith\tan\tSIEM.",
    "audit": "SELECT S.name AS 'Audit Name' , CASE S.is_state_enabled WHEN 1 THEN 'Y' WHEN 0 THEN 'N' END AS 'Audit Enabled' , S.type_desc AS 'Write Location' , SA.name AS 'Audit Specification Name' , CASE SA.is_state_enabled WHEN 1 THEN 'Y' WHEN 0 THEN 'N' END AS 'Audit Specification Enabled' , SAD.audit_action_name , SAD.audited_result FROM sys.server_audit_specification_details AS SAD JOIN sys.server_audit_specifications AS SA ON SAD.server_specification_id = SA.server_specification_id JOIN sys.server_audits AS S ON SA.audit_guid = S.audit_guid WHERE SAD.audit_action_id IN ('CNAU', 'LGFL', 'LGSD'); The\tresult\tset\tshould\tcontain\t3\trows,\tone\tfor\tthe\tfollowing\taudit_action_names:  86\t|\tP a g e \u2022 AUDIT_CHANGE_GROUP \u2022 FAILED_LOGIN_GROUP \u2022 SUCCESSFUL_LOGIN_GROUP Both\tthe\tAudit\tand\tAudit\tspecification\tshould\tbe\tenabled\tand\tthe\taudited_result\tshould include\tboth\tsuccess\tand\tfailure.",
    "remediation": "Perform\teither\tthe\tGUI\tor\tT-SQL\tmethod\tshown: GUI\tMethod 1. Expand\tthe SQL\tServer\tin\tObject\tExplorer . 2. Expand\tthe Security\tFolder 3. Right-click\ton\tthe Audits folder\tand\tchoose New\tAudit... 4. Specify\ta\tname\tfor\tthe Server\tAudit . 5. Specify\tthe\taudit\tdestination\tdetails\tand\tthen\tclick OK to\tsave\tthe Server\tAudit . 6. Right-click\ton Server\tAudit\tSpecifications and\tchoose New\tServer\tAudit Specification... 7. Name\tthe Server\tAudit\tSpecification 8. Select\tthe\tjust\tcreated Server\tAudit in\tthe Audit drop-down\tselection. 9. Click\tthe\tdrop-down\tunder Audit\tAction\tType and\tselect\tAUDIT_CHANGE_GROUP. 10. Click\tthe\tnew\tdrop-down\tunder Audit\tAction\tType and\tselect\tFAILED_LOGIN_GROUP. 11. Click\tthe\tnew\tdrop-down\tunder Audit\tAction\tType and\tselect SUCCESSFUL_LOGIN_GROUP. 12. Click\tOK\tto\tsave\tthe Server\tAudit\tSpecification . 13. Right-click\ton\tthe\tnew Server\tAudit\tSpecification and\tselect Enable\tServer\tAudit Specification . 14. Right-click\ton\tthe\tnew Server\tAudit and\tselect Enable\tServer\tAudit . T-SQL\tMethod Execute\tcode\tsimilar\tto: CREATE SERVER AUDIT TrackLogins TO APPLICATION_LOG; GO CREATE SERVER AUDIT SPECIFICATION TrackAllLogins FOR SERVER AUDIT TrackLogins ADD (FAILED_LOGIN_GROUP), ADD (SUCCESSFUL_LOGIN_GROUP), ADD (AUDIT_CHANGE_GROUP) WITH (STATE = ON); GO ALTER SERVER AUDIT TrackLogins WITH (STATE = ON); GO  87\t|\tP a g e Note: If\tthe\twrite\tdestination\tfor\tthe\tAudit\tobject\tis\tto\tbe\tthe\tsecurity\tevent\tlog,\tsee\tthe Books\tOnline\ttopic\tWrite\tSQL\tServer\tAudit\tEvents\tto\tthe\tSecurity\tLog\tand\tfollow\tthe appropriate\tsteps. Impact: With\tthe\tprevious\trecommendation,\tonly\tfailed\tlogins\tare\tcaptured.\tIf\tthe\tAudit\tobject\tis not\timplemented\twith\tthe\tappropriate\tsetting,\tSQL\tServer\twill\tnot\tcapture\tsuccessful logins,\twhich\tmight\tprove\tof\tuse\tfor\tforensics. Default\tValue: By\tdefault,\tthere\tis\tno\taudit\tobject\ttracking\tlogin\tevents. References: 1. https://msdn.microsoft.com/en-us/library/cc280525(v=sql.120).aspx CIS\tControls: Version\t6 5.5\tLog\tFailed\tAdministrative\tLogin\tAttempts Configure\tsystems\tto\tissue\ta\tlog\tentry\tand\talert\ton\tany\tunsuccessful\tlogin\tto\tan administrative\taccount. Version\t7 4.9\tLog\tand\tAlert\ton\tUnsuccessful\tAdministrative\tAccount\tLogin Configure\tsystems\tto\tissue\ta\tlog\tentry\tand\talert\ton\tunsuccessful\tlogins\tto\tan administrative\taccount.  88\t|\tP a g e 6 Application Development This\tsection\tcontains\trecommendations\trelated\tto\tdeveloping\tapplications\tthat\tinterface with\tSQL\tServer.",
    "function_names": [
      "sql_server_audit_failed_logins_captured",
      "sql_server_audit_successful_logins_captured",
      "sql_server_audit_login_attempts_captured",
      "sql_server_audit_policy_changes_captured",
      "sql_server_audit_event_log_enabled",
      "sql_server_audit_security_log_enabled",
      "sql_server_audit_file_system_logging_enabled",
      "sql_server_audit_comprehensive_logging_enabled"
    ],
    "impact": "With\tthe\tprevious\trecommendation,\tonly\tfailed\tlogins\tare\tcaptured.\tIf\tthe\tAudit\tobject\tis not\timplemented\twith\tthe\tappropriate\tsetting,\tSQL\tServer\twill\tnot\tcapture\tsuccessful logins,\twhich\tmight\tprove\tof\tuse\tfor\tforensics. Default\tValue: By\tdefault,\tthere\tis\tno\taudit\tobject\ttracking\tlogin\tevents.",
    "references": "1. https://msdn.microsoft.com/en-us/library/cc280525(v=sql.120).aspx CIS\tControls: Version\t6 5.5\tLog\tFailed\tAdministrative\tLogin\tAttempts Configure\tsystems\tto\tissue\ta\tlog\tentry\tand\talert\ton\tany\tunsuccessful\tlogin\tto\tan administrative\taccount. Version\t7 4.9\tLog\tand\tAlert\ton\tUnsuccessful\tAdministrative\tAccount\tLogin Configure\tsystems\tto\tissue\ta\tlog\tentry\tand\talert\ton\tunsuccessful\tlogins\tto\tan administrative\taccount.  88\t|\tP a g e 6 Application Development This\tsection\tcontains\trecommendations\trelated\tto\tdeveloping\tapplications\tthat\tinterface with\tSQL\tServer."
  },
  {
    "id": "6.1",
    "title": "Ensure Database and Application User Input is Sanitized",
    "assessment": "Not Scored",
    "description": "Always\tvalidate\tuser\tinput\treceived\tfrom\ta\tdatabase\tclient\tor\tapplication\tby\ttesting\ttype, length,\tformat,\tand\trange\tprior\tto\ttransmitting\tit\tto\tthe\tdatabase\tserver.",
    "rationale": "Sanitizing\tuser\tinput\tdrastically\tminimizes\trisk\tof\tSQL\tinjection.",
    "audit": "Check\twith\tthe\tapplication\tteams\tto\tensure\tany\tdatabase\tinteraction\tis\tthrough\tthe\tuse\tof stored\tprocedures\tand\tnot\tdynamic\tSQL.\tRevoke\tany\tINSERT,\tUPDATE,\tor\tDELETE\tprivileges to\tusers\tso\tthat\tmodifications\tto\tdata\tmust\tbe\tdone\tthrough\tstored\tprocedures.\tVerify\tthat there's\tno\tSQL\tquery\tin\tthe\tapplication\tcode\tproduced\tby\tstring\tconcatenation.",
    "remediation": "The\tfollowing\tsteps\tcan\tbe\ttaken\tto\tremediate\tSQL\tinjection\tvulnerabilities: \u2022 Review\tTSQL\tand\tapplication\tcode\tfor\tSQL\tInjection \u2022 Only\tpermit\tminimally\tprivileged\taccounts\tto\tsend\tuser\tinput\tto\tthe\tserver \u2022 Minimize\tthe\trisk\tof\tSQL\tinjection\tattack\tby\tusing\tparameterized\tcommands\tand stored\tprocedures \u2022 Reject\tuser\tinput\tcontaining\tbinary\tdata,\tescape\tsequences,\tand\tcomment characters \u2022 Always\tvalidate\tuser\tinput\tand\tdo\tnot\tuse\tit\tdirectly\tto\tbuild\tSQL\tstatements Impact: Sanitize\tuser\tinput\tmay\trequire\tchanges\tto\tapplication\tcode\tor\tdatabase\tobject\tsyntax. These\tchanges\tcan\trequire\tapplications\tor\tdatabases\tto\tbe\ttaken\ttemporarily\toff-line.\tAny  89\t|\tP a g e change\tto\tTSQL\tor\tapplication\tcode\tshould\tbe\tthoroughly\ttested\tin\ttesting\tenvironment before\tproduction\timplementation. References: 1. https://www.owasp.org/index.php/SQL_Injection CIS\tControls: Version\t6 18.3\tSanitize\tInput\tFor\tIn-house\tSoftware For\tin-house\tdeveloped\tsoftware,\tensure\tthat\texplicit\terror\tchecking\tis\tperformed\tand documented\tfor\tall\tinput,\tincluding\tfor\tsize,\tdata\ttype,\tand\tacceptable\tranges\tor\tformats. Version\t7 18.2\tEnsure\tExplicit\tError\tChecking\tis\tPerformed\tfor\tAll\tIn-house\tDeveloped\tSoftware For\tin-house\tdeveloped\tsoftware,\tensure\tthat\texplicit\terror\tchecking\tis\tperformed\tand documented\tfor\tall\tinput,\tincluding\tfor\tsize,\tdata\ttype,\tand\tacceptable\tranges\tor\tformats.  90\t|\tP a g e",
    "function_names": [
      "database_client_input_sanitized",
      "application_user_input_sanitized",
      "database_input_type_validated",
      "database_input_length_validated",
      "database_input_format_validated",
      "database_input_range_validated",
      "application_input_type_validated",
      "application_input_length_validated",
      "application_input_format_validated",
      "application_input_range_validated"
    ],
    "impact": "Sanitize\tuser\tinput\tmay\trequire\tchanges\tto\tapplication\tcode\tor\tdatabase\tobject\tsyntax. These\tchanges\tcan\trequire\tapplications\tor\tdatabases\tto\tbe\ttaken\ttemporarily\toff-line.\tAny  89\t|\tP a g e change\tto\tTSQL\tor\tapplication\tcode\tshould\tbe\tthoroughly\ttested\tin\ttesting\tenvironment before\tproduction\timplementation.",
    "references": "1. https://www.owasp.org/index.php/SQL_Injection CIS\tControls: Version\t6 18.3\tSanitize\tInput\tFor\tIn-house\tSoftware For\tin-house\tdeveloped\tsoftware,\tensure\tthat\texplicit\terror\tchecking\tis\tperformed\tand documented\tfor\tall\tinput,\tincluding\tfor\tsize,\tdata\ttype,\tand\tacceptable\tranges\tor\tformats. Version\t7 18.2\tEnsure\tExplicit\tError\tChecking\tis\tPerformed\tfor\tAll\tIn-house\tDeveloped\tSoftware For\tin-house\tdeveloped\tsoftware,\tensure\tthat\texplicit\terror\tchecking\tis\tperformed\tand documented\tfor\tall\tinput,\tincluding\tfor\tsize,\tdata\ttype,\tand\tacceptable\tranges\tor\tformats.  90\t|\tP a g e"
  },
  {
    "id": "6.2",
    "title": "Ensure 'CLR Assembly Permission Set' is set to 'SAFE_ACCESS' for All CLR Assemblies",
    "assessment": "Scored",
    "description": "Setting\tCLR\tAssembly\tPermission\tSets\tto\tSAFE_ACCESS\twill\tprevent\tassemblies\tfrom accessing\texternal\tsystem\tresources\tsuch\tas\tfiles,\tthe\tnetwork,\tenvironment\tvariables,\tor the\tregistry.",
    "rationale": "Assemblies\twith\tEXTERNAL_ACCESS\tor\tUNSAFE\tpermission\tsets\tcan\tbe\tused\tto\taccess sensitive\tareas\tof\tthe\toperating\tsystem,\tsteal\tand/or\ttransmit\tdata\tand\talter\tthe\tstate\tand other\tprotection\tmeasures\tof\tthe\tunderlying\tWindows\tOperating\tSystem. Assemblies\twhich\tare\tMicrosoft-created\t(is_user_defined = 0)\tare\texcluded\tfrom\tthis check\tas\tthey\tare\trequired\tfor\toverall\tsystem\tfunctionality.",
    "audit": "Execute\tthe\tfollowing\tSQL\tstatement: SELECT name, permission_set_desc FROM sys.assemblies WHERE is_user_defined = 1; All\tthe\treturned\tassemblies\tshould\tshow\tSAFE_ACCESS\tin\tthe\tpermission_set_desc column.",
    "remediation": "ALTER ASSEMBLY <assembly_name> WITH PERMISSION_SET = SAFE; Impact: The\tremediation\tmeasure\tshould\tfirst\tbe\ttested\twithin\ta\ttest\tenvironment\tprior\tto production\tto\tensure\tthe\tassembly\tstill\tfunctions\tas\tdesigned\twith\tSAFE\tpermission\tsetting.  91\t|\tP a g e Default\tValue: SAFE\tpermission\tis\tset\tby\tdefault. References: 1. http://msdn.microsoft.com/en-us/library/ms345101(v=sql.120).aspx 2. http://msdn.microsoft.com/en-us/library/ms189790(v=sql.120).aspx 3. http://msdn.microsoft.com/en-us/library/ms186711(v=sql.120).aspx CIS\tControls: Version\t6 18\tApplication\tSoftware\tSecurity Application\tSoftware\tSecurity Version\t7 5.1\tEstablish\tSecure\tConfigurations Maintain\tdocumented,\tstandard\tsecurity\tconfiguration\tstandards\tfor\tall\tauthorized operating\tsystems\tand\tsoftware.  92\t|\tP a g e 7 Encryption These\trecommendations\tpertain\tto\tencryption-related\taspects\tof\tSQL\tServer.",
    "function_names": [
      "sql_server_clr_assembly_safe_access_enabled",
      "sql_server_clr_assembly_permission_set_safe_access",
      "sql_server_clr_assembly_external_access_restricted",
      "sql_server_clr_assembly_unsafe_permissions_disabled",
      "sql_server_clr_assembly_resource_access_blocked"
    ],
    "impact": "The\tremediation\tmeasure\tshould\tfirst\tbe\ttested\twithin\ta\ttest\tenvironment\tprior\tto production\tto\tensure\tthe\tassembly\tstill\tfunctions\tas\tdesigned\twith\tSAFE\tpermission\tsetting.  91\t|\tP a g e Default\tValue: SAFE\tpermission\tis\tset\tby\tdefault.",
    "references": "1. http://msdn.microsoft.com/en-us/library/ms345101(v=sql.120).aspx 2. http://msdn.microsoft.com/en-us/library/ms189790(v=sql.120).aspx 3. http://msdn.microsoft.com/en-us/library/ms186711(v=sql.120).aspx CIS\tControls: Version\t6 18\tApplication\tSoftware\tSecurity Application\tSoftware\tSecurity Version\t7 5.1\tEstablish\tSecure\tConfigurations Maintain\tdocumented,\tstandard\tsecurity\tconfiguration\tstandards\tfor\tall\tauthorized operating\tsystems\tand\tsoftware.  92\t|\tP a g e 7 Encryption These\trecommendations\tpertain\tto\tencryption-related\taspects\tof\tSQL\tServer."
  },
  {
    "id": "7.1",
    "title": "Ensure 'Symmetric Key encryption algorithm' is set to 'AES_128' or higher in non-system databases",
    "assessment": "Scored",
    "description": "Per\tthe\tMicrosoft\tBest\tPractices,\tonly\tthe\tSQL\tServer\tAES\talgorithm\toptions,\tAES_128, AES_192,\tand\tAES_256,\tshould\tbe\tused\tfor\ta\tsymmetric\tkey\tencryption\talgorithm.",
    "rationale": "The\tfollowing\talgorithms\t(as\treferred\tto\tby\tSQL\tServer)\tare\tconsidered\tweak\tor\tdeprecated and\tshould\tno\tlonger\tbe\tused\tin\tSQL\tServer:\tDES,\tDESX,\tRC2,\tRC4,\tRC4_128. Many\torganizations\tmay\taccept\tthe\tTriple\tDES\talgorithms\t(TDEA)\twhich\tuse\tkeying\toptions 1\t(3\tkey\taka\t3TDEA)\tor\tkeying\toption\t2\t(2\tkey\taka\t2TDEA).\tIn\tSQL\tServer,\tthese\tare\treferred to\tas\tTRIPLE_DES_3KEY\tand\tTRIPLE_DES\trespectively.\tAdditionally,\tthe\tSQL\tServer algorithm\tnamed\tDESX\tis\tactually\tthe\tsame\timplementation\tas\tthe\tTRIPLE_DES_3KEY\toption. However,\tusing\tthe\tDESX\tidentifier\tas\tthe\talgorithm\ttype\thas\tbeen\tdeprecated\tand\tits\tusage is\tnow\tdiscouraged.",
    "audit": "Run\tthe\tfollowing\tcode\tfor\teach\tindividual\tuser\tdatabase: USE <database_name> GO SELECT db_name() AS Database_Name, name AS Key_Name FROM sys.symmetric_keys WHERE algorithm_desc NOT IN ('AES_128','AES_192','AES_256') AND db_id() > 4; GO For\tcompliance,\tno\trows\tshould\tbe\treturned.  93\t|\tP a g e",
    "remediation": "Refer\tto\tMicrosoft\tSQL\tServer\tBooks\tOnline\tALTER\tSYMMETRIC\tKEY\tentry: http://msdn.microsoft.com/en-US/library/ms189440.aspx Impact: Eliminates\tuse\tof\tweak\tand\tdeprecated\talgorithms\twhich\tmay\tput\ta\tsystem\tat\thigher\trisk\tof an\tattacker\tbreaking\tthe\tkey. Encrypted\tdata\tcannot\tbe\tcompressed,\tbut\tcompressed\tdata\tcan\tbe\tencrypted.\tIf\tyou\tuse compression,\tyou\tshould\tcompress\tdata\tbefore\tencrypting\tit. Default\tValue: none References: 1. https://docs.microsoft.com/en-us/sql/t-sql/statements/alter-symmetric-key- transact-sql 2. http://support.microsoft.com/kb/2162020 CIS\tControls: Version\t6 14.2\tEncrypt\tAll\tSensitive\tInformation\tOver\tLess-trusted\tNetworks All\tcommunication\tof\tsensitive\tinformation\tover\tless-trusted\tnetworks\tshould\tbe encrypted.\tWhenever\tinformation\tflows\tover\ta\tnetwork\twith\ta\tlower\ttrust\tlevel,\tthe information\tshould\tbe\tencrypted. Version\t7 14.4\tEncrypt\tAll\tSensitive\tInformation\tin\tTransit Encrypt\tall\tsensitive\tinformation\tin\ttransit.  94\t|\tP a g e",
    "function_names": [
      "sql_database_symmetric_key_encryption_algorithm_min_aes_128",
      "sql_database_key_encryption_algorithm_strong",
      "sql_non_system_database_encryption_algorithm_aes_compliant",
      "sql_database_encryption_algorithm_aes_128_or_higher",
      "sql_symmetric_key_encryption_algorithm_secure"
    ],
    "impact": "Eliminates\tuse\tof\tweak\tand\tdeprecated\talgorithms\twhich\tmay\tput\ta\tsystem\tat\thigher\trisk\tof an\tattacker\tbreaking\tthe\tkey. Encrypted\tdata\tcannot\tbe\tcompressed,\tbut\tcompressed\tdata\tcan\tbe\tencrypted.\tIf\tyou\tuse compression,\tyou\tshould\tcompress\tdata\tbefore\tencrypting\tit. Default\tValue: none",
    "references": "1. https://docs.microsoft.com/en-us/sql/t-sql/statements/alter-symmetric-key- transact-sql 2. http://support.microsoft.com/kb/2162020 CIS\tControls: Version\t6 14.2\tEncrypt\tAll\tSensitive\tInformation\tOver\tLess-trusted\tNetworks All\tcommunication\tof\tsensitive\tinformation\tover\tless-trusted\tnetworks\tshould\tbe encrypted.\tWhenever\tinformation\tflows\tover\ta\tnetwork\twith\ta\tlower\ttrust\tlevel,\tthe information\tshould\tbe\tencrypted. Version\t7 14.4\tEncrypt\tAll\tSensitive\tInformation\tin\tTransit Encrypt\tall\tsensitive\tinformation\tin\ttransit.  94\t|\tP a g e"
  },
  {
    "id": "7.2",
    "title": "Ensure Asymmetric Key Size is set to 'greater than or equal to 2048' in non-system databases",
    "assessment": "Scored",
    "description": "Microsoft\tBest\tPractices\trecommend\tto\tuse\tat\tleast\ta\t2048-bit\tencryption\talgorithm\tfor asymmetric\tkeys.",
    "rationale": "The\tRSA_2048\tencryption\talgorithm\tfor\tasymmetric\tkeys\tin\tSQL\tServer\tis\tthe\thighest\tbit- level\tprovided\tand\ttherefore\tthe\tmost\tsecure\tavailable\tchoice\t(other\tchoices\tare\tRSA_512 and\tRSA_1024).",
    "audit": "Run\tthe\tfollowing\tcode\tfor\teach\tindividual\tuser\tdatabase: USE <database_name> GO SELECT db_name() AS Database_Name, name AS Key_Name FROM sys.asymmetric_keys WHERE key_length < 2048 AND db_id() > 4; GO For\tcompliance,\tno\trows\tshould\tbe\treturned.",
    "remediation": "Refer\tto\tMicrosoft\tSQL\tServer\tBooks\tOnline\tALTER\tASYMMETRIC\tKEY\tentry: http://msdn.microsoft.com/en-us/library/ms187311.aspx Impact: The\thigher-bit\tlevel\tmay\tresult\tin\tslower\tperformance,\tbut\treduces\tthe\tlikelihood\tof\tan attacker\tbreaking\tthe\tkey. Encrypted\tdata\tcannot\tbe\tcompressed,\tbut\tcompressed\tdata\tcan\tbe\tencrypted.\tIf\tyou\tuse compression,\tyou\tshould\tcompress\tdata\tbefore\tencrypting\tit.  95\t|\tP a g e Default\tValue: none References: 1. https://docs.microsoft.com/en-us/sql/t-sql/statements/alter-asymmetric-key- transact-sql 2. http://support.microsoft.com/kb/2162020 CIS\tControls: Version\t6 14.2\tEncrypt\tAll\tSensitive\tInformation\tOver\tLess-trusted\tNetworks All\tcommunication\tof\tsensitive\tinformation\tover\tless-trusted\tnetworks\tshould\tbe encrypted.\tWhenever\tinformation\tflows\tover\ta\tnetwork\twith\ta\tlower\ttrust\tlevel,\tthe information\tshould\tbe\tencrypted. Version\t7 14.4\tEncrypt\tAll\tSensitive\tInformation\tin\tTransit Encrypt\tall\tsensitive\tinformation\tin\ttransit.  96\t|\tP a g e 8 Appendix: Additional Considerations This\tappendix\tdiscusses\tpossible\tconfiguration\toptions\tfor\twhich\tno\trecommendation\tis being\tgiven.",
    "function_names": [
      "database_asymmetric_key_min_2048",
      "database_non_system_key_size_compliant",
      "database_key_asymmetric_size_sufficient",
      "database_non_system_key_min_2048",
      "database_key_encryption_strength_2048"
    ],
    "impact": "The\thigher-bit\tlevel\tmay\tresult\tin\tslower\tperformance,\tbut\treduces\tthe\tlikelihood\tof\tan attacker\tbreaking\tthe\tkey. Encrypted\tdata\tcannot\tbe\tcompressed,\tbut\tcompressed\tdata\tcan\tbe\tencrypted.\tIf\tyou\tuse compression,\tyou\tshould\tcompress\tdata\tbefore\tencrypting\tit.  95\t|\tP a g e Default\tValue: none",
    "references": "1. https://docs.microsoft.com/en-us/sql/t-sql/statements/alter-asymmetric-key- transact-sql 2. http://support.microsoft.com/kb/2162020 CIS\tControls: Version\t6 14.2\tEncrypt\tAll\tSensitive\tInformation\tOver\tLess-trusted\tNetworks All\tcommunication\tof\tsensitive\tinformation\tover\tless-trusted\tnetworks\tshould\tbe encrypted.\tWhenever\tinformation\tflows\tover\ta\tnetwork\twith\ta\tlower\ttrust\tlevel,\tthe information\tshould\tbe\tencrypted. Version\t7 14.4\tEncrypt\tAll\tSensitive\tInformation\tin\tTransit Encrypt\tall\tsensitive\tinformation\tin\ttransit.  96\t|\tP a g e 8 Appendix: Additional Considerations This\tappendix\tdiscusses\tpossible\tconfiguration\toptions\tfor\twhich\tno\trecommendation\tis being\tgiven."
  },
  {
    "id": "8.1",
    "title": "Ensure 'SQL Server Browser Service' is configured correctly",
    "assessment": "Not Scored",
    "description": "No\trecommendation\tis\tbeing\tgiven\ton\tdisabling\tthe\tSQL\tServer\tBrowser\tservice.",
    "rationale": "In\tthe\tcase\tof\ta\tdefault\tinstance\tinstallation,\tthe\tSQL\tServer\tBrowser\tservice\tis\tdisabled\tby default.\tUnless\tthere\tis\ta\tnamed\tinstance\ton\tthe\tsame\tserver,\tthere\tis\tno\ttypically\treason for\tthe\tSQL\tServer\tBrowser\tservice\tto\tbe\trunning.\tIn\tthis\tcase\tit\tis\tstrongly\tsuggested\tthat the\tSQL\tServer\tBrowser\tservice\tremain\tdisabled. When\tit\tcomes\tto\tnamed\tinstances,\tgiven\tthat\ta\tsecurity\tscan\tcan\tfingerprint\ta\tSQL\tServer listening\ton\tany\tport,\tit's\ttherefore\tof\tlimited\tbenefit\tto\tdisable\tthe\tSQL\tServer\tBrowser service. However,\tif\tall\tconnections\tagainst\tthe\tnamed\tinstance\tare\tvia\tapplications\tand\tare\tnot visible\tto\tend\tusers,\tthen\tconfiguring\tthe\tnamed\tinstance\tto\tlistening\ton\ta\tstatic\tport, disabling\tthe\tSQL\tServer\tBrowser\tservice,\tand\tconfiguring\tthe\tapps\tto\tconnect\tto\tthe specified\tport\tshould\tbe\tthe\tdirection\ttaken.\tThis\tfollows\tthe\tgeneral\tpractice\tof\treducing the\tsurface\tarea,\tespecially\tfor\tan\tunneeded\tfeature. On\tthe\tother\thand,\tif\tend\tusers\tare\tdirectly\tconnecting\tto\tdatabases\ton\tthe\tinstance,\tthen typically\thaving\tthem\tuse ServerName\\InstanceName is\tbest.\tThis\trequires\tthe\tSQL\tServer Browser\tservice\tto\tbe\trunning.\tDisabling\tthe\tSQL\tServer\tBrowser\tservice\twould\tmean\tthe end\tusers\twould\thave\tto\tremember\tport\tnumbers\tfor\tthe\tinstances.\tWhen\tthey\tdon't\tthat will\tgenerate\tservice\tcalls\tto\tIT\tstaff.\tGiven\tthe\tlimited\tbenefit\tof\tdisabling\tthe\tservice,\tthe trade-off\tis\tprobably\tnot\tworth\tit,\tmeaning\tit\tmakes\tmore\tbusiness\tsense\tto\tleave\tthe\tSQL Server\tBrowser\tservice\tenabled.  97\t|\tP a g e",
    "audit": "Check\tthe\tSQL\tBrowser\tservice's\tstatus\tvia\tservices.msc\tor\tsimilar\tmethods.",
    "remediation": "Enable\tor\tdisable\tthe\tservice\tas\tneeded\tfor\tyour\tenvironment. Default\tValue: The\tSQL\tServer\tBrowser\tservice\tis\tdisabled\tif\tonly\ta\tdefault\tinstance\tis\tinstalled\ton\tthe server.\tIf\ta\tnamed\tinstance\tis\tinstalled,\tthe\tdefault\tvalue\tis\tfor\tthe\tSQL\tServer\tBrowser service\tto\tbe\tconfigured\tas\tAutomatic\tfor\tstartup. CIS\tControls: Version\t6 9.1\tLimit\tOpen\tPorts,\tProtocols,\tand\tServices Ensure\tthat\tonly\tports,\tprotocols,\tand\tservices\twith\tvalidated\tbusiness\tneeds\tare\trunning on\teach\tsystem. Version\t7 9.2\tEnsure\tOnly\tApproved\tPorts,\tProtocols\tand\tServices\tAre\tRunning Ensure\tthat\tonly\tnetwork\tports,\tprotocols,\tand\tservices\tlistening\ton\ta\tsystem\twith validated\tbusiness\tneeds,\tare\trunning\ton\teach\tsystem.  98\t|\tP a g e Appendix:\tSummary\tTable Control\t Set Correctly Yes\t No 1\t Installation,\tUpdates\tand\tPatches 1.1\t Ensure\tLatest\tSQL\tServer\tService\tPacks\tand\tHotfixes\tare Installed\t(Not\tScored)\t o\t o 1.2\t Ensure\tSingle-Function\tMember\tServers\tare\tUsed\t(Not Scored)\t o\t o 2\t Surface\tArea\tReduction 2.1\t Ensure\t'Ad\tHoc\tDistributed\tQueries'\tServer\tConfiguration Option\tis\tset\tto\t'0'\t(Scored)\t o\t o 2.2\t Ensure\t'CLR\tEnabled'\tServer\tConfiguration\tOption\tis\tset\tto\t'0' (Scored)\t o\t o 2.3\t Ensure\t'Cross\tDB\tOwnership\tChaining'\tServer\tConfiguration Option\tis\tset\tto\t'0'\t(Scored)\t o\t o 2.4\t Ensure\t'Database\tMail\tXPs'\tServer\tConfiguration\tOption\tis\tset to\t'0'\t(Scored)\t o\t o 2.5\t Ensure\t'Ole\tAutomation\tProcedures'\tServer\tConfiguration Option\tis\tset\tto\t'0'\t(Scored)\t o\t o 2.6\t Ensure\t'Remote\tAccess'\tServer\tConfiguration\tOption\tis\tset\tto '0'\t(Scored)\t o\t o 2.7\t Ensure\t'Remote\tAdmin\tConnections'\tServer\tConfiguration Option\tis\tset\tto\t'0'\t(Scored)\t o\t o 2.8\t Ensure\t'Scan\tFor\tStartup\tProcs'\tServer\tConfiguration\tOption is\tset\tto\t'0'\t(Scored)\t o\t o 2.9\t Ensure\t'Trustworthy'\tDatabase\tProperty\tis\tset\tto\t'Off' (Scored)\t o\t o 2.10\t Ensure\tUnnecessary\tSQL\tServer\tProtocols\tare\tset\tto\t'Disabled' (Not\tScored)\t o\t o 2.11\t Ensure\tSQL\tServer\tis\tconfigured\tto\tuse\tnon-standard\tports (Not\tScored)\t o\t o 2.12\t Ensure\t'Hide\tInstance'\toption\tis\tset\tto\t'Yes'\tfor\tProduction SQL\tServer\tinstances\t(Scored)\t o\t o 2.13\t Ensure\t\t'sa'\tLogin\tAccount\tis\tset\tto\t'Disabled'\t(Scored)\t o\t o 2.14\t Ensure\t'sa'\tLogin\tAccount\thas\tbeen\trenamed\t(Scored)\t o\t o 2.15\t Ensure\t'xp_cmdshell'\tServer\tConfiguration\tOption\tis\tset\tto\t'0' (Scored)\t o\t o 2.16\t Ensure\t'AUTO_CLOSE'\tis\tset\tto\t'OFF'\ton\tcontained\tdatabases (Scored)\t o\t o 2.17\t Ensure\tno\tlogin\texists\twith\tthe\tname\t'sa'\t(Scored)\t o\t o 3\t Authentication\tand\tAuthorization  99\t|\tP a g e 3.1\t Ensure\t'Server\tAuthentication'\tProperty\tis\tset\tto\t'Windows Authentication\tMode'\t(Scored)\t o\t o 3.2\t Ensure\tCONNECT\tpermissions\ton\tthe\t'guest\tuser'\tis\tRevoked within\tall\tSQL\tServer\tdatabases\texcluding\tthe\tmaster,\tmsdb and\ttempdb\t(Scored) o\t o 3.3\t Ensure\t'Orphaned\tUsers'\tare\tDropped\tFrom\tSQL\tServer Databases\t(Scored)\t o\t o 3.4\t Ensure\tSQL\tAuthentication\tis\tnot\tused\tin\tcontained\tdatabases (Scored)\t o\t o 3.5\t Ensure\tthe\tSQL\tServer\u2019s\tMSSQL\tService\tAccount\tis\tNot\tan Administrator\t(Not\tScored)\t o\t o 3.6\t Ensure\tthe\tSQL\tServer\u2019s\tSQLAgent\tService\tAccount\tis\tNot\tan Administrator\t(Not\tScored)\t o\t o 3.7\t Ensure\tthe\tSQL\tServer\u2019s\tFull-Text\tService\tAccount\tis\tNot\tan Administrator\t(Not\tScored)\t o\t o 3.8\t Ensure\tonly\tthe\tdefault\tpermissions\tspecified\tby\tMicrosoft are\tgranted\tto\tthe\tpublic\tserver\trole\t(Scored)\t o\t o 3.9\t Ensure\tWindows\tBUILTIN\tgroups\tare\tnot\tSQL\tLogins (Scored)\t o\t o 3.10\t Ensure\tWindows\tlocal\tgroups\tare\tnot\tSQL\tLogins\t(Scored)\t o\t o 3.11\t Ensure\tthe\tpublic\trole\tin\tthe\tmsdb\tdatabase\tis\tnot\tgranted access\tto\tSQL\tAgent\tproxies\t(Scored)\t o\t o 4\t Password\tPolicies 4.1\t Ensure\t\t'MUST_CHANGE'\tOption\tis\tset\tto\t'ON'\tfor\tAll\tSQL Authenticated\tLogins\t(Not\tScored)\t o\t o 4.2\t Ensure\t'CHECK_EXPIRATION'\tOption\tis\tset\tto\t'ON'\tfor\tAll\tSQL Authenticated\tLogins\tWithin\tthe\tSysadmin\tRole\t(Scored)\t o\t o 4.3\t Ensure\t'CHECK_POLICY'\tOption\tis\tset\tto\t'ON'\tfor\tAll\tSQL Authenticated\tLogins\t(Scored)\t o\t o 5\t Auditing\tand\tLogging 5.1\t Ensure\t'Maximum\tnumber\tof\terror\tlog\tfiles'\tis\tset\tto\tgreater than\tor\tequal\tto\t'12'\t(Scored)\t o\t o 5.2\t Ensure\t'Default\tTrace\tEnabled'\tServer\tConfiguration\tOption\tis set\tto\t'1'\t(Scored)\t o\t o 5.3\t Ensure\t'Login\tAuditing'\tis\tset\tto\t'failed\tlogins'\t(Scored)\t o\t o 5.4\t Ensure\t'SQL\tServer\tAudit'\tis\tset\tto\tcapture\tboth\t'failed'\tand 'successful\tlogins'\t(Scored)\t o\t o 6\t Application\tDevelopment 6.1\t Ensure\tDatabase\tand\tApplication\tUser\tInput\tis\tSanitized\t(Not Scored)\t o\t o 6.2\t Ensure\t'CLR\tAssembly\tPermission\tSet'\tis\tset\tto\t'SAFE_ACCESS' for\tAll\tCLR\tAssemblies\t(Scored)\t o\t o 7\t Encryption  100\t|\tP a g e 7.1\t Ensure\t'Symmetric\tKey\tencryption\talgorithm'\tis\tset\tto 'AES_128'\tor\thigher\tin\tnon-system\tdatabases\t(Scored)\t o\t o 7.2\t Ensure\tAsymmetric\tKey\tSize\tis\tset\tto\t'greater\tthan\tor\tequal\tto 2048'\tin\tnon-system\tdatabases\t(Scored)\t o\t o 8\t Appendix:\tAdditional\tConsiderations 8.1\t Ensure\t'SQL\tServer\tBrowser\tService'\tis\tconfigured\tcorrectly (Not\tScored)\t o\t o  101\t|\tP a g e  Appendix:\tChange\tHistory Date\t Version\t Changes\tfor\tthis\tversion Dec\t17,\t2014\t 1.0.0\t Initial\tRelease Sep\t30,\t2015\t 1.2.0\t Add\t5.1\tSet\tthe\t'Maximum\tnumber\tof error\tlog\tfiles'\tsetting\tto\tgreater\tthan or\tequal\tto\t12\tTicket\t#143 Oct\t9,\t2015\t 1.1.0\t MSSQL\tBenchmark\t-\tRecommend Changing\t5.3\tto\tLeverage\tSQL\tServer Audit.\tTicket\t#125 Oct\t9,\t2015\t 1.1.0\t Review\tand\tupdate\tlinks\tin\treferences to\tensure\tthe\tpoint\tto\tthe\tcorrect\tSQL version\tdocs.\tTicket\t#127 Oct\t9,\t2015\t 1.1.0\t Reduce\tcomplexity\tof\tAudit\tquery\tin Section\t4.2.\tTicket\t#134 Oct\t9,\t2015\t 1.1.0\t Reduce\tcomplexity\tof\tAudit\tquery\tin Section\t4.3.\tTicket\t#\t135 Oct\t9,\t2015\t 1.1.0\t Create\tnew\tRecommendation\tto\tverify no\tlogin\thas\tthe\tname\tsa.\tTicket\t#137 Oct\t9,\t2015\t 1.1.0\t Add\tClarification\tto\tRecommendation 6.2.\tTicket\t#138 Sep\t30,\t2016\t 1.2.0\t Add\t2.12\tSet\tthe\t'Hide\tInstance' option\tto\t'Yes'\tfor\tProduction\tSQL Server\tinstances\tTicket\t#149 Sep\t30,\t2016\t 1.2.0\t Fix\tSQL\t2014\tBenchmark\tV1.1 Recommendation\t2.12,\tAudit\tand Remediation\tare\tthe\tsame\tTicket #144   102\t|\tP a g e Aug\t11,\t2017\t 1.3.0\t Mapped\tCIS\tControls\tto recommendations Aug\t11,\t2017\t 1.3.0\t Sync\u2019d\twith\t2016\tBenchmark\twhere appropriate.\tFormatted\tto\tstandards. Aug\t11,\t2017\t 1.3.0\t Planned\tUpdate Mar\t1,\t2019\t 1.4.0\t Ticket\t#7966:\tIncorrect\tSELECT syntax\tfor\t2.17\tAudit\tSection Mar\t1,\t2019\t 1.4.0\t Ticket\t#7798:\tThe\tT-SQL\tfor\tthe\tHide Instance\trecommendation\tappears\tto be\tmissing\t'sys'\tbetween\t'master.'\tand '.xp_instance_regwrite' Mar\t1,\t2019\t 1.4.0\t Ticket\t#7797:\tThe\tT-SQL\tfor\tthe\tHide Instance\trecommendation\tappears\tto be\tmissing\t'sys'\tbetween\t'master.'\tand '.xp_instance_regread' May\t14,\t2019\t 1.4.0\t Ticket\t#8400:\tChange\tnon-standard port\trecommendation\tto\t'not\tscored' May\t17,\t2019\t 1.4.0\t Added\tmappings\tto\tversion\t7\tof\tthe CIS\tControls May\t20,\t2019\t 1.4.0\t Ticket\t#6275:\tAdd\ta\tprofile\tfor\tAWS RDS May\t31,\t2019\t 1.1.0\t Planned\tUpdate",
    "function_names": [
      "sql_server_browser_service_disabled",
      "sql_server_browser_service_secure_config",
      "sql_server_browser_service_network_restricted",
      "sql_server_browser_service_authentication_required",
      "sql_server_browser_service_port_configured",
      "sql_server_browser_service_firewall_protected",
      "sql_server_browser_service_logging_enabled",
      "sql_server_browser_service_access_controlled",
      "sql_server_browser_service_encryption_enabled",
      "sql_server_browser_service_min_tls_1_2"
    ]
  }
]